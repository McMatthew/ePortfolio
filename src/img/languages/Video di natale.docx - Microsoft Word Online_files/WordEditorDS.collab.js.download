'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1406:function(I,K,e){e.r(K);e.d(K,"RtcUtils",function(){return l});I=e(0);var m=e(8),f=e(29),a=e(1494);class l{static qOb(w,z=a.a.hYb){let x;try{x=f.c(w)}catch(u){throw w=String.format("Failed to JSON-serialize payload : {0}",u),m.ULS.sendTraceTag(508396173,500,10,w),Error.argument("payload",w);}if(x.length>z)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",x.length,z),m.ULS.sendTraceTag(508396171,
500,10,w),Error.argument("payload",w);return x}static deserialize(w,z,x){if(!w)return null;if(Object.getType(w)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",z,Object.getType(w).getName(),x);m.ULS.sendTraceTag(508396170,500,10,u);return null}u=null;try{u=f.a(w)}catch(v){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",z,v,x),m.ULS.sendTraceTag(508396168,
500,10,w)}return u}static Soa(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return f.c(w)}catch(z){return w.toString()}}static vFf(w){let z,x,u;z=0;u=x=null;if(!w)return{z9c:z,A9c:x,Yk:u};try{const v=w.source;v&&Object.getType(v)===String&&(u=v);const E=w.context;E&&(w=E,z=w.status?w.status:0,x=w.statusText?w.statusText:null)}catch(v){}return{z9c:z,A9c:x,Yk:u}}}Object(I.a)(l,"RtcUtils",null,[])},1452:function(I,K,e){e.r(K);I=e(0);var m=e(8),f=e(118),a=e(84),l;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(l||(l={}));Object(I.b)("ApiType",l);var w;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(w||(w=
{}));Object(I.b)("EventCountType",w);var z=e(1597);e.d(K,"FrequentLoggingMetrics",function(){return x});class x{constructor(u){this.lZc=this.C3c=null;this.egd=this.q4c=0;this.vl=null;this.WNc=this.uIb=0;this.$f=u;this.DYf();this.eGb=this.sKc=this.DIb=!1;this.c6a=0}get jFf(){return this.eGb}NIg(u){this.WNc=u;window.setInterval(Object(f.a)(this,this.MXb,"logMetricsBatchAndReset"),u);this.uIb=(new Date).getTime()}vu(u,v){this.kFg(u)&&!this.sKc||this.jFf||!window.navigator.onLine||this.$f.Eva||(this.vl[u][v]++,
this.DIb=!0)}DYf(){this.vl=Array(3);for(let u=0;3>u;u++){this.vl[u]=Array(7);for(let v=0;7>v;v++)this.vl[u][v]=0}}opf(){const u={};for(let v=0;3>v;v++)for(let E=0;7>E;E++)this.v5f(v,E)&&(u[l[v]+w[E]]=this.vl[v][E]);u.FSDomain=this.C3c;u.ConnectionDomain=this.lZc;u.FSRetryInterval=this.q4c;u.MaxPayloadSize=this.egd;u.LogNumber=this.c6a;1===this.c6a&&(u.FSLatencies=z.a.instance.QMf(),u.ConLatencies=z.a.instance.nLf());return u}v5f(u,v){return 2===u&&3!==v&&0!==v?!1:!0}kFg(u){return 2===u?!1:!0}MXb(){if(this.DIb){this.c6a++;
if((new Date).getTime()-this.uIb<5E3+this.WNc){var u=a.a.toJSON(this.opf());m.ULS.sendTraceTag(50644352,500,15,u)}this.uIb=(new Date).getTime();for(u=0;3>u;u++)for(let v=0;7>v;v++)this.vl[u][v]=0;this.DIb=!1}}Fag(){this.sKc=!0}static get instance(){return x._instance}static create(u){x.instance||(x._instance=new x(u));return x.instance}}x._instance=null;Object(I.a)(x,"FrequentLoggingMetrics",null,[1807])},1494:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{}m.fgd=31E3;m.hYb=8E3;Object(I.a)(m,
"RealtimeChannelStaticConstants",null,[])},1597:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{constructor(){this.jTc=!1;this.iJa=null;this.kIc=0;this.nGb=this.Q_c(6);this.s4a=this.Q_c(6);this.ffa=this.vra=0;this.Zq=()=>new Date}get LJg(){return this.jTc}Q_c(f){f=Array(f);for(let a=0;a<f.length;a++)f[a]=0;return f}QMf(){return this.nGb.toString()}nLf(){return this.s4a.toString()}OIg(){this.iJa=this.Zq()}KPa(f,a,l=!1){this.LJg||(l&&(this.jTc=!0),l=this.Zq(),0===f&&5<this.vra||1===f&&
5<this.ffa||(this.kIc<f?(1===this.vra%2&&(this.nGb[this.vra]=-1,this.vra++),this.kIc=f,1===a&&(this.s4a[this.ffa]=-1,this.ffa++),this.s4a[this.ffa]=this.A3b(l),this.ffa++):0===f?(this.nGb[this.vra]=this.A3b(l),this.vra++):(this.s4a[this.ffa]=this.A3b(l),this.ffa++)))}A3b(f){const a=f.getTime()-this.iJa.getTime();this.iJa=f;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(f){m._instance=f}}m._instance=null;Object(I.a)(m,"LatencyMetrics",null,[])},
1640:function(I,K,e){I=e(0);class m{constructor(){this.aHc=this.QEb=!1;this.callback=null}qyb(a){this.callback=a;this.Evd()}Tfd(a){this.QEb||(this.QEb=!0,this.XQe=a,this.Evd())}Evd(){this.QEb&&this.callback&&!this.aHc&&(this.aHc=!0,this.callback(this.XQe))}}Object(I.a)(m,"CompletionTask",null,[]);e.d(K,"a",function(){return f});class f{constructor(){this.wOc=new m;this.uOc=new m}veb(a){this.wOc.qyb(a)}ueb(a){this.uOc.qyb(a)}uOa(a){this.wOc.Tfd(a)}K9(a){this.uOc.Tfd(a)}aYb(){this.uOa(2);this.K9(2)}}
Object(I.a)(f,"MessageStatus",null,[1822])},1718:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f,a,l,w){super();this.type=f;this.fC=a;this.Fzf=l;this.iqa=w}}Object(I.a)(m,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1719:function(I,K,e){e.r(K);e.d(K,"MaxOutstandingThrottler",function(){return a});I=e(0);var m=e(92);K=e(1720);var f=e(1640);class a extends K.a{constructor(l,w=""){super(l,w);this.kwa=this.L$=0;this.sa=new m.a;this.Jra=!1;this.B4a=
this.t4a=this.ELb=0;this.HBg=()=>{this.Jra=!1;if(this.Dva){const z=this.O7a,x=this.Dsa;this.KKa(!1);this.dQa(z,x)}};this.Hjg=()=>{++this.B4a;this.B4a>Math.floor(this.kwa/2)&&(this.B4a=-1E9,this.sa.raiseEvent("TMUDM"))};this.q6a=0;this.yS=[];this.clearTimeout=a.WPb}add(l){this.Kra||this.init(a.y0c,a.w0c);this.Zfa++;const w=new f.a;this.Dva?this.Ggb(l,w):this.q6a<this.kwa?this.dQa(l,w):(this.Ggb(l,w),this.Jra=!1);return w}dQa(l,w){l=this.lSc(l);const z=this.setTimeout(this.Hjg,this.L$);++this.q6a;Array.add(this.yS,
z);const x=this.t4a;l.veb(u=>{w.uOa(u)});l.ueb(u=>{this.t4a===x&&(this.Gjg(x,z),w.K9(u))})}Gjg(l,w){this.t4a===l&&(--this.q6a,this.clearTimeout(w),Array.remove(this.yS,w),this.Dva&&this.GBg())}GBg(){this.Dva&&!this.Jra&&(this.ELb=this.setTimeout(this.HBg,0),this.Jra=!0)}v8a(l){this.sa.addHandler("TMUDM",l)}qod(l){this.sa.removeHandler("TMUDM",l)}reset(){this.Zfa=this.FJa=this.dIa=this.B4a=0;++this.t4a;for(const l of this.yS)this.clearTimeout(l);this.q6a=0;this.yS=[];this.KKa(!0);this.Jra&&(this.clearTimeout(this.ELb),
this.ELb=0,this.Jra=!1)}init(l,w){this.Kra||(this.L$=l,this.kwa=w,this.Kra=!0)}static createInstance(l,w=""){return new a(l,w)}static WPb(l){window.clearTimeout(l)}}a.y0c=15E3;a.w0c=5;Object(I.a)(a,"MaxOutstandingThrottler",K.a,[1821,1820])},1720:function(I,K,e){e.d(K,"a",function(){return f});I=e(0);var m=e(8);class f{constructor(a,l=""){this.dIa=this.FJa=0;this.wHb=!1;this.Dsa=this.O7a=null;this.Kra=!1;this.lSc=a;this.Rud=l;this.setTimeout=f.YPb;this.Zfa=this.FJa=this.dIa=0}s0b(){0<this.Zfa&&0<
this.dIa&&m.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Rud,this.dIa,this.Zfa);0<this.Zfa&&0<this.FJa&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Rud,this.FJa,this.Zfa)}get Dva(){return this.wHb}Ggb(a,l){this.FJa++;this.KKa(!0);this.wHb=!0;this.O7a=a;this.Dsa=l}KKa(a){this.wHb=!1;this.Dsa&&a&&(this.dIa++,this.Dsa.aYb());this.Dsa=this.O7a=null}static YPb(a,l){return window.setTimeout(a,l)}}Object(I.a)(f,
"ThrottlerBase",null,[])},1721:function(I,K,e){e.r(K);e.d(K,"MaxRateThrottler",function(){return f});I=e(0);K=e(1720);var m=e(1640);class f extends K.a{constructor(a,l=""){super(a,l);this.pwa=0;this.FBg=()=>{if(this.Dva){const w=this.O7a,z=this.Dsa;this.KKa(!1);this.dQa(w,z)}};this.IIa=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(a){this.Kra||(this.pwa=a,this.Kra=!0)}add(a){this.Kra||this.init(f.u0c);this.Zfa++;const l=this.currentTime(),w=new m.a;this.IIa>l&&(this.IIa=l);
this.Dva?(this.KKa(!0),this.Ggb(a,w)):this.IIa+this.pwa<=l?this.dQa(a,w):(this.Ggb(a,w),this.setTimeout(this.FBg,this.IIa+this.pwa-l));return w}dQa(a,l){this.IIa=this.currentTime();a=this.lSc(a);a.veb(w=>{l.uOa(w)});a.ueb(w=>{l.K9(w)})}static createInstance(a,l=""){return new f(a,l)}}f.u0c=200;Object(I.a)(f,"MaxRateThrottler",K.a,[1819,1820])},1722:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{constructor(){this.Presence=null;this.TimeStamp=0}}Object(I.a)(m,"PresenceDataEntryForClients",
null,[])},1723:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{}m.w1b="rr";m.Izg="rd";m.Fzg="rbp";m.O1b="sa";Object(I.a)(m,"RtcReconnectParams",null,[])},1724:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{constructor(f,a,l,w){this.Ebg=f;this.L$=a;this.Wag=l;this.kTf=w}}Object(I.a)(m,"ThrottlerManagerSettings",null,[])},1775:function(I,K,e){I=e(0);var m=e(1907),f=e(1912),a=e(1908),l=e(1911),w=e(1910),z=e(1906),x=e(1909);class u extends Sys.EventArgs{constructor(){super()}}
Object(I.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(Y,P,S,N,V,Z){super();this.Aya=Y;this.BWa=P;this.Ytf=S;this.T2c=V;this.tOb=N;this.gB=Z}}Object(I.a)(v,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class E extends Sys.EventArgs{constructor(Y){super();this.hubConnection=Y}}Object(I.a)(E,"RefreshProxyEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(Y,P){super();this.aha=Y;this.errorMessage=P}}Object(I.a)(y,
"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(Y,P,S){super();this.type=Y;this.tK=P;this.iqa=S}}Object(I.a)(H,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var D=e(1718);class G extends Sys.EventArgs{constructor(){super()}}Object(I.a)(G,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(Y){super();this.Tpb=Y}}Object(I.a)(J,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class U extends Sys.EventArgs{constructor(Y,
P){super();this.type=Y;this.xQg=P}}Object(I.a)(U,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var F=e(92);e.d(K,"a",function(){return T});class T{constructor(){this.sa=new F.a}Wsg(Y,P){this.sa.raiseEvent("CSC",new m.a(Y,P))}mtg(Y){this.sa.raiseEvent("RP",new E(Y))}ofb(Y){this.sa.raiseEvent("RC",Y)}ntg(){this.sa.raiseEvent("RMID")}ltg(Y,P,S,N,V,Z){this.sa.raiseEvent("RPS",new v(Y,P,S,N,V,Z))}Mmd(Y,P){this.sa.raiseEvent("UPSR",new U(Y,P))}Gmd(Y,P){this.sa.raiseEvent("PU",new z.a(Y,P))}dtg(Y){this.sa.raiseEvent("MPU",
new a.a(Y))}e0b(Y,P,S,N){this.sa.raiseEvent("SUN",new D.a(Y,P,S,N))}ptg(Y,P){this.sa.raiseEvent("UNR",new x.a(Y,P))}Kmd(Y,P,S){this.sa.raiseEvent("SP",new H(Y,P,S))}Fwe(Y,P){this.sa.raiseEvent("PSU",new w.a(Y,P))}itg(Y){this.sa.raiseEvent("PSC",new l.a(Y))}btg(Y){this.sa.raiseEvent("IPSC",new l.a(Y))}qtg(Y){this.sa.raiseEvent("UPSC",new J(Y))}otg(Y,P){this.sa.raiseEvent("SPC",new G(Y,P))}Imd(Y,P){this.sa.raiseEvent("RCF",new y(Y,P))}$sg(Y){this.sa.raiseEvent("CPSWM",new u(Y))}Hwe(Y,P){this.sa.raiseEvent("UCI",
new f.a(Y,P))}K0(Y){this.sa.addHandler("CSC",Y)}MFa(Y){this.sa.removeHandler("CSC",Y)}Ejf(Y){this.sa.addHandler("RP",Y)}Dwg(Y){this.sa.removeHandler("RP",Y)}Djf(Y){this.sa.addHandler("RC",Y)}Cwg(Y){this.sa.removeHandler("RC",Y)}Fjf(Y){this.sa.addHandler("RMID",Y)}Cjf(Y){this.sa.addHandler("RPS",Y)}Bwg(Y){this.sa.removeHandler("RPS",Y)}Pjf(Y){this.sa.addHandler("UPSR",Y)}Lwg(Y){this.sa.removeHandler("UPSR",Y)}jBa(Y){this.sa.addHandler("PU",Y)}A1a(Y){this.sa.removeHandler("PU",Y)}fjf(Y){this.sa.addHandler("IPU",
Y)}qwg(Y){this.sa.removeHandler("IPU",Y)}Njf(Y){this.sa.addHandler("UCI",Y)}Jwg(Y){this.sa.removeHandler("UCI",Y)}Ijf(Y){this.sa.addHandler("SUN",Y)}Hwg(Y){this.sa.removeHandler("SUN",Y)}gjf(Y){this.sa.addHandler("IUNR",Y)}rwg(Y){this.sa.removeHandler("IUNR",Y)}CQ(Y){this.sa.addHandler("UNR",Y)}OFa(Y){this.sa.removeHandler("UNR",Y)}Cob(Y){this.sa.addHandler("PSU",Y)}Rzb(Y){this.sa.removeHandler("PSU",Y)}ejf(Y){this.sa.addHandler("IPSU",Y)}pwg(Y){this.sa.removeHandler("IPSU",Y)}Bob(Y){this.sa.addHandler("PSC",
Y)}Qzb(Y){this.sa.removeHandler("PSC",Y)}djf(Y){this.sa.addHandler("IPSC",Y)}owg(Y){this.sa.removeHandler("IPSC",Y)}Ojf(Y){this.sa.addHandler("UPSC",Y)}Kwg(Y){this.sa.removeHandler("UPSC",Y)}Hjf(Y){this.sa.addHandler("SP",Y)}Gwg(Y){this.sa.removeHandler("SP",Y)}Jjf(Y){this.sa.addHandler("SPC",Y)}Iwg(Y){this.sa.removeHandler("SPC",Y)}static getInstance(){return T._instance||(T._instance=new T)}}T._instance=null;Object(I.a)(T,"RtcEventHub",null,[1593])},1790:function(I,K,e){e.r(K);I=e(0);var m=e(8),
f=e(347),a=e(49),l=e(76);class w{constructor(x){this.messageId=x;this.IBg=(new Date).getTime();this.fXb=new l.a}}Object(I.a)(w,"MessageLatencyDetails",null,[]);e.d(K,"ClientToClientMessageTelemetry",function(){return z});class z{constructor(x,u,v){this.dV=null;this.vIb=this.JKb=0;this.sendMessage=()=>{if(this.wJa){const E=a.a.create().toString();this.dV=new w(E);this.Le.e0b(16,E,!1,new f.a);window.setTimeout(()=>{this.b$f(E)},this.vIb)}};this.Ftg=(E,y)=>{16===y.type?this.Le.e0b(17,y.fC,!1,new f.a):
17===y.type&&this.wJa&&y.fC&&this.processMessage(y.fC)};this.ef=u;this.xOc=v;this.wJa=!1;this.Le=x;this.Le.CQ(this.Ftg)}start(){if(this.xOc&&!this.wJa){const x=this.ef.Rpd;this.vIb=this.ef.Npd;x<=this.vIb?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.ef.Rpd,this.ef.Npd),this.xOc=!1):(this.wJa=!0,this.JKb=window.setInterval(this.sendMessage,
x))}}b$f(x){this.dV&&this.dV.messageId===x&&(0<this.dV.fXb.count?(x=this.dV.fXb.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",x)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.dV=null)}stop(){this.JKb&&(window.clearInterval(this.JKb),this.wJa=!1)}processMessage(x){x&&this.dV&&x.toString()===this.dV.messageId&&(x=(new Date).getTime()-this.dV.IBg,this.dV.fXb.add(x))}static get instance(){return z._instance}static Ctb(x,u,v){return z.instance||
(z._instance=new z(x,u,v))}}z._instance=null;Object(I.a)(z,"ClientToClientMessageTelemetry",null,[])},1906:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f,a){super();this.aka=f;this.d1c=a}}Object(I.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1907:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f,a){super();this.newState=f;this.oldState=a}}Object(I.a)(m,"ChangedConnectionStateEventArgs",Sys.EventArgs,
[])},1908:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f){super();this.tK=f}}Object(I.a)(m,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[])},1909:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f,a=null){super();this.wl=f;this.NXk=a}get type(){return this.wl}get fC(){return this.NXk}}Object(I.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[])},1910:function(I,K,e){e.d(K,"a",function(){return m});I=
e(0);class m extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.aka=a}}Object(I.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1911:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f){super();this.Tpb=f}}Object(I.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1912:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m extends Sys.EventArgs{constructor(f,a){super();this.m8h=f;this.iqa=a}}Object(I.a)(m,"ClientInfoEventArgs",
Sys.EventArgs,[])},1913:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);class m{constructor(f,a){this.status=f;this.Psc=a}}Object(I.a)(m,"UserStatusInfo",null,[])},1914:function(I,K,e){e.r(K);e.d(K,"RealtimeChannelMetrics",function(){return w});I=e(0);var m=e(8),f=e(160),a=e(84),l=e(1406);class w{constructor(){this.hPc=this.iPc=this.jPc=this.ePc=this.dPc=this.fPc=this.UIa=this.TIb=0;this.nfa=this.bIb=this.JIa=this.UHb=this.Nra=this.RHb=this.D7=this.GIa=this.Mra=this.QHb=this.m5a=this.rra=null;
this.yIb=this.LIa=this.qSc=this.tHc=0;this.AOc=!1;this.Zmd=this.j0b;this.cnd=this.m0b;this.bnd=this.l0b;this.fnd=this.o0b;this.dnd=this.n0b;this.t0b=this.u0b;this.tfb=this.r0b;this.Uia=this.p0b;this.bxa=this.q0b;this.$md=this.k0b;this.KEa=this.CYb;this.Z_a=this.DYb}j0b(){this.TIb++;this.QHb=new Date;this.rra||(this.rra=new Date)}m0b(){this.UIa++;this.D7=new Date;this.m5a||(this.m5a=this.D7);this.JIa=this.D7;this.Mtf()}l0b(){this.fPc++;this.RHb=new Date}o0b(){this.dPc++;this.Mra=new Date}n0b(){this.ePc++;
this.GIa=new Date}r0b(){this.Nra=new Date;this.jPc++}q0b(){this.nfa||(this.nfa=new Date);this.iPc++}p0b(){this.UHb=new Date;this.hPc++}u0b(){!this.AOc&&this.TIb&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.Tsf())),this.AOc=!0)}k0b(z){const {z9c:x,A9c:u,Yk:v}=l.RtcUtils.vFf(z);x&&x!==f.a.jB&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:x,["HttpErrorStatus"]:u,["Exception"]:v})),f.a.Jge(x)&&this.tHc++,f.a.nje(x)&&this.qSc++)}CYb(){this.bIb=new Date}DYb(){this.Mra=this.JIa=
new Date}Tsf(){return{["numberOfConnectionAttempts"]:this.TIb,["numberOfSuccessfulConnections"]:this.UIa,["numberOfFailedConnections"]:this.fPc,["numberOfDisconnectedConnections"]:this.dPc,["numberOfExplicitDisconnectedConnections"]:this.ePc,["numberOfSentMessages"]:this.jPc,["numberOfReceivedMessages"]:this.iPc,["numberOfLostMessages"]:this.hPc,["firstConnectionAttempt"]:this.rra?this.rra:null,["firstMessageReceived"]:this.nfa?this.nfa:null,["firstConnectionSuccess"]:this.m5a?this.m5a:null,["lastConnectionAttempt"]:this.QHb?
this.QHb:null,["lastConnectionSuccess"]:this.D7?this.D7:null,["lastConnectionFailure"]:this.RHb?this.RHb:null,["lastMessageSent"]:this.Nra?this.Nra:null,["lastMessageLost"]:this.UHb?this.UHb:null,["lastDisconnect"]:this.Mra?this.Mra:null,["lastExplicitDisconnect"]:this.GIa?this.GIa:null,["lastTimeOnline"]:this.JIa?this.JIa:null,["lastTimeOffline"]:this.bIb?this.bIb:null,["maxDisconnectedTimeMs"]:this.LIa,["maxExplicitDisconnectedTimeMs"]:this.yIb,["clientConnectionErrors"]:this.tHc,["serverConnectionErrors"]:this.qSc}}Mtf(){this.rra&&
1===this.UIa&&(this.LIa=Math.max(this.LIa,this.D7.getTime()-this.rra.getTime()));this.Mra&&1<this.UIa&&(this.LIa=Math.max(this.LIa,this.D7.getTime()-this.Mra.getTime()));this.GIa&&1<this.UIa&&(this.yIb=Math.max(this.yIb,this.D7.getTime()-this.GIa.getTime()))}static createInstance(z){w._instance||(w._instance=new w,m.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",z));return w._instance}}w._instance=null;Object(I.a)(w,"RealtimeChannelMetrics",null,[1806,148])},
1915:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);var m;(function(f){f[f.wbi=0]="contentUpdate";f[f.C6p=1]="editorsTableUpdate";f[f.vRb=2]="fileNameUpdate";f[f.ZNp=3]="wetContentUpdate";f[f.Apq=4]="persistedContentUpdate";f[f.hzl=5]="clientRtcReconnectRequest";f[f.Prq=6]="replicationTelemetry";f[f.hfq=7]="lockUpdate";f[f.G2p=8]="collabServiceContentUpdate";f[f.pyq=9]="trackChangeSettingUpdate";f[f.htq=10]="saveTargetUpdate";f[f.xzq=11]="uploadToOcsUpdate";f[f.beq=12]="labelUpdate";f[f.k9m=
13]="hostNotificationSubscriptionStatus";f[f.Cwq=14]="subscribeOrExtend";f[f.H6p=15]="elapsedBootTelemetry";f[f.r8h=16]="clientToClientTelemetryMessage";f[f.q8h=17]="clientToClientResponseMessage";f[f.Rzq=18]="verifyNotificationPipeline";f[f.rbq=19]="hostNotificationHeartbeat";f[f.Ktq=20]="secondaryMetadataUpdate";f[f.last=21]="last"})(m||(m={}));Object(I.b)("UpdateNotificationType",m)},1916:function(I,K,e){e.d(K,"a",function(){return m});I=e(0);var m;(function(f){f[f.unspecified=0]="unspecified";
f[f.word=1]="word";f[f.F9l=2]="excel";f[f.Xzj=3]="powerPoint";f[f.test=4]="test";f[f.wacFrontEnd=5]="wacFrontEnd";f[f.$uj=6]="oneNote";f[f.iNp=7]="visio";f[f.vnq=8]="officeMobile";f[f.X3p=9]="cosmosDBChangefeed";f[f.last=10]="last"})(m||(m={}));Object(I.b)("RtcClientAppName",m)},1999:function(I,K,e){e.r(K);I=e(0);var m=e(8),f=e(118),a=e(347),l=e(1916),w=e(910),z=e(103),x=e(2),u=e(1913),v=e(43),E=e(1597);class y{constructor(Ga,wa){this.data=Ga;this.timeStamp=wa}}Object(I.a)(y,"PresenceData",null,[]);
var H=e(159),D=e(1494);class G{constructor(){this.nEb=this.yGc=!1;this.mEb=0;this.IEb=this.UKb=this.TKb=this.dEb=!1;this.oGb=0;this.IRc=!1;this.HRc=this.GRc=0;this.tKb=!1;this.xKb=this.vKb=this.yKb=this.uKb=0;this.wKb=!1}get gnf(){return this.nEb}get fnf(){return this.mEb}get pWh(){return this.dEb}get IFg(){return this.TKb}get JFg(){return this.UKb}get msf(){return this.IEb}get Y$a(){return this.oGb}get Kzg(){return this.IRc}get Mpd(){return this.GRc}get Jzg(){return this.HRc}get Gzg(){return this.tKb}get Hzg(){return this.uKb}get Rpd(){return this.yKb}get Npd(){return this.vKb}get Ppd(){return this.xKb}get Opd(){return this.wKb}static createInstance(Ga){return Ga?
Object.assign(new G,{yGc:Ga.$("AwayStatusManagerIsEnabled"),nEb:Ga.$("AwayStatusOneMinuteTimeoutIsEnabled"),mEb:Ga.sc("AwayCoauthorThresholdMs",9E5),dEb:Ga.$("RtcAllowCrossDomainAccessEnabled"),TKb:Ga.$("ShouldLogOnContentNotification"),UKb:Ga.$("ShouldLogOnHostSubscriptionNotification"),IEb:Ga.$("RtcClientMetricsEnabled"),oGb:Ga.sc("RtcFindSessionRequestTimeoutInMS",6E4),IRc:Ga.$("RtcJsClientFrequentlyLogsMetrics"),GRc:Ga.sc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),HRc:Ga.sc("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),tKb:Ga.$("RtcClientMessageTelemetryEnabled"),uKb:Ga.sc("RtcClientMessageTelemetrySampleSize",5),yKb:Ga.sc("RtcSendTelemetryMessageIntervalInMS",3E5),vKb:Ga.sc("RtcLogClientMessageMetricsTimeOutInMs",2E4),xKb:Ga.sc("RtcMaxPayloadSizeInCharactersOverride",D.a.hYb),wKb:Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new G,{yGc:!1,nEb:!1,mEb:9E5,dEb:!1,TKb:!1,UKb:!0,IEb:!1,oGb:9E4,tKb:!1,uKb:5,yKb:3E5,vKb:2E4,xKb:D.a.hYb,wKb:!1})}}Object(I.a)(G,
"RealtimeChannelSettings",null,[1814]);var J=e(92),U=e(1724);class F{constructor(Ga){this.ef=null;this.vi=!1;this.sa=new J.a;this.AIb=new z.a;this.zIb=new z.a;this.FLb=Ga;this.Ara=this.FLb.B_c(wa=>wa.send(),"GlobalMaxOustandingThrottler");this.Ara.v8a(()=>{this.sa.raiseEvent("TMUDM")})}init(Ga){this.vi||(this.ef=Ga,this.Ara.init(this.ef.L$,this.ef.kTf),this.vi=!0)}hSf(Ga){var {MaxRateThrottler:wa}=e(1721),{MaxOutstandingThrottler:xa}=e(1719);this.vi||this.init(new U.a(wa.u0c,xa.y0c,xa.w0c,F.Xag));
({value:wa}=this.AIb.Nc(Ga)).returnValue||(({value:wa}=this.zIb.Nc(Ga)).returnValue||(wa="MaxOutstandingThrottler-"+Ga,wa=this.FLb.B_c(Object(f.a)(this.Ara,this.Ara.add,"add"),wa),wa.init(this.ef.L$,this.ef.Wag),wa.v8a(()=>{this.sa.raiseEvent("TMUDM")}),this.zIb.add(Ga,wa)),xa="MaxRateThrottler-"+Ga,wa=this.FLb.Dwf(Object(f.a)(wa,wa.add,"add"),xa),wa.init(this.ef.Ebg),this.AIb.add(Ga,wa));return wa}reset(){for(const Ga of this.AIb)Ga.value.s0b();for(const Ga of this.zIb)Ga.value.s0b(),Ga.value.reset();
this.Ara.s0b();this.Ara.reset()}v8a(Ga){this.sa.addHandler("TMUDM",Ga)}qod(Ga){this.sa.removeHandler("TMUDM",Ga)}}F.Xag=1E3;Object(I.a)(F,"ThrottlerManager",null,[1813]);class T{}T.UWf="realtimeChannelHub";T.vRa="UpdatePresence";T.sE="SendUpdateNotification";T.sSb="GetCompletePersistentStateWithMetadata";T.updatePersistentState="UpdatePersistentState";T.T$="UpdateClientInfo";Object(I.a)(T,"RtcHubMethodNames",null,[]);class Y{constructor(Ga){this.U7=!1;this.GJa=0;this.VEb=!1;this.j$f=()=>{m.ULS.sendTraceTag(4539720,
500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.kl)};this.setTimeout=Y.YPb;this.clearTimeout=Y.WPb;this.w$f=this.j$f;this.kl=Ga}kig(){this.U7||(this.GJa=this.setTimeout(()=>{this.U7=!1;this.ufd()},8E3),this.U7=!0,this.VEb=!1)}xig(){this.GV()}Okg(){this.ufd()}ufd(){this.GV();this.VEb||(this.VEb=!0,this.w$f())}GV(){this.U7&&this.clearTimeout(this.GJa);this.GJa=0;this.U7=!1}static YPb(Ga,wa){return window.setTimeout(Ga,wa)}static WPb(Ga){window.clearTimeout(Ga)}}Object(I.a)(Y,"ConnectedUsageKpiLogger",
null,[1812]);class P{constructor(){this.Zmd=this.j0b;this.cnd=this.m0b;this.bnd=this.l0b;this.fnd=this.o0b;this.dnd=this.n0b;this.t0b=this.u0b;this.tfb=this.r0b;this.Uia=this.p0b;this.bxa=this.q0b;this.$md=this.k0b;this.KEa=this.CYb;this.Z_a=this.DYb}j0b(){}m0b(){}l0b(){}o0b(){}n0b(){}r0b(){}q0b(){}p0b(){}u0b(){}k0b(){}CYb(){}DYb(){}}Object(I.a)(P,"NoopRealtimeChannelMetrics",null,[1806,148]);class S{}S.vRa="presenceUpdated";S.updateNotification="updateNotification";S.wkd="persistentStateCleared";
S.updatePersistentState="persistentStateUpdated";Object(I.a)(S,"RtcClientMethodNames",null,[]);class N{constructor(Ga){this.Wq=Ga}Mug(Ga){this.Wq.on(S.vRa,Ga)}Uug(Ga){this.Wq.on(S.updateNotification,Ga)}Lug(Ga){this.Wq.on(S.updatePersistentState,Ga)}Kug(Ga){this.Wq.on(S.wkd,Ga)}LOg(Ga){this.Wq.off(S.vRa,Ga)}OOg(Ga){this.Wq.off(S.updateNotification,Ga)}KOg(Ga){this.Wq.off(S.updatePersistentState,Ga)}JOg(Ga){this.Wq.off(S.wkd,Ga)}vRa(Ga){return this.Wq.invoke(T.vRa,Ga)}T$(Ga){return this.Wq.invoke(T.T$,
Ga)}sE(Ga,wa){return this.Wq.invoke(T.sE,Ga,wa)}sSb(Ga){return this.Wq.invoke(T.sSb,Ga)}updatePersistentState(Ga,wa){return this.Wq.invoke(T.updatePersistentState,Ga,wa)}}Object(I.a)(N,"RealtimeChannelProxy",null,[1809,1810,1811]);var V=e(1775),Z=e(87);class ca{constructor(Ga){this.Yfa=null;this.XW=0;this.Zga=!1;this.Le=Ga;this.Le.K0(Object(f.a)(this,this.bM,"onConnectionStateChanged"))}bM(Ga,wa){this.XW=wa.newState}ejd(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");
this.Le.ofb()}mYf(Ga){this.Yfa.init(Ga)}}Object(I.a)(ca,"ARtcMessageHandler",null,[]);var W=e(328),X=e(1722),ka=e(84);class ma{constructor(Ga,wa=""){this.IKb=Ga;this.g0=wa}send(){return this.IKb()}get messageId(){return this.g0}}Object(I.a)(ma,"MessageHandler",null,[1823]);var ja=e(1640);class na extends Sys.EventArgs{constructor(Ga,wa,xa,sa){super();this.V0b=Ga;this.reconnectDelay=wa;this.reason=xa;this.O1b=sa}}Object(I.a)(na,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var Ba=e(1718);class Ma{constructor(){this.jLb=
this.Ci=null}get qj(){return this.Ci?this.jLb?this.jLb.getTime()-this.Ci.getTime():(new Date).getTime()-this.Ci.getTime():0}start(){this.Ci=new Date}stop(){this.jLb=new Date}}Object(I.a)(Ma,"SimpleStopwatch",null,[]);var Ea=e(1723),ya=e(1915),ia=e(559),za=e(619),Ca=e(620);class db extends ca{constructor(Ga,wa,xa,sa,Ka,Na,ub,Ua,sb,qb){super(ub);this.Wq=null;this.RNc=this.SNc=!1;this.g0=0;this.EJb=new H.a;this.E1e=db.BLf();this.rJb=x.AFrameworkApplication.J.rb("OwningFeatureCrewForRtcNotificationKpis");
this.ef=Ga;this.cPc=this.bPc=0;this.Yfa=wa;this.Yfa.v8a(Object(f.a)(this,this.ejd,"onTooManyUndeliveredMessages"));this._clientId=xa;this.q8e=Ka;this.Le.Ejf(Object(f.a)(this,this.Vid,"onRefreshProxyRequired"));this.Le.Cjf(Object(f.a)(this,this.Uid,"onRefreshAllPersistentStateRequest"));this.Le.Ijf(Object(f.a)(this,this.sE,"sendUpdateNotification"));this.Le.fjf(Object(f.a)(this,this.yid,"onInternalPresenceUpdated"));this.Le.gjf(Object(f.a)(this,this.zid,"onInternalUpdateNotificationReceived"));this.Le.ejf(Object(f.a)(this,
this.xid,"onInternalPersistentStateUpdated"));this.Le.djf(Object(f.a)(this,this.wid,"onInternalPersistentStateCleared"));this.Le.Hjf(Object(f.a)(this,this.hGa,"sendPersistentState"));this.Le.Njf(Object(f.a)(this,this.T$,"updateClientInfo"));this.qe=Na;this.kl=sa;this.vl=Ua;this.Ex=sb;this.MIa=qb;this.jka=Object(Z.a)(String,x.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Vid(Ga,wa){this.Wq=this.q8e(wa.hubConnection);this.Yfa.reset();this.Wq.Mug(Object(f.a)(this,this.GW,"onPresenceUpdated"));
this.Wq.Lug(Object(f.a)(this,this.Cia,"onPersistentStateUpdated"));this.Wq.Kug(Object(f.a)(this,this.o0a,"onPersistentStateCleared"));this.Wq.Uug(Object(f.a)(this,this.fU,"onUpdateNotificationReceived"))}bM(Ga,wa){this.XW=wa.newState;2===wa.newState&&this.uBg()}uBg(){for(const Ga of this.EJb)this.sE(null,new Ba.a(Ga.key,Ga.value,!1,new a.a));this.EJb=new H.a}Uid(Ga,wa){wa.tOb();for(Ga=0;3>Ga;++Ga)this.oBg(Ga,wa)}oBg(Ga,wa){try{this.Wq.sSb(Ga).done(xa=>{wa.Aya(wa.BWa,"GetCompletePresenceSuccess")&&
(wa.Ytf.Okg(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.kl,Ga),this.Le.ntg(),this.gkg(Ga,xa),this.Le.$sg(xa),wa.T2c.Bb(Ga)&&this.Le.Kmd(Ga,wa.T2c.K(Ga),new a.a))}).fail(xa=>{const {RtcUtils:sa}=e(1406);wa.Aya(wa.BWa,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",sa.Soa(xa),this.kl,Ga),this.Le.ofb())}).always(()=>{wa.gB&&wa.gB.stop()})}catch(xa){m.ULS.sendTraceTag(595132428,
500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",wa.BWa,xa.message)}}hGa(Ga,wa){var {RtcUtils:xa}=e(1406);Ga=wa.tK;let sa;const Ka=wa.iqa;this.Ex.vu(1,0);try{sa=xa.qOb(Ga,this.MIa)}catch(ub){this.Ex.vu(1,3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",ub.message);Ka.setException(ub);return}xa=new z.a;xa.W(this._clientId,
Object.assign(new X.a,{Presence:Ga,TimeStamp:(new Date).getTime()}));this.Le.Mmd(wa.type,xa);if(2!==this.XW)this.vl.Uia(),this.Ex.vu(1,2),Ka.setResult(null);else{var Na=this.g0.toString();++this.g0;Ga=new ma(()=>this.vBg(wa.type,sa,Na),Na);Ga=this.Qud(0,wa.type).add(Ga);Ga.veb(ub=>{2===ub&&(this.Ex.vu(1,6),this.RNc||2!==wa.type||m.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.kl));Ka.setResult(null)});Ga.ueb(()=>{})}}vBg(Ga,wa,xa){let sa=
null;const Ka=new Ma,Na=new ja.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.kl,Ga);if(2!==this.XW)return this.vl.Uia(),this.Ex.vu(1,2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.kl,Ga),Na.aYb(),Na;this.qe&&20>this.bPc&&(sa=this.qe.rg("WebServiceCall","Send Presence Message"),this.bPc++);Ka.start();Na.uOa(1);try{this.Wq.updatePersistentState(Ga,wa).done(()=>{this.vl.tfb();this.Ex.vu(1,
1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",xa,this.kl,Ga);Na.K9(1);Ka&&(Ka.stop(),Ka.qj>this.ef.Mpd?this.Ex.vu(1,4):this.Ex.vu(1,5))}).fail(ub=>{const {RtcUtils:Ua}=e(1406);this.Zga||(this.vl.Uia(),this.Ex.vu(1,3),this.RNc||2!==Ga||m.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.kl),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
xa,Ua.Soa(ub),this.kl));Na.K9(2)}).always(()=>{sa&&sa.stop()})}catch(ub){m.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",ub.message),this.Ex.vu(1,3),this.RNc||2!==Ga||m.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.kl),Na.K9(2)}return Na}T$(Ga,wa){({RtcUtils:Ga}=e(1406));const xa=wa.m8h,sa=wa.iqa;let Ka;try{Ka=Ga.qOb(xa,this.MIa)}catch(Na){m.ULS.sendTraceTag(544318999,
500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Na.message);sa.setException(Na);return}try{this.Wq.T$(Ka).done(()=>{m.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(Na=>{const {RtcUtils:ub}=e(1406);this.Zga||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",ub.Soa(Na));sa.setResult(null)})}catch(Na){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",
Na.message),sa.setResult(null)}}sE(Ga,wa){({RtcUtils:Ga}=e(1406));const xa=wa.type,sa=wa.fC,Ka=wa.Fzf,Na=wa.iqa;let ub;this.Ex.vu(0,0);try{ub=Ga.qOb(sa,this.MIa)}catch(sb){this.Ex.vu(0,3);m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",sb.message);Na.setException(sb);return}if(2!==this.XW)Ka?this.EJb.W(xa,sa):(this.vl.Uia(),this.Ex.vu(0,2)),Na.setResult(null);else{var Ua=this.g0.toString();++this.g0;wa=new ma(()=>this.NBg(xa,ub,Ua),
Ua);wa=this.Qud(1,xa).add(wa);wa.veb(sb=>{2===sb&&this.Ex.vu(0,6);Na.setResult(null)});wa.ueb(()=>{})}}NBg(Ga,wa,xa){let sa=null;const Ka=new Ma,Na=new ja.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",this.kl,Ga);if(2!==this.XW)return this.vl.Uia(),this.Ex.vu(0,2),m.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.kl),Na.aYb(),Na;this.qe&&3===Ga&&20>this.cPc&&(sa=this.qe.rg("WebServiceCall","Send WetContent Update"),
this.cPc++);Ka.start();Na.uOa(1);this.Wq.sE(Ga,wa).done(()=>{this.vl.tfb();this.Ex.vu(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",xa,this.kl,Ga);Na.K9(1);Ka&&(Ka.stop(),Ka.qj>this.ef.Mpd?this.Ex.vu(0,4):this.Ex.vu(0,5))}).fail(ub=>{const {RtcUtils:Ua}=e(1406);this.Zga||(this.vl.Uia(),this.Ex.vu(0,3),m.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",xa,Ua.Soa(ub),
this.kl));Na.K9(2)}).always(()=>{sa&&sa.stop()});return Na}s_(){this.Wq.LOg(Object(f.a)(this,this.GW,"onPresenceUpdated"));this.Wq.KOg(Object(f.a)(this,this.Cia,"onPersistentStateUpdated"));this.Wq.JOg(Object(f.a)(this,this.o0a,"onPersistentStateCleared"));this.Wq.OOg(Object(f.a)(this,this.fU,"onUpdateNotificationReceived"))}Zzf(){this.dyg();this.Le.MFa(Object(f.a)(this,this.bM,"onConnectionStateChanged"));this.Le.Dwg(Object(f.a)(this,this.Vid,"onRefreshProxyRequired"));this.Le.Bwg(Object(f.a)(this,
this.Uid,"onRefreshAllPersistentStateRequest"));this.Le.Hwg(Object(f.a)(this,this.sE,"sendUpdateNotification"));this.Le.qwg(Object(f.a)(this,this.yid,"onInternalPresenceUpdated"));this.Le.rwg(Object(f.a)(this,this.zid,"onInternalUpdateNotificationReceived"));this.Le.pwg(Object(f.a)(this,this.xid,"onInternalPersistentStateUpdated"));this.Le.owg(Object(f.a)(this,this.wid,"onInternalPersistentStateCleared"));this.Le.Gwg(Object(f.a)(this,this.hGa,"sendPersistentState"));this.Le.Jwg(Object(f.a)(this,this.T$,
"updateClientInfo"))}yid(Ga,wa){this.GW(wa.aka,wa.d1c)}GW(Ga){this.vl.bxa();this.Cia(0,Ga)}xid(Ga,wa){this.Cia(wa.type,wa.aka)}gkg(Ga,wa){const xa={};for(const sa in wa)xa[sa]=wa[sa].Presence;this.Mid(Ga,xa,wa)}Cia(Ga,wa){this.vl.bxa();this.Mid(Ga,wa)}Mid(Ga,wa,xa=null){var {RtcUtils:sa}=e(1406);if(m.ULS.k6(500,100))for(var Ka in wa);delete wa[this._clientId];if(!ka.a.isEmpty(wa)){for(var Na in wa)Ka=Na,wa[Ka]=sa.deserialize(wa[Na],"Presence",Ka,!1,this.MIa);sa=new z.a;Na=(new Date).getTime();for(const ub in wa){Ka=
wa[ub];const Ua=ub;let sb;xa?(sb=xa[Ua],sb.Presence=Ka):sb=Object.assign(new X.a,{Presence:Ka,TimeStamp:Na});sa.W(Ua,sb)}this.Le.Mmd(Ga,sa);switch(Ga){case 0:this.SNc||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.kl),this.SNc=!0,x.AFrameworkApplication.Kg&&x.AFrameworkApplication.Kg.Mhj());this.Le.Gmd(wa,[]);break;case 2:this.RNc||(m.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.kl),this.RNc=!0);
this.Le.Fwe(Ga,wa);break;default:this.Le.Fwe(Ga,wa)}}}wid(Ga,wa){this.o0a(wa.Tpb)}o0a(Ga){this.vl.bxa();if(m.ULS.k6(500,100))for(let wa=0;wa<Ga.length;++wa);Ga.length&&(this.Le.qtg(Ga),this.Le.itg(Ga),this.Le.Gmd({},Ga))}zid(Ga,wa){this.fU(wa.type,wa.fC)}fU(Ga,wa=null){this.ef.IFg&&0===Ga&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Ga&&this.rJb&&0<this.rJb.length){var xa=Object.assign(new ia.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.rJb,vetoPillar:"RealTimeCoauth"});(xa=W.a.getInstance(xa))&&xa.logKpiUsage(this.E1e)}this.ef.JFg&&13===Ga&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",wa||"<none>"));this.vl.bxa();5===Ga?(wa=(Ga=this.rng(wa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Ga.reason,Ga.reconnectDelay):"Received client reconnection request from the server without params.",
m.ULS.sendTraceTag(18637071,500,50,wa),this.Le.ofb(Ga)):(wa=e(1406).RtcUtils.deserialize(wa,String.format("UpdateNotification-{0}",ya.a[Ga]),null,!1,this.MIa),this.Le.ptg(Ga,wa))}rng(Ga){try{if(!Ga||""===Ga)return null;const wa=JSON.parse(Ga);return new na(wa[Ea.a.w1b],wa[Ea.a.Fzg],wa[Ea.a.Izg],wa[Ea.a.O1b])}catch(wa){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",wa.message),null}}Qud(Ga,wa){return this.Yfa.hSf(this.iSf(Ga,wa))}iSf(Ga,wa){return Ga+","+wa}dyg(){this.Yfa.reset();
this.Yfa.qod(Object(f.a)(this,this.ejd,"onTooManyUndeliveredMessages"))}static BLf(){var Ga=new Map;Ga.set("SkipAria","True");Ga=Object.assign(new za.a,{extendedProperties:Ga});return Object.assign(new Ca.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Ga,blockFutureEmissionDurationInMs:3E5})}}Object(I.a)(db,"RtcMessageHandler",ca,[]);class pa{B_c(Ga,wa=""){const {MaxOutstandingThrottler:xa}=e(1719);return xa.createInstance(Ga,wa)}Dwf(Ga,wa=""){const {MaxRateThrottler:xa}=
e(1721);return xa.createInstance(Ga,wa)}}Object(I.a)(pa,"ThrottlerFactory",null,[1808]);e.d(K,"RealtimeChannel",function(){return ua});class ua{constructor(Ga,wa,xa,sa,Ka,Na,ub,Ua,sb,qb,ab,Xa){this.iLb=!1;this.uJ=null;this.IA=new z.a;this.Yya=1;this.tka=null;this.Vm=!1;this.dac=(new Date(0)).getTime();this.wnb=0;this.Ctd=()=>{const wb=this.Yya;this.iLb=!1;this.vl.Zmd();this.jaa.GQf(this.Wtf,this.fid,Object(f.a)(this.K2,this.K2.mYf,"initThrottlerManager"),Object(f.a)(this,this.Aya,"verifyConnectionToken"),
wb)};this.fid=(wb=null)=>{this.vl.bnd();let Sa=null;!wb||"documentsessiondeleted"!==(Sa=wb.toLowerCase())&&"documentsessionexpired"!==Sa?this.KLa():(m.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.kl,wb),this.disconnect())};this.KLa=(wb,Sa=null)=>{m.ULS.sendTraceTag(508396224,500,50,"Disconnecting the connection [{0}]",this.uJ);wb=(wb=2===this.Hk||1===this.Hk)&&!this.K2.Zga;let cc=!0,Cb=
0;Sa&&Object.getType(Sa)!==Object.getType(Sys.EventArgs.Empty)&&Sa.V0b&&""!==Sa.V0b&&(wb=!0,this.jaa.TDg(Sa.V0b),cc=Sa.O1b,Cb=Sa.reconnectDelay);wb&&this.bM(1,this.Hk);++this.Yya;this.K2.s_();this.iJg(cc);this.jaa.iBf();this.D_c();wb&&window.setTimeout(this.Ctd,Math.min(Cb,3E4))};this.kwd=()=>{let wb=null;const Sa=({correlationId:wb}=this.jaa.R5c()).returnValue;this.tka.qs=Sa;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.kl,wb)};
this.Wtf=wb=>{const {FrequentLoggingMetrics:Sa}=e(1452);this.dac=(new Date).getTime();let cc=null;this.tka.qs=({correlationId:cc}=this.jaa.R5c()).returnValue;this.ef.pWh&&(this.tka.url=wb,Sa.instance&&(Sa.instance.lZc=v.a.dW(wb)));let Cb=null;this.qe&&(Cb=this.qe.rg("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.kl);wb={};this.WTc&&(wb.transport=1===this.WTc.length?this.WTc[0]:this.WTc);wb.pingInterval=null;E.a.instance.KPa(1,0);
wb.waitForPageLoad=!1;this.tka.start(wb,null).done(Wa=>{this.vl.cnd();E.a.instance.KPa(1,1,!0);m.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Wa.id,cc)}).fail(Wa=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.jaa.Lx,cc,this.kl);this.fid();this.vl.$md(Wa);E.a.instance.KPa(1,1,!1);this.Le.Imd(0,{["CorrelationId"]:cc,["ErrorDetails"]:Wa,["ConnectionState"]:w.a[this.Hk]})}).always(()=>
{const {FrequentLoggingMetrics:Wa}=e(1452);Cb&&Cb.stop();Wa.instance&&(Wa.instance.eGb=!1)})};this.hjd=(wb,Sa)=>{for(const cc of Sa.xQg)this.IA.Bb(cc.key)||this.IA.W(cc.key,new H.a),wb=cc.value,this.IA.K(cc.key).W(Sa.type,new y(wb.Presence,new Date(wb.TimeStamp))),cc.key===this._clientId&&0===Sa.type&&this.Le.dtg(wb.Presence)};this.gjd=(wb,Sa)=>{for(const cc of Sa.Tpb)this.IA.remove(cc)};this.tOb=()=>{let wb;const Sa=[];({value:wb}=this.IA.Nc(this._clientId)).returnValue&&this.IA.remove(this._clientId);
for(const cc of this.IA.keys)Array.add(Sa,cc);for(const cc of Sa)this.IA.remove(cc);wb&&this.IA.W(this._clientId,wb);this.Le.btg(Sa)};this._clientId=Ga;this.WTc=wa;this.Hk=0;this.qe=sa;this.UEb=Ua;this.j$e=ub;this.BMe=sb;this.cRe=Ka;this.jaa=Na;this.kl=xa;this.vl=qb;this.ef=ab;this.$f=Xa;this.KSc=1>100*Math.random()}get xda(){return this.jaa.xda}set xda(Ga){this.jaa.xda=Ga}get K2(){return this.j$e}get Le(){return this.BMe}init(){this.Le.Djf(this.KLa);this.Le.Pjf(this.hjd);this.Le.Ojf(this.gjd);this.$f.m8a(this.vl);
x.AFrameworkApplication.IG(()=>{const {FrequentLoggingMetrics:Ga}=e(1452);this.vl.t0b();Ga.instance&&Ga.instance.MXb()});this.D_c();this.L_l();this.Le.Jjf(this.kwd)}L_l(){try{const xa=$.signalR;if(!xa)throw Error.invalidOperation("Failed to retrieve Signalr object");const sa=xa.version;if(!sa)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===sa){var Ga=xa.transports;if(!Ga)throw Error.invalidOperation("Failed to retrieve transports object");var wa=Ga.longPolling;
if(!wa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!wa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");wa.supportsKeepAlive=this.wQl()}}catch(xa){m.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",xa.message)}}wQl(){return()=>!1}D_c(){const Ga=++this.Yya;this.dac=(new Date(0)).getTime();this.tka=this.cRe();this.Le.mtg(this.tka);this.tka.stateChanged(wa=>{this.lig(wa,Ga)});
this.tka.connectionSlow(Object(f.a)(this,this.tre,"onSlowConnection"));this.tka.error(Object(f.a)(this,this.rre,"onSignalRError"));this.tka.log=Object(f.a)(this,this.sre,"onSignalRLog")}Aya(Ga,wa){return Ga!==this.Yya?(m.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",wa),!1):!0}connect(){2!==this.Hk&&1!==this.Hk&&(m.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.kl),this.UEb.kig(),E.a.instance.OIg(),this.bM(1,this.Hk),this.Ctd())}disconnect(){const {FrequentLoggingMetrics:Ga}=
e(1452);0===this.Hk?m.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.kl):(this.vl.dnd(),Ga.instance&&(Ga.instance.eGb=!0),m.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.kl),this.K2.Zga=!0,this.UEb.xig(),this.bM(0,this.Hk),this.KLa(),this.K2.Zga=!1)}iJg(Ga){const wa=this.$pf(),xa=this.tka,sa=this.uJ,Ka=()=>{if(this.iLb)m.ULS.sendTraceTag(508396191,500,15,"Stop connection was called twice, possibly on the same connection.");
else try{this.iLb=!0,xa.stop(!0,Ga)}catch(Na){m.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",Na.message)}};0<wa?(m.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",sa,wa),window.setTimeout(Ka,wa)):(m.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",sa),Ka())}$pf(){let Ga=0;0===this.tka.state&&(Ga=this.dac+ua.Qgk-(new Date).getTime(),0>Ga&&(Ga=0));return Ga}get connectionState(){return this.Hk}K0(Ga){this.Le.K0(Ga)}MFa(Ga){this.Le.MFa(Ga)}wBg(Ga){this.hGa(0,
Ga)}hGa(Ga,wa){const xa=new a.a;this.Le.Kmd(Ga,wa,xa);return xa.task}jBa(Ga){this.Le.jBa(Ga)}A1a(Ga){this.Le.A1a(Ga)}Cob(Ga){this.Le.Cob(Ga)}Rzb(Ga){this.Le.Rzb(Ga)}Bob(Ga){this.Le.Bob(Ga)}Qzb(Ga){this.Le.Qzb(Ga)}Mnc(Ga){return this.LSf(Ga,0)}Ssb(){return this.Rsb(0)}Rsb(Ga){const wa={};for(const xa of this.IA)xa.value.Bb(Ga)&&(wa[xa.key]=xa.value.K(Ga).data);return wa}LSf(Ga,wa){return this.IA.Bb(Ga)&&this.IA.K(Ga).Bb(wa)?this.IA.K(Ga).K(wa).data:null}TJf(){const Ga=new H.a;if(!this.IA.Bb(this._clientId))return Ga;
for(const wa of this.IA.K(this._clientId))Ga.W(wa.key,wa.value.data);return Ga}sE(Ga,wa=null,xa=!1){const sa=new a.a;this.Le.e0b(Ga,wa,xa,sa);return sa.task}CQ(Ga){this.Le.CQ(Ga)}OFa(Ga){this.Le.OFa(Ga)}yYa(Ga){let wa,xa;return({value:wa}=this.IA.Nc(Ga)).returnValue&&({value:xa}=wa.Nc(0)).returnValue?new u.a(this.MSf(xa),xa.timeStamp):null}Hlc(){const Ga={};for(const wa of this.IA)wa.value.Nc(0).returnValue&&(Ga[wa.key]=this.yYa(wa.key));return Ga}T$(Ga){const wa=new a.a;this.Le.Hwe(Ga,wa);return wa.task}get clientId(){return this._clientId}get EHg(){return this.KSc}dispose(){var Ga;
const {FrequentLoggingMetrics:wa}=e(1452);if(!this.Vm){if(null===(Ga=x.AFrameworkApplication.J)||void 0===Ga?0:Ga.$("DetachRtcEventHandlerOnDispose"))this.Yzf(),this.K2.Zzf();this.K2.s_();this.$f.Xxc(this.vl);this.vl.t0b();wa.instance&&wa.instance.MXb();this.Vm=!0}}lig(Ga,wa){this.Aya(wa,"StateChangedSignalR")&&this.bM(this.OZc(Ga.newState),this.OZc(Ga.oldState))}bM(Ga,wa){var {FrequentLoggingMetrics:xa}=e(1452),{ClientToClientMessageTelemetry:sa}=e(1790);if((1!==this.Hk||0!==wa||1!==Ga)&&this.Hk!==
wa){const Ka=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.Hk,wa,Ga]));m.ULS.sendTraceTag(508396188,500,10,Ka)}if(this.Hk!==Ga){switch(Ga){case 2:xa.instance&&xa.instance.Fag();this.uJ=this.tka.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.uJ,this.kl);this.s$f(this.tka);m.ULS.sendTraceTag(508396186,500,50,"Retrieving complete session state");xa=null;
this.qe&&(xa=this.qe.rg("WebServiceCall","Receive First Presence"));sa=this.Yya;this.Le.ltg(Object(f.a)(this,this.Aya,"verifyConnectionToken"),sa,this.UEb,this.tOb,this.TJf(),xa);this.ef.Gzg&&(xa=100*Math.random()<=this.ef.Hzg,e(1790).ClientToClientMessageTelemetry.Ctb(this.Le,this.ef,xa).start());break;case 1:2===wa&&m.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.uJ);break;case 0:if(sa.instance&&sa.instance.stop(),this.K2.Zga)m.ULS.sendTraceTag(508396182,
500,50,"Connection [{0}] has been explicitly closed",this.uJ);else{1===wa&&(m.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.uJ),this.vl.fnd());2===wa&&m.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.uJ);this.KLa();return}}this.Hk=Ga;
this.Le.Wsg(Ga,wa)}}Yzf(){this.Le.Cwg(this.KLa);this.Le.Lwg(this.hjd);this.Le.Kwg(this.gjd);this.Le.Iwg(this.kwd)}s$f(Ga){if(Ga&&Ga.transport&&Ga.transport.name){Ga=Ga.transport.name;var wa=Ga.toLowerCase();"websockets"===wa?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Ga,this.kl):"serversentevents"===wa?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Ga,this.kl):"foreverframe"===wa?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Ga,this.kl):
"longpolling"===wa?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Ga,this.kl):"mocktransport"!==wa&&m.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",Ga)}else m.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}tre(){if(this.ef.Opd){const Ga=v.a.LL(this.xda,"mid");m.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.uJ,Ga)}else m.ULS.sendTraceTag(508396177,500,50,
"Detected that the connection [{0}] is slow",this.uJ)}rre(){m.ULS.sendTraceTag(508396176,600,15,"SignalR ERROR for connection [{0}];",this.uJ)}sre(Ga){Ga=e(1406).RtcUtils.Soa(Ga);if(this.ef.Opd&&Ga.startsWith("Keep alive timed out.")){const wa=v.a.LL(this.xda,"mid");m.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",Ga,wa)}else this.EHg&&2E3>this.wnb&&!Ga.startsWith("Invok")&&!Ga.startsWith("Trigger")&&(m.ULS.sendTraceTag(508396174,500,50,"SignalR lib: {0}",Ga),this.wnb++)}OZc(Ga){switch(Ga){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Ga,"Unknown SignalR state");}}MSf(Ga){return Ga&&Ga.timeStamp?(new Date).getTime()-Ga.timeStamp.getTime()>(this.ef.gnf?6E4:this.ef.fnf)?2:1:1}static createInstance(Ga,wa,xa,sa,Ka,Na,ub,Ua=null,sb=null,qb=null,ab,Xa=null,wb=null){return ua.QLl(Ga,wa,xa,wb,sa,Ka,Na,ub,Ua,sb,qb,Xa)}static QLl(Ga,wa,xa,sa,Ka,Na,ub,Ua,sb=null,qb=null,ab=null,Xa=null){const wb=G.createInstance(x.AFrameworkApplication.J),Sa=x.AFrameworkApplication.buildVersion?
x.AFrameworkApplication.buildVersion:"1.0",cc=ua.aJf(Ga,wa,ub),Cb=wb.msf?e(1914).RealtimeChannelMetrics.createInstance(cc):new P;var Wa=e(1452).FrequentLoggingMetrics.create(Ka);wb.Kzg&&Wa.NIg(wb.Jzg);var Ja="";Ja=sb&&""!==sb?sb:"/rtc2/";Wa.C3c=v.a.dW(Ja);const Va=Ja+"signalr";sb=Ja+"findsession";const mb=T.UWf;Ja=new pa;ab=ab||V.a.getInstance();m.ULS.shipAssertTag(508396228,500,wb.Ppd<=D.a.fgd,"Client attempting to override max payload size beyond absolute limit");const Ab=Math.min(wb.Ppd,D.a.fgd);
Wa.egd=Ab;Wa=new db(wb,new F(Ja),Ga,cc,Xb=>new N(Xb.createHubProxy(mb)),Ua,ab,Cb,Wa,Ab);qb||(qb=e(2001).FindSessionStrategy.createInstance(wa,Ka,sb,Ua,Sa,ub,Ga,cc,ab,Na,sa,Xa));qb.Y$a=wb.Y$a;wa=new Y(cc);xa=xa?xa.split(","):null;Ga=new (e(1999).RealtimeChannel)(Ga,xa,cc,Ua,()=>$.hubConnection(Va),qb,Wa,wa,ab,Cb,wb,Ka);Ga.init();return Ga}static aJf(Ga,wa,xa){return String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Ga,this.KXc(l.a[xa]),this.KXc("browser"),wa)}static KXc(Ga){return Ga?
Ga.charAt(0).toLocaleUpperCase()+Ga.substring(1,Ga.length):Ga}}ua.Qgk=15E3;Object(I.a)(ua,"RealtimeChannel",null,[1789,1579])},2001:function(I,K,e){e.r(K);I=e(0);var m=e(8),f=e(118),a=e(76),l=e(910);class w{}w.pwa="throttling_messageDelay";w.ZNa="enabled";w.L$="throttling_timeToWaitForResponse";w.kwa="throttling_maxNumberOfOutstandingMessages";w.X7c="throttling_globalMaxNumberOfOutstandingMessages";w.errorMessage="errorMessage";w.dtd="url";w.BR="queryString";w.Lx="connectionString";w.xzc="netcore";
Object(I.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var z=e(2),x=e(43),u=e(59),v=e(1259),E=e(84),y=e(16),H=e(127);class D{constructor(){this.Y7c=this.cgd=this.dgd=this.ggd=0;this.Vcb=!1;this.correlationId=this.Lx=this.BR=this.KOb=this.errorMessage=null}get Dtf(){return this.KOb+"?"+this.BR}}Object(I.a)(D,"FindSessionResponse",null,[]);var G=e(613);class J{constructor(W,X,ka,ma,ja,na){this.H7=null;this.s8e=W;W=String.format("{0}={1}",G.a.clientId,y.a.nj(ma));W=String.format("{0}&{1}={2}",
W,G.a.userSessionId,y.a.nj(ja));W=String.format("{0}&{1}={2}",W,G.a.kJe,y.a.nj(ka.toString()));W=String.format("{0}&{1}={2}",W,G.a.userType,y.a.nj("1"));W=String.format("{0}&{1}={2}",W,G.a.qJe,y.a.nj(X));W=String.format("{0}&{1}={2}",W,G.a.uZd,y.a.nj(J.dzl));(X=J.U4c(ka,na))&&(W=String.format("{0}&{1}",W,X));this.dRe=W}nnd(){this.H7=this.s8e()}generate(){this.H7&&""!==this.H7||(this.nnd(),m.ULS.sendTraceTag(575784194,500,this.H7&&""!==this.H7?50:15,"Query signature delegate called for refresh returned: {0} ",
this.H7));const W=String.format("{0}={1}",G.a.nfb,y.a.nj(this.H7));return String.format("{0}&{1}",W,this.dRe)}static U4c(W,X){return 4===W?String.format("{0}={1}",G.a.Aoe,"1"):X?X.NSf():null}}J.dzl="1.0";Object(I.a)(J,"FindSessionQueryStringGenerator",null,[]);var U=e(1452),F=e(1597),T=e(1406),Y=e(1724);class P{}P.LGf="FSType";Object(I.a)(P,"RtcFindSessionRequestHeaders",null,[]);class S{}S.ztg="polling";Object(I.a)(S,"RtcFindSessionTypes",null,[]);var N=e(1723);class V{}V.uRg="RTC-TokenProofkey";
V.E5f="RTC-IsWacJsBootFsRequest";Object(I.a)(V,"RtcRequestHeaders",null,[]);var Z=e(70);e.d(K,"FindSessionStrategy",function(){return ca});class ca{constructor(W,X,ka,ma,ja,na,Ba,Ma,Ea,ya,ia,za,Ca=null){this.hNc=(new Date(0)).getTime();this.bOc=0;this.f6a=!1;this.rSc=null;this.B0b=36E5;this.bra=ca.t$c;this.lIa=0;this.eja=null;this.XW=0;this.xxa=this.mZc=null;this.x9e=[w.ZNa,w.errorMessage,w.dtd,w.Lx,w.BR,w.X7c,w.kwa,w.L$,w.pwa];this.w9e=[w.ZNa,w.errorMessage];this.Lx=this.xda=null;this.oKc=new J(ia?
ia:()=>z.AFrameworkApplication.lm,ja,na,Ba,W,X);this.IHa=za;this.qe=ma;this.$f=X;this.pKc=ka;this.kl=Ma;this.Le=Ea;this.zza=Ca;this.qKc=!1;this.Y$a=9E4;ya&&ya.execute(db=>{db.HVa(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.kl);this.oKc.nnd()})});2>=100*Math.random()&&(this.B0b=3E5);U.FrequentLoggingMetrics.instance&&(U.FrequentLoggingMetrics.instance.q4c=this.B0b)}TDg(W){this.xxa=W}init(){this.Le.Fjf(Object(f.a)(this,this.gyg,"resetGetMachineIdDelay"));
this.Le.K0(Object(f.a)(this,this.bM,"onConnectionStateChanged"))}bM(W,X){this.XW=X.newState;2===X.newState&&(this.lIa=0)}R5c(){let W;W=this.eja.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.eja.BR,ca.E0d,y.a.nj(W)),correlationId:W}}GQf(W,X,ka,ma,ja){this.nBg(()=>{ma(ja,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.Lx,this.kl),W(this.rSc),ka(this.jSf()))},na=>{ma(ja,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,
500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.kl),X(na))},ma,ja)}iBf(){this.sYc();this.TXf()}nBg(W,X,ka,ma){m.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.Lx);if(this.Lx)W();else{var ja=this.Upf();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(W,X,ka,ma)},ja)}}sendFindSessionRequestToServerInternal(W,X,ka,ma){ka(ma,"RequestMachineId")&&(this.hNc=(new Date).getTime(),ka=u.a.We(),
this.CSb(ja=>{const na=u.a.We();this.ckd(ja);this.i2b();W();ja=u.a.We()-na;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ja)},ja=>{const na=u.a.We();this.sYc();U.FrequentLoggingMetrics.instance&&U.FrequentLoggingMetrics.instance.vu(2,3);X(ja);ja=u.a.We()-na;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ja)},!1),ka=u.a.We()-ka,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ka))}TXf(){this.bra+=ca.HOf;this.bra=Math.min(this.bra,ca.Rag)}Upf(){var W=
(new Date).getTime();W=this.hNc+this.bra-W;0>W&&(W=0);return W}ckd(W){try{this.eja=W,this.xda=W.Dtf,this.Lx=W.Lx,this.mZc=W.BR,this.rSc=W.KOb}catch(X){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",X.toString())}}sYc(){this.Lx=null;this.tYc()}i2b(){this.tYc();this.f6a=!0;this.bOc=window.setTimeout(Object(f.a)(this,this.jug,"refreshMachineId"),this.B0b)}tYc(){this.f6a&&(window.clearTimeout(this.bOc),this.f6a=!1)}jug(){this.f6a=!1;this.CSb(W=>
{const X=this.mZc!==W.BR,ka=this.Lx!==W.Lx,ma=this.Lx;this.ckd(W);0!==this.XW&&(ka?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ma||"null",W.Lx),this.Le.ofb()):(this.Le.otg(X,ka),this.i2b()))},()=>{U.FrequentLoggingMetrics.instance&&U.FrequentLoggingMetrics.instance.vu(2,3);this.i2b()},!0)}gyg(){this.bra=ca.t$c}jSf(){return new Y.a(this.eja.ggd,this.eja.dgd,this.eja.cgd,this.eja.Y7c)}yNg(W){if(Object.getType(W)!==Object)return null;
for(let X in W);return this.dwf(W)}dwf(W){if(!(w.ZNa in W))return null;const X=W[w.ZNa];var ka=X?this.x9e:this.w9e;for(const ma of ka)if(!(ma in W))return null;ka=Object.assign(new D,{Vcb:W[w.ZNa],errorMessage:W[w.errorMessage],correlationId:H.a.create().toString()});X&&(ka.KOb=W[w.dtd],ka.BR=W[w.BR],ka.Lx=W[w.Lx],ka.Y7c=W[w.X7c],ka.cgd=W[w.kwa],ka.dgd=W[w.L$],ka.ggd=W[w.pwa]);return ka}RMf(W,X){m.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.zza.N6d.continueWith(()=>
{this.zza.N6d.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),W(this.zza.O6d)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),X(this.zza.O6d))})}Uod(W,X,ka,ma,ja=!1){return na=>{F.a.instance.KPa(0,1);W&&W.stop();this.IHa=this.xxa=null;this.tfd(na.data,!0,X);var Ba=T.RtcUtils.deserialize(na.data.responseData,"FindSession",null);if(Ba)if(Ba=this.yNg(Ba)){if(Ba.Vcb&&Ba.BR&&Ba.Lx){m.ULS.sendTraceTag(4317446,500,50,
"Successfully retrieved MachineId from server for [{0}]",this.kl);this.I9f(na.data);ka(Ba);return}X.FindSessionFailureReason="FindSessionInvalidResponse";X.IsRtcEnabled=Ba.Vcb;X.IsQueryStringEmpty=!Ba.BR;X.IsConnectionStringEmpty=!Ba.Lx;m.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.kl,Ba.Vcb,!Ba.BR,!Ba.Lx)}else X.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",
m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.kl);else X.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.kl);this.Jmd(X,ja);ma(null)}}Rod(W,X,ka,ma=!1){return ja=>{F.a.instance.KPa(0,1);W&&W.stop();this.IHa=this.xxa=null;this.tfd(ja.data,!1,X);let na=null;var Ba="unknown";let Ma="unknown";ja.data&&((Ba=ja.data.Pi)&&ca.WPa in Ba&&
(na=Ba[ca.WPa].toString()),Ba=v.a[ja.data.status],Ma=ja.data.Xe.toString());X.FindSessionFailureReason="FindSessionRequestFailed";X.HttpErrorCode=Ma;X.HttpErrorStatus=Ba;X[ca.WPa]=na;m.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",Ba,Ma,this.kl,na,ma);this.Jmd(X,ma);ka(Ma)}}CSb(W,X,ka=!1){let ma=null;m.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.kl);const ja={};var na=
this.oKc.generate();ja[Z.a.u4]=H.a.create().toString();this.xxa&&""!==this.xxa?na=String.format("{0}&{1}={2}",na,N.a.w1b,this.xxa):this.IHa&&""!==this.IHa&&(na=String.format("{0}&{1}={2}",na,N.a.w1b,this.IHa),ja[V.uRg]="True",ja[V.E5f]="True");na=this.pKc+"?"+na;ka&&(ja[P.LGf]=S.ztg);const Ba={};Ba.IsNetworkOfflineBeforeSendRequest=this.$f.Eva;Ba.HasAvailableConnectionsBeforeSendRequest=this.$f.H8c;Ba.MaxConnectionsAllowed=this.$f.maxConnections;Ba.IsRefreshMachineId=ka;this.zza&&!this.qKc?(this.RMf(this.Uod(null,
Ba,W,X,ka),this.Rod(null,Ba,X,ka)),this.qKc=!0):(this.qe&&(ma=this.qe.rg("WebServiceCall","GetMachineIdFromTheServer")),U.FrequentLoggingMetrics.instance&&U.FrequentLoggingMetrics.instance.vu(2,0),0>this.$f.o8a(na,1,null,ja,[ca.J9a,ca.WPa,ca.LOa,ca.v1b,ca.msEdgeRef,ca.officeFE,ca.Dhd],1,this.Uod(ma,Ba,W,X,ka),this.Rod(ma,Ba,X,ka),null,!1,null,this.Y$a,"3",null,!0)&&(5<this.lIa&&200>this.lIa&&m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.lIa),window.setTimeout(()=>{this.lIa++;X("-1")},1E3)))}tfd(W,X,ka){ka||(ka={});ka.IsNetworkOfflineAfterRequestComplete=this.$f.Eva;ka.IsRequestSucceeded=X;W&&(ka.EnqueueTime=W.iua,ka.InvokedTime=W.ZI,ka.CompletedTime=W.MQ,W.Pi&&(ca.J9a in W.Pi&&(ka.CorrelationId=W.Pi[ca.J9a]),ca.LOa in W.Pi&&(ka[ca.LOa]=W.Pi[ca.LOa])));m.ULS.sendTraceTag(38633565,500,X?50:15,T.RtcUtils.Soa(ka))}Jmd(W,X){W||(W={});W.ConnectionState=l.a[this.XW];X||this.Le.Imd(1,W)}I9f(W){try{var X=!1,ka=!1,ma=W.Pi,ja=x.a.dW(W.request.get_url());
if(ma&&ca.v1b in ma){const ya=ma[ca.v1b].toString().toLocaleLowerCase();ka="true"===ya;X="false"===ya}ma=!1;const Ea=0<=ja.toLocaleLowerCase().indexOf("collab");ka&&!Ea?ma=!0:X&&Ea&&(ma=!0);if(ma){X={};X.HostName=ja;X.Status=v.a[W.status];X.HttpStatus=W.Xe.toString();var na=W.request.get_headers();for(let ya in na){var Ba=na[ya];(ja=ya)&&0<ja.length&&(ka=0,Ba&&(ka=Ba.toString().length),X["r_"+ja]=ka)}if(W.Pi){const ya=new a.a;ya.add(ca.J9a);ya.add(ca.LOa);ya.add(ca.WPa);ya.add(ca.officeFE);ya.add(ca.Dhd);
ya.add(ca.msEdgeRef);ca.wif(X,W.Pi,ya)}ca.sif(W.request.get_url(),X);var Ma=E.a.toJSON(X);m.ULS.sendTraceTag(559437006,500,15,Ma)}}catch(Ea){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Ea.toString())}}static createInstance(W,X,ka,ma,ja,na,Ba,Ma,Ea,ya,ia,za=null){return ca.wwf(W,X,ka,ma,ja,na,Ba,Ma,Ea,ya,null,ia,za)}static wwf(W,X,ka,ma,ja,na,Ba,Ma,Ea,ya,ia,za,Ca=null){W=W||H.a.create().toString();W=new ca(W,X,ka,ma,ja,na,Ba,Ma,Ea,ya,ia,za,Ca);W.init();return W}static wif(W,
X,ka){for(let ma of ka)ma in X&&(W[ma]=X[ma])}static sif(W,X){if(W){var ka=W.indexOf("?");if(-1!==ka)for(W=W.substr(ka+1).split("&"),ka=0;ka<W.length;++ka){var ma=W[ka].split("=");if(2===ma.length){const ja=ma[0];if(ja&&0<ja.length){let na=0;if(ma=ma[1])na=ma.length;X["q_"+ja]=na}}}}}}ca.HOf=3E3;ca.Rag=3E5;ca.t$c=1E3;ca.J9a="X-CorrelationId";ca.E0d="corrid";ca.WPa="RtcErrorCode";ca.LOa="X-OfficeCluster";ca.v1b="X-NewEnv";ca.msEdgeRef="X-MSEdge-Ref";ca.Dhd="X-OFFICEFD";ca.officeFE="X-OfficeFE";Object(I.a)(ca,
"FindSessionStrategy",null,[1805])},2142:function(I,K,e){e.r(K);var m=e(2),f=e(0);class a{constructor(Ha,eb){this.nAa=null;this.Eia=()=>{a.pZh(this.nAa.Tsb())&&(this.nAa.Mwg(this.Eia),this.hPk.IsRealCoauthSession=!0)};this.pQc=Ha;this.hPk=eb}init(){this.pQc.continueWith(()=>{this.nAa=this.pQc.result;this.nAa.hfc(this.Eia)})}static pZh(Ha){let eb=null;for(const rc of Ha)if(rc)if(Ha=rc.isAnonymous||!rc.email?rc.clientId:rc.email.toUpperCase(),!eb)eb=Ha;else if(eb!==Ha)return!0;return!1}}Object(f.a)(a,
"CoauthTelemetry",null,[775]);var l=e(8),w=e(347),z=e(87),x;(function(Ha){Ha[Ha.N0p=0]="badStatePreventedTelemetry";Ha[Ha.notImplemented=1]="notImplemented";Ha[Ha.Brq=2]="renderHandled";Ha[Ha.Crq=3]="renderHandledWithVeto"})(x||(x={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",x);var u=e(90),v=e(84),E=e(144);class y{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){this.MEh=this.Ygh=this.XG=null;this.Tre=()=>{this.Eia()};this.ljg=()=>{const lf=this.an.Gw("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,
325,!!this.RRd);const Af=this.RRd-lf,mg={};mg.InteractiveTime=lf;mg.ReactRenderComplete=this.RRd;mg.HadTabSwitch=this.wEb();mg.IsModernGallery=this.rUc;l.ULS.sendTraceTag(594883104,325,20,v.a.toJSON(mg));this.rUc?(l.ULS.sendTraceTag(42062997,325,15,Af.toString()),this.zQd.mX(this.EMp(Af)?3:2)):l.ULS.sendTraceTag(594883103,325,15,Af.toString())};this.daa=Ha;this.zQd=new w.a;this.za=rc;this.DQe=eb;this.f3=Uc;this.an=bd;this.b7e=Hd;this.umb=Pe;this.Stk=Le;this.mqh=this.gqh=!1;this.RRd=0;this.Wgh=1;this.wEb=
De;this.rUc=this.za.$("PeoplesWellExtraButtonInfoIsEnabled");this.jka=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get M2j(){return this.zQd.task}init(){E.Task.WAA.call(null,this.umb,this.DQe,this.b7e).continueWith(()=>{this.XG=this.umb.result;this.Ygh=this.DQe.result;this.MEh=this.b7e.result;E.Task.WAA.call(null,this.DQe.result.thc,this.b7e.result.w6j).continueWith(()=>{this.Wgh=this.Ygh.thc.result;this.RRd=this.MEh.w6j.result;this.XG.hfc(this.Tre);this.XG.Tsb().length&&
this.Eia()})})}Eia(){this.Stk(this.XG.Tsb())?(this.XG.Mwg(this.Tre),this.S4n(this.gqh)):this.zQd.mX(1);this.gqh=!0}S4n(Ha){this.mqh?this.M2j.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",x[this.M2j.result])}):(this.mqh=!0,this.fqo(0===this.Wgh&&!Ha))}fqo(Ha){Ha?this.f3.Zk(4,this.ljg):this.zQd.mX(1)}EMp(Ha){const eb=Ha>this.za.sc("CoauthorGalleryTimeToRenderDurationMs",1E4);var rc="Word"===this.jka;const Uc="PowerPoint"===this.jka;
if(this.wEb())return l.ULS.sendTraceTag(50455714,325,50,eb.toString()),!1;rc&&u.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);eb&&(rc&&u.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),rc=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Uc&&rc&&Ha<this.za.sc("CoauthorGalleryTimeToRenderCutoffThresholdMs",
3E4)&&u.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),l.ULS.sendTraceTag(42062998,325,15,Ha.toString()));return eb}}Object(f.a)(y,"CoauthorGalleryTelemetry",null,[776]);class H{constructor(Ha){this.XG=null;this.oBd={};this.HMd={};this.TLc=null;this.Eia=()=>{this.udk()};this.BDl=(eb,rc)=>eb.l_a>rc.l_a?1:eb.l_a<rc.l_a?-1:0;this.umb=Ha}Jae(Ha){const eb=new w.a;this.init().continueWith(()=>{Ha in this.oBd?eb.mX(this.oBd[Ha]):
this.HMd[Ha]=eb});return eb.task}init(){if(this.TLc)return this.TLc.task;this.TLc=new w.a;this.umb.continueWith(()=>{this.XG=this.umb.result;this.XG.hfc(this.Eia);this.udk();this.TLc.setResult(null)});return this.TLc.task}udk(){const Ha=this.XG.Tsb();Ha.sort(this.BDl);this.oBd={};for(let eb=0;eb<Ha.length&&Ha[eb]&&Ha[eb].l_a;eb++)this.Z3k(this.oBd,Ha[eb].clientId,eb)}Z3k(Ha,eb,rc){Ha[eb]=rc;eb in this.HMd&&(this.HMd[eb].mX(rc),delete this.HMd[eb])}}Object(f.a)(H,"CoauthorPositionFinder",null,[773]);
var D=e(529),G=e(287),J=e(530),U=e(76),F=e(127);class T{constructor(){this.NJa=null;this.VGc=Array(32)}xor(Ha){if(!Ha)throw Error.argumentNull("Guid argument cannot be null");const eb=new T,rc=new Sys.StringBuilder;for(let Uc=0;Uc<Ha.VGc.length;Uc++){const bd=this.VGc[Uc]^Ha.VGc[Uc];eb.VGc[Uc]=bd;rc.append(bd.toString(16));7!==Uc&&11!==Uc&&15!==Uc&&19!==Uc||rc.append("-")}eb.NJa=F.a.Of(rc.toString());return eb}toString(){return this.NJa.toString()}equals(Ha){if(!Ha)throw Error.argumentNull("Guid argument cannot be null");
return this.NJa.equals(Ha.NJa)}static fromString(Ha){if(!Ha)throw Error.argumentNull("String input cannot be null");const eb=new T;eb.NJa=F.a.Of(Ha);const rc=eb.NJa.toString();let Uc=0;for(let Hd=0;Hd<rc.length;Hd++){var bd=Ha.charAt(Hd);if(T.Trn(bd))bd=T.D6m(bd,Ha.charCodeAt(Hd)),eb.VGc[Uc++]=bd;else if(!T.prn(bd))throw Error.argument("String contains characters not valid in Guids");}return eb}static Trn(Ha){return"0"<=Ha&&"9">=Ha||"A"<=Ha&&"F">=Ha||"a"<=Ha&&"f">=Ha}static prn(Ha){return"{"===Ha||
"}"===Ha||"-"===Ha}static D6m(Ha,eb){if("0"<=Ha&&"9">=Ha)return eb-48;if("A"<=Ha&&"F">=Ha)return eb-65+10;if("a"<=Ha&&"f">=Ha)return eb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(f.a)(T,"Guid",null,[]);class Y{constructor(Ha,eb,rc,Uc){this.nAa=null;this.rjh=this.SAh=!1;this.dyh=0;this.Eia=()=>{this.TAl(this.nAa.Tsb())};this.pQc=Ha;this.Fcf=eb;this.za=rc;this.Pac=Uc;this.ltk=m.AFrameworkApplication.aEc||m.AFrameworkApplication.awa;this.nzh=new D.a(G.a.Oh())}get myf(){return this.za.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.pQc.continueWith(()=>{this.nAa=this.pQc.result;this.nAa.hfc(this.Eia)})}TAl(Ha){var eb=0;const rc=new J.a(G.a.Oh());for(const Uc of Ha)if(Uc&&Uc.isAnonymous){m.AFrameworkApplication.ud("70eb6120;2gfeb930");if(rc.Bb(Uc.userName))rc.K(Uc.userName).add(Uc.clientId);else{let bd;rc.add(Uc.userName,(bd=new U.a,bd.add(Uc.clientId),bd))}Uc.clientId!==this.Pac?(eb++,2<=eb&&!this.SAh&&this.HMn()):!this.rjh&&this.myf&&"Guest"===Uc.userName&&(l.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),
this.rjh=!0)}if(this.myf&&this.dyh!==eb){l.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",eb+(this.ltk?1:0));this.dyh=eb;for(const Uc of rc.keys)2<=rc.K(Uc).count&&(Ha=this.exm(rc.K(Uc)),this.nzh.contains(Ha)||(eb={},eb.guestsWithSameName=rc.K(Uc).count,eb.identifier=Ha,l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",eb),this.nzh.add(Ha)))}}HMn(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.SAh=!0;this.myf&&
this.Fcf&&this.Fcf.continueWith(()=>{window.setTimeout(()=>{this.Fcf.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}exm(Ha){if(!Ha||1>=Ha.count)return"";let eb=T.fromString(Ha.K(0));for(let rc=1;rc<Ha.count;rc++)eb=eb.xor(T.fromString(Ha.K(rc)));return eb.toString()}}Object(f.a)(Y,"GuestCoauthTelemetry",null,[]);var P=e(277);class S{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(S,"PL",null,[]);var N=e(29);class V{constructor(){this.ct=
this.vt=this.d=0}static SRj(Ha,eb,rc){const Uc=new V;Uc.d=Ha;Uc.vt=eb;Uc.ct=rc;return N.c(Uc)}}Object(f.a)(V,"VD",null,[]);var Z=e(100);class ca{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){this.Ci=0;this.DJh=!1;this._id=Ha;this.vLh=eb;this.Su=rc;this.j4e=Uc;this.tdf=bd;this.bMb=Hd;this.sFb=Pe;this.wwk=Le;this.wEb=De;this.jka=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}DRa(Ha){E.Task.WAA(this.vLh,this.j4e,this.tdf).continueWith(()=>{if(this.j4e.result<=this.tdf.result)Ha.mX(!1);
else{this.Ci=this.vLh.result;var eb=this.Su-this.Ci,rc=new S;rc.id=this._id;rc.et=this.Su;rc.st=this.Ci;rc.d=this.Su-this.Ci;rc.mp=this.j4e.result;rc.tp=this.tdf.result;rc.ct=this.esm(this.wwk);rc.vc=this.wEb();var Uc=N.c(rc),bd="Word"===this.jka,Hd="PowerPoint"===this.jka;l.ULS.sendTraceTag(42078597,302,15,Uc);if(bd){const Pe=new Map;Pe.set("data",Uc);u.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Pe)}eb>this.bMb.value&&!this.DJh&&!rc.vc&&(this.DJh=!0,Ha.mX(!0),rc=
Object.assign(new Z.a,{inStaging:!0,extendedProperties:new Map}),rc.extendedProperties.set("data",Uc),bd&&u.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,rc),eb<this.sFb.value&&(l.ULS.sendTraceTag(42078598,302,15,V.SRj(eb,this.bMb.value,this.sFb.value)),eb=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Hd&&eb&&(rc.inStaging=!1,u.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",
["PresenceExperienceDegraded"],!1,!0,!0,!1,rc))));Ha.task.isCompleted||Ha.mX(!1)}})}esm(Ha){switch(Ha){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(ca,"PresenceLatencyActivityLogger",null,[]);class W{constructor(Ha,eb,rc){this.Ifh=this.Ugh=this.TAd=this.nBd=this.B6b=0;this._id=Ha;this.bMb=eb;this.sFb=rc;this.jka=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get YVh(){return this.B6b}set YVh(Ha){this.B6b=
Ha;this.krf()}get W8h(){return this.nBd}set W8h(Ha){this.nBd=Ha;this.krf()}get J4h(){return this.TAd}set J4h(Ha){this.TAd=Ha;this.krf()}get X8h(){return 0!==this.Ugh}get K4h(){return 0!==this.Ifh}krf(){!this.X8h&&this.B6b&&this.nBd&&(this.Ugh=this.DRa(this.nBd,"CoauthGalleryLightupDurationTooLong"));!this.K4h&&this.B6b&&this.TAd&&(this.Ifh=this.DRa(this.TAd,"CanvasPresenceLightupDurationTooLong"))}DRa(Ha,eb){const rc=Ha-this.B6b;var Uc=new S;Uc.id=this._id;Uc.et=Ha;Uc.st=this.B6b;Uc.d=rc;var bd=N.c(Uc);
Ha="Word"===this.jka;Uc="CanvasPresenceLightupDurationTooLong"===eb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===eb?l.ULS.sendTraceTag(572289499,302,15,bd):l.ULS.sendTraceTag(571524118,302,15,bd);if(Ha){var Hd=new Map;Hd.set("data",bd);u.Health.instance.recordKpiUsage(Uc,0,"wordcollabrel",Hd)}return rc>this.bMb.value?(Hd=Object.assign(new Z.a,{inStaging:!0,extendedProperties:new Map}),Hd.extendedProperties.set("data",bd),bd=rc<this.sFb.value,
Hd.extendedProperties.set("cash",bd?"true":"false"),Ha&&u.Health.instance.recordKpiFailure(Uc,eb,!1,!0,Hd),l.ULS.sendTraceTag(572289500,302,15,V.SRj(rc,this.bMb.value,this.sFb.value)),bd?2:1):3}}Object(f.a)(W,"PresenceLightupLatencyLogger",null,[]);class X{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le=null,De=null,lf=null){this.PFh={};this.CQe={};this.Fwh=new U.a;this.yAd=this.ULc=this.XG=this.wi=null;this.uLh=this.tLh=0;this.U9n=(Af,mg)=>{if(!this.Jeh&&2===mg.newState){var hi=this.AFi();hi.continueWith(()=>
{var Uh=hi.result;Uh=Date.now()-Uh;const nk={};nk.clientId=this.Dlj;nk.bootTime=Uh;this.Jeh=!0;this.wi.sE(15,nk)})}};this.V2n=(Af,mg)=>{if(15===mg.type){Af=Date.now();mg=mg.fC;var hi=mg.bootTime;this.oOf(mg.clientId).YVh=Af-hi}};this.Tre=()=>{this.Eia()};this.bMb=new P.a(()=>Le.dZ("PresenceBootLatencyThreshold",1E4));this.sFb=new P.a(()=>Le.dZ("PresenceBootLatencyCutoffThreshold",6E4));this.DYk=new P.a(()=>Le.dZ("PresenceLightupLatencyThreshold",2E3));this.Dyk=new P.a(()=>Le.dZ("PresenceLightupLatencyCutoffThreshold",
1E4));this.f3=Uc;this.qPk=bd;this.Xgh=Ha;this.rIh=eb;this.umb=rc;this.an=Hd;this.Pac=De;this.wEb=Pe;this.sqh=lf;this.Jeh=!1;this.init()}m2c(Ha,eb,rc=null,Uc=0){rc&&(l.ULS.shipAssertTag(42274970,302,!this.Pac||this.Pac===rc,"_myClientId is already set and you are trying to update it to something different"),this.Pac=rc);const bd=new w.a;this.init().continueWith(()=>{this.F8n(Ha);this.V6l(bd,Ha,eb,Uc)})}get Dlj(){return this.Pac||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.ULc)return this.ULc.task;
this.ULc=new w.a;this.wEb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Xgh.continueWith(()=>{const Ha=this.Xgh.result,eb=Ha.thc,rc=Ha.BVn;rc.continueWith(()=>{eb.continueWith(()=>{this.sqh&&this.sqh.addQosPillar("RealTimeCoauth");this.WIg(eb.result,rc.result);this.ULc.setResult(null)})})});this.rIh.continueWith(()=>{this.wi=this.rIh.result;this.wi.K0(this.U9n);this.wi.CQ(this.V2n)});this.umb.continueWith(()=>{this.XG=this.umb.result;this.XG.hfc(this.Tre);0<this.XG.Tsb().length&&
this.Eia()});return this.ULc.task}AFi(){this.yAd||(this.yAd=new w.a,this.f3.Zk(4,()=>{this.yAd.mX(this.an.Gw("AppInitStatus_interactivityReady"))}));return this.yAd.task}Eia(){const Ha=Date.now();var eb=this.XG.Tsb();const rc=new U.a;for(const Uc of eb)this.Fwh.contains(Uc.clientId)||(this.Fwh.add(Uc.clientId),rc.add(Uc.clientId));if(0<rc.count)for(const Uc of rc)eb=this.oOf(Uc),eb.X8h||(eb.W8h=Ha)}F8n(Ha){Ha=this.oOf(Ha);Ha.K4h||(Ha.J4h=Date.now())}oOf(Ha){return Ha in this.CQe?this.CQe[Ha]:this.CQe[Ha]=
new W(Ha,this.DYk,this.Dyk)}WIg(Ha,eb=0){this.tLh=Ha;this.uLh=eb?eb:(new Date).getTime()}V6l(Ha,eb,rc,Uc){rc=rc?rc.getTime():(new Date).getTime();eb in this.PFh?Ha.pqa():(Uc=new ca(eb,this.lSm(),rc,this.Jae(this.Dlj),this.Jae(eb),this.bMb,this.sFb,Uc,this.wEb),this.PFh[eb]=Uc,Uc.DRa(Ha))}lSm(){return 1===this.tLh?E.Task.T8(this.uLh):this.AFi()}Jae(Ha){return this.qPk.Jae(Ha)}}Object(f.a)(X,"PresenceBootTelemetry",null,[774]);var ka=e(134),ma=e(186),ja=e(40),na=e(162),Ba=e(183),Ma=e(21),Ea=e(554);
class ya{get name(){return"Common.App.CoauthTelemetry"}Ec(Ha){Ha.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().fe(()=>new a(Ea.a.xr(Ha.Za("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Kg));Ha.register(y,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().fe(()=>new y(m.AFrameworkApplication.va,Ea.a.xr(Ha.Za("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.J,
ka.a.get_instance(),na.a.instance,Ea.a.xr(Ha.Za("Common.IPeoplesWell")),Ea.a.xr(Ha.Za("Common.IPeopleInfoProvider")),a.pZh,()=>this.y1h()));Ha.register(X,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().fe(()=>new X(Ea.a.xr(Ha.Za("Common.ICoauthoringTelemeryInfoProvider")),Ea.a.xr(Ha.Za("Common.IRealtimeChannelBasic")),Ea.a.xr(Ha.Za("Common.IPeopleInfoProvider")),ka.a.get_instance(),Ha.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
na.a.instance,()=>this.y1h(),m.AFrameworkApplication.J,null,u.Health.instance));Ha.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().fe(()=>new H(Ea.a.xr(Ha.Za("Common.IPeopleInfoProvider"))));Ha.register(Y,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().fe(()=>new Y(Ea.a.xr(Ha.Za("Common.IPeopleInfoProvider")),Ea.a.xr(Ha.Za("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.J,"{"+m.AFrameworkApplication.userSessionId+
"}"))}init(){m.AFrameworkApplication.J.lq(()=>{Ma.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ma.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&Ma.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.J.$("CashTelemetryIsEnabled")&&(Ma.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Ma.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}y1h(){return Ba.a.SNb&&
na.a.instance.wL(ja.a.exd)?0<na.a.instance.Gw(ja.a.exd)[ja.a.Ggk]:!1}static main(){ma.a.instance.Rc(new ya)}}Object(f.a)(ya,"CoauthTelemetryPackage",null,[0,1]);class ia extends Sys.EventArgs{constructor(){super()}}Object(f.a)(ia,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var za;(function(Ha){Ha[Ha.Rmq=0]="notYetStarted";Ha[Ha.Mpq=1]="polling";Ha[Ha.Dwq=2]="subscribed";Ha[Ha.j0h=3]="blocked";Ha[Ha.ypq=4]="permanentlyStopped"})(za||(za={}));Object(f.b)("RtcHostNotificationSubscriptionState",
za);var Ca=e(96),db=e(1291),pa=e(92);class ua{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){this.Bi=!1;this.Sfa=this.Obc=this.Cla=this.d7a=null;this.EBg=()=>{this.d7a=null;if(this.n7i){l.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",za[this.CBc]);let lf=null;this.h$e&&this.h$e.length&&(lf={},lf.etts=this.h$e);this.Obc.sE(14,lf,!0);this.FPj(this.dSk)}else this.Bnb.event(3)};this.Gvp=()=>{this.Cla=null;2===this.CBc&&(this.Bnb.event(1),l.ULS.shipAssertTag(573100185,
502,!!this.d7a,"Missing task to ensure that we re-subscribe."))};this.apa=()=>{this.Z_m()};this.fU=(lf,Af)=>{if(13===Af.type&&(lf=Af.fC,l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:lf,["DurationBeforeExpirationToResubscribeInSec"]:this.POd}),Af=lf.cts,!this.wyp(Af))){if(lf.sb){var mg=2;this.RTo(lf.cts)}else mg=1,this.hTc=ua.DMe,this.Cla&&(this.Sb.Kf(this.Cla),this.Cla=null);this.Bnb.event(mg);this.d7a?this.Sb.Z5(this.d7a,
1E3*Af):this.FPj(Af)}};this.V$n=(lf,Af)=>{lf=Af.newState;const mg=Af.Xpg,hi={};hi.NewState=za[lf];hi.PreviousState=za[mg];hi.PreviousStateHits=Af.Ypg;hi.PreviousStateTransitionTime=Af.Zpg.toISOString();hi.IsSubscribed=this.P7i;this.hTc!==ua.DMe&&(hi.SubscriptionExpiringTime=this.hTc.toISOString());l.ULS.sendTraceTag(572346515,502,4===lf?15:50,"HostNotificationChanged: {0}",hi);this.sa.raiseEvent("HN",new ia(mg,lf))};this.hTc=ua.DMe;this.sa=new pa.a;this.Bnb=new db.a(0);this.Bnb.Ljf(this.V$n);this.dSk=
Ha;this.POd=eb;this.cSk=rc;this.h$e=Uc;this.Sb=bd;this.qf=Hd;Pe.execute(lf=>{this.Bi||(this.Obc=lf,this.Obc.CQ(this.fU),this.start())});Le.execute(lf=>{this.Bi||(this.Sfa=lf,lf.HVa(this.apa))});this.ORd=De}get CBc(){return this.Bnb.currentState}get n7i(){return!this.qf||this.qf.wEa}get P7i(){return 2===this.CBc&&this.ORd()<this.hTc}start(){0!==this.CBc?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",za[this.CBc]):(this.Bnb.event(1),this.EBg(null))}FPj(Ha){this.d7a=
Ca.a.jca(1E3*Ha,this.EBg,this.POd,192,"RtcHostNotificationSubscribe");this.Sb.pc(this.d7a)}RTo(Ha){Ha=1E3*(Ha+this.cSk);const eb=this.ORd().getTime()+Ha;this.hTc=new Date(eb);Ha-=this.POd;this.Cla?this.Sb.Z5(this.Cla,Ha):(this.Cla=Ca.a.jca(Ha,this.Gvp,this.POd/2,194,"RtcHostNotificationTransitionToPolling"),this.Sb.pc(this.Cla))}Z_m(){3===this.CBc&&this.n7i&&(this.Bnb.event(this.P7i?2:1),this.EBg(null))}wyp(Ha){if(!isNaN(Ha)&&isFinite(Ha)&&0<Ha)return!1;this.b3j(!1);return!0}b3j(Ha){this.d7a&&(this.Sb.Kf(this.d7a),
this.d7a=null);this.Cla&&(this.Sb.Kf(this.Cla),this.Cla=null);this.Obc&&(this.Obc.OFa(this.fU),this.Obc=null);this.Sfa&&(this.Sfa.S0b(this.apa),this.Sfa=null);Ha||this.Bnb.event(4)}dispose(){this.Bi||(this.Bi=!0,this.b3j(!0),this.Cla&&(this.Sb.Kf(this.Cla),this.Cla=null))}}ua.DMe=new Date(0);Object(f.a)(ua,"RtcHostNotificationSubscriptionManager",null,[777,11]);var Ga=e(266);class wa{constructor(){this.vi=this.Bi=!1}get name(){return"RtcHostNotificationSubscription"}Ec(Ha){Ha.register(ua,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().fe(()=>
{const eb=m.AFrameworkApplication.J;return new ua(eb.sc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),eb.sc("RtcHostNotificationRetryIntervalBufferInSeconds",120),eb.sc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.VPm(eb),m.AFrameworkApplication.zc,Ga.SessionStatusManager.instance,Ha.Za("Common.IRealtimeChannelBasic"),Ha.Za("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.J.lq(()=>{!this.Bi&&m.AFrameworkApplication.J.$("RtcHostNotificationEnabled")&&
(this.vi=!0,Ma.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Bi||(this.Bi=!0,this.vi&&Ma.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}VPm(Ha){return Ha.RA("RtcEventTypesToSubscribe")?Ha.kF("RtcEventTypesToSubscribe"):null}static main(){ma.a.instance.Rc(new wa)}}Object(f.a)(wa,"RtcHostNotificationSubscriptionPackage",null,[0,1]);var xa=e(490),sa=e(657);
class Ka{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af){this.clientId=Ha;this.SkypeChatThreadId=rc;this.chatThreadDiscoveryUri=Uc;this.inChat=bd;this.localColbaltSessionId=eb;this.capabilities=Hd;this.email=Pe;this.isReadOnly=Le;this.userName=De;this.isAnonymous=lf;this.presenceStatus=Af}}Object(f.a)(Ka,"SerializablePresenceUserData",null,[]);class Na extends xa.a{constructor(Ha,eb,rc,Uc,bd=null,Hd=null,Pe=null,Le=null,De=null,lf=!1,Af=!1,mg=!1,hi=null){super(Ha,eb,rc,Uc,Hd,Pe,Le,De,lf,Af,mg);this.FH=
bd;this.presenceStatus=hi}getData(){return new Ka(this.clientId,this.FH,this.XXc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}Kae(Ha){return(Ha=Ha.value)?Ha.user:null}clone(){return new Na(this.clientId,this.userName,this.color,this.capabilities.clone(),this.FH,this.XXc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static hPb(Ha){return Ha.clientId?
new Na(Ha.clientId,Ha.userName,null,new sa.a(void 0===Ha.capabilities?0:Ha.capabilities),Ha.localColbaltSessionId,Ha.SkypeChatThreadId,Ha.email,null,Ha.chatThreadDiscoveryUri,Ha.isAnonymous,Ha.inChat,Ha.isReadOnly,Ha.presenceStatus):null}static lei(Ha,eb,rc,Uc=null,bd=null,Hd=null,Pe=null,Le=null,De=!1,lf=!1,Af=!1,mg=null){return Ha?new Na(Ha,eb,null,new sa.a(void 0===rc?0:rc),Uc,bd,Hd,Pe,Le,Af,De,lf,mg):null}}Object(f.a)(Na,"PresenceUser",xa.a,[1572,1573,727]);class ub extends Na{constructor(){super();
this.Uwc=this.p9f=null}uHm(){const Ha=m.AFrameworkApplication.userName,eb=m.AFrameworkApplication.J.rb("UserPrincipalName"),rc=this.p9f?this.p9f.FH:null,Uc=m.AFrameworkApplication.aEc||m.AFrameworkApplication.awa,bd=this.Uwc?this.Uwc.getStatus():null;return new Na(this.clientId,Ha,this.color,this.capabilities,rc,this.XXc,eb,this.client,this.chatThreadDiscoveryUri,Uc,this.inChat,this.isReadOnly,bd)}}Object(f.a)(ub,"MyPresenceUser",Na,[1581,727]);var Ua=e(18),sb=e(69),qb=e(1041);class ab{constructor(Ha,
eb,rc,Uc,bd){this.ef=Ha;this._clientId=eb;this.Ezk=bd;this.FDk=rc||(()=>null);this.GDk=Uc||(()=>null)}get id(){return this.ef.id}get KTd(){return this.ef.KTd}get OTd(){return this.ef.OTd}get NTd(){return this.ef.NTd}get MTd(){return this.ef.MTd}get LTd(){return this.ef.LTd}get QTd(){return this.ef.QTd}get Vgf(){return this.ef.Vgf}get aBc(){return this.ef.aBc}get NDe(){return this.ef.NDe}get boe(){return this.ef.boe}get clientId(){return this._clientId}get Mnc(){return this.FDk}get yYa(){return this.GDk}get V0l(){return this.Ezk}static createInstance(Ha,
eb,rc,Uc,bd=!1){return new ab(Ha,eb,rc,Uc,bd)}}Object(f.a)(ab,"PeoplesWellSettings",null,[]);var Xa=e(118),wb=e(580),Sa=e(89),cc=e(243),Cb=e(115),Wa=e(219),Ja=e(236),Va=e(422),mb=e(352);class Ab extends Wa.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(Ab,"PeopleButtonProps",Wa.a,[]);var Xb=e(493),Lb=e(16),dc=e(103);class yc{constructor(Ha){this.fxd=new dc.a;this.kyf=null;this.clientId=
Ha}h7o(Ha){this.CFo();this.r_o(Ha);for(const eb of Ha)eb.clientId!==this.clientId&&this.hUh(eb)}get $Qg(){const Ha=[];for(const eb of this.fxd.values){const rc=this.zQj(eb);Array.add(Ha,rc)}return Ha}get iyb(){return this.fxd.count}Tif(Ha,eb){Ha=Ha.toUpperCase();let rc;({value:rc}=this.fxd.Nc(Ha)).returnValue||(rc=[],this.fxd.W(Ha,rc));Array.add(rc,eb)}CFo(){this.fxd=new dc.a}r_o(Ha){for(const eb of Ha)if(eb.clientId===this.clientId){this.kyf=eb;break}}}Object(f.a)(yc,"UserTracker",null,[1916]);class Wc extends yc{constructor(Ha,
eb){super(Ha);this.HDk=eb}hUh(Ha){Ha.isAnonymous||!Ha.email?this.Tif(Ha.clientId,Ha):this.kyf&&G.a.Oh().equals(this.kyf.email,Ha.email)||this.Tif(Ha.email,Ha)}zQj(Ha){let eb=new Date(0),rc=0<Ha.length?Ha[0]:null;for(const Uc of Ha)(Ha=this.HDk(Uc.clientId))&&eb.getTime()<Ha.Psc.getTime()&&(eb=Ha.Psc,rc=Uc);return rc}}Object(f.a)(Wc,"UniqueUserTracker",yc,[]);class zb extends yc{constructor(Ha){super(Ha)}hUh(Ha){this.Tif(Ha.clientId,Ha)}zQj(Ha){return Ha[0]}}Object(f.a)(zb,"UserInstanceTracker",yc,
[]);const cd=(Ha,eb,rc)=>rc?new Wc(Ha,eb):new zb(Ha);var qc=e(98),Dc=e(1255),mc=e(12);class lc{constructor(Ha,eb=null,rc=null){this.XG=null;this.Bdf=new w.a;this.W2n=(Uc,bd,Hd,Pe,Le)=>{this.Bdf.mX(Le.RenderTime);return 32};this.ef=Ha;this.rte=eb;rc&&rc.continueWith(()=>{this.XG=rc.result;this.XG.hfc(Object(Xa.a)(this,this.Eia,"onUsersUpdated"));this.cxe()});new xa.a(this.settings.clientId,"Anonymous user","#cccccc",new sa.a(7));this.E1f=this.K0e=!0;this.tXe=this.a7e=!1;this.bHa=cd(this.settings.clientId,
this.settings.yYa,Ha.V0l)}get settings(){return this.ef}get rnn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("ColorPresenceHashIsEnabled"):!1}get nnn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}hum(){let Ha,eb,rc,Uc;var bd=this.ium();this.bHa.iyb?1===this.bHa.iyb?(Ha=!0,eb=this.settings.aBc.cluster,rc=this.settings.aBc.D1d,Uc=this.bHa.$Qg[0].color):(Ha=!0,eb=this.settings.boe.cluster,rc=this.settings.boe.D1d,Uc=""):(Ha=
!1,Uc=rc=eb="");const Hd=bd[0];bd=bd.slice(1);return{ndo:Hd,odo:bd,jdo:Ha,Ooq:eb,ldo:rc,kdo:Uc}}ium(){if(2<=this.bHa.iyb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.bHa.iyb)];if(1===this.bHa.iyb){const Ha=this.bHa.$Qg[0],eb=this.settings.yYa(Ha.clientId);return eb&&2===eb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ha.userName]:[Ha.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,
Ha.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}YWm(Ha){return this.ZWm(Ha)}j4h(Ha,eb,rc){return eb?this.Prl(eb)?(Ha=this.settings.yYa(Ha))&&2===Ha.status?!1:!0:(rc&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(rc&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}qSm(Ha){return Ha.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}ZWm(Ha){var eb,
rc;if(!Ha.capabilities.Aha(1))return this.qSm(Ha);const Uc=Ha.isReadOnly,bd=this.settings.yYa(Ha.clientId);Ha=this.settings.Mnc(Ha.clientId);if(!bd)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(bd.status){case 1:if(!Ha)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;if(m.AFrameworkApplication.J.isChangeGateEnabled("OfficeVSO:8350444_RealTimeViewPresenceState")){if(1!==(null===(rc=null===(eb=null===m.AFrameworkApplication||void 0===m.AFrameworkApplication?void 0:
m.AFrameworkApplication.ta)||void 0===eb?void 0:eb.Pb)||void 0===rc?void 0:rc.gl)&&Uc)return CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline}else if(Uc)return CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline;return this.dIl(Ha)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}PCm(Ha){if(this.rte.Cdd)return this.rte.APb(Ha.email,"O365",m.AFrameworkApplication.lm,
0)}NWm(Ha){Ha=this.settings.yYa(Ha.clientId);return!Ha||Ha&&1===Ha.status?!0:!1}OWm(Ha){var eb=String.format("buttonPeoplesWellUser-{0}",Ha.clientId),rc=Ha.clientId,Uc=this.YWm(Ha);const bd=Ha.userName,Hd=Ha.color;var Pe=Object,Le=Pe.assign,De=new Ab,lf=this.settings.QTd.toString(),Af=this.settings.NDe.cluster,mg=this.settings.NDe.D1d,hi=this.mCi(),Uh=Ha.isAnonymous,nk;if(nk=[bd],nk.length){var fi=new Sys.StringBuilder("STRARRY@");for(const kc of nk)fi.append(kc?kc.length:0),fi.append(","),fi.append(kc),
fi.append(",");nk=fi.toString().slice(0,-1)}else nk=null;eb=Le.call(Pe,De,{Id:eb,Command:lf,LabelText:"{0}",Image32by32:Af,Image32by32Class:mg,MenuItemId:rc,CommandValueId:rc,Alt:bd,DisplayMode:hi,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Uc,ImageBackColor:Hd,IsAnonymous:Uh,LabelTextUserGeneratedPlaceholderReplacements:nk,Upn:Ha.email});m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&this.rte&&(rc=this.PCm(Ha),
Uc=this.NWm(Ha),eb.ImageUrl=rc,eb.ActiveStatus=Uc,eb.JoinTimeInMS=Ha.l_a,Ha=this.j4h(Ha.clientId,this.settings.Mnc(Ha.clientId),!1),eb.CanJump=Ha,""===rc&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return eb}$Am(){return Object.assign(new Wa.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}mCi(){return this.rnn?"Initials":"Menu32"}PWm(Ha){const eb=
[];for(const rc of Ha)Ha=this.OWm(rc),Array.add(eb,Ha);return eb}ahe(){return 0<this.bHa.iyb}sto(Ha){if(!this.K0e)return!0;this.E1f||(Ha[Dc.a.Visible]=!0);const {ndo:eb,odo:rc,jdo:Uc,ldo:bd,kdo:Hd}=this.hum();Ha[Dc.a.LabelText]=eb;rc&&rc.length&&(Ha[Dc.a.LabelTextUserGeneratedPlaceholderReplacements]=rc);Ha[Dc.a.ImageIsVisible]=Uc;Ha[Dc.a.Image16by16Class]=bd;Ha[Dc.a.ImageBackColor]=Hd;this.K0e=!1;return!0}Bko(Ha){if(0>=this.bHa.iyb)return!1;var eb=this.pip(this.bHa.$Qg),rc=this.PWm(eb);eb=Object.assign(new Va.a,
{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});rc=Object.assign(new mb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.mCi(),ControlList:rc});m.AFrameworkApplication.J.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.rte&&(rc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,rc.TitleId="menuCoauthorsTitle",rc.Theme="Light");Array.add(eb.MenuSectionList,rc);m.AFrameworkApplication.J.$("DocChatIsEnabled")&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Pb.$t&&(rc=[],Array.add(rc,this.$Am()),rc=Object.assign(new mb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:rc}),Array.add(eb.MenuSectionList,rc));m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Pb.$t?Ha.MenuItems=eb:Ha.PopulationXML=Ja.o(eb);return!0}XQg(Ha){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ha=Ha.MenuItemId;if(!Ha)return!1;const eb=this.settings.Mnc(Ha);if(!this.j4h(Ha,eb,
!0))return!1;this.oDn(eb);return!0}Wzo(){const Ha=this.Pnm();this.bHa.h7o(Ha);this.E1f&&1<=this.bHa.iyb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.E1f=!1);this.K0e=!0}Eia(){this.tXe||(window.setTimeout(()=>{this.cxe();this.tXe=!1},3E3),this.tXe=!0)}Pnm(){let Ha;Ha=this.Onm()||[];for(const eb of Ha)this.rSo(eb);return Ha}rSo(Ha){Ha.clientId||(Ha.clientId=F.a.create().toString());Ha.userName||(Ha.userName="Anonymous user");Ha.capabilities||(Ha.capabilities=
new sa.a);Ha.color||(Ha.color="#cccccc");Ha.l_a||(Ha.l_a=0)}pip(Ha){const eb=[];Array.addRange(eb,Ha);eb.sort(lc.Vco);return eb}yDo(){m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&!this.a7e&&(m.AFrameworkApplication.va.s1(mc.a.g9h)&&Xb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.nb(mc.a.g9h,qc.a.frame,this.W2n,96));this.zDo();this.a7e=!0;this.cxe()}get w6j(){return this.Bdf.task}cxe(){if(!this.a7e&&
(this.Bdf.mX((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.nnn))return;this.Wzo();this.Xzo()}dispose(){this.XG&&(this.XG.Mwg(Object(Xa.a)(this,this.Eia,"onUsersUpdated")),this.XG=null)}static Vco(Ha,eb){return m.AFrameworkApplication.J.isChangeGateEnabled("OfficeVSO:8425872_SortUsersByEditorsViewersInactive")?Ha.capabilities.Aha(1)&&!eb.capabilities.Aha(1)?-1:!Ha.capabilities.Aha(1)&&eb.capabilities.Aha(1)?
1:!Ha.isReadOnly&&eb.isReadOnly?-1:Ha.isReadOnly&&!eb.isReadOnly?1:Lb.a.localeCompare(Ha.userName,eb.userName):Ha.capabilities.Aha(1)&&eb.capabilities.Aha(1)||!Ha.capabilities.Aha(1)&&!eb.capabilities.Aha(1)?Lb.a.localeCompare(Ha.userName,eb.userName):Ha.capabilities.Aha(1)?-1:1}}Object(f.a)(lc,"APeoplesWell",null,[1847,11]);var Vb=e(11);const yb=()=>!0;class Db extends lc{constructor(Ha,eb,rc=null,Uc=null){super(Ha,rc,Uc);this.eon=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,()=>this.ahe(),yb);this.tto=(bd,
Hd,Pe,Le,De)=>this.zbb(Pe,De,lf=>this.sto(lf),yb);this.Cko=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,yb,lf=>this.Bko(lf));this.OBl=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,yb,yb);this.NBl=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,yb,yb);this.EKp=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,yb,lf=>this.XQg(lf));this.cio=(bd,Hd,Pe,Le,De)=>this.zbb(Pe,De,yb,()=>{this.cxe();return!0});this.ga=eb}zbb(Ha,eb,rc,Uc){let bd=!1;switch(Ha){case 1:bd=rc(eb);break;case 2:bd=Uc(eb)}return bd?32:8}zDo(){this.ga.qa(this.settings.KTd,Vb.a.application,
this.eon);this.ga.nb(this.settings.OTd,Vb.a.application,this.tto,96);this.ga.nb(this.settings.MTd,Vb.a.application,this.OBl,96);this.ga.nb(this.settings.LTd,Vb.a.application,this.NBl,96);this.ga.nb(this.settings.NTd,Vb.a.application,this.Cko,96);this.ga.qa(this.settings.QTd,Vb.a.application,this.EKp);this.ga.nb(this.settings.Vgf,Vb.a.application,this.cio,96)}}Object(f.a)(Db,"ABox4PeoplesWell",lc,[]);var $b=e(3),Fa=e(126),lb=e(54),kb=e(7),Ob=e(26),nc=e(174);class zc{static isSupported(Ha){for(let eb=
0;eb<zc.c4j.length;eb++)if(Ha===zc.c4j[eb])return!0;return!1}}zc.c4j=[1];Object(f.a)(zc,"RTTDataVersion",null,[]);var Pb=e(1596);const tb=Ha=>{if("number"!==typeof Ha.RK||"number"!==typeof Ha.DK)return!1;let eb,rc=!1,Uc=!1,bd=!1;switch(Ha.RK){case 0:Uc=eb=!0;break;case 1:bd=rc=Uc=eb=!0;break;case 2:if(null!=Ha.PE&&"number"!==typeof Ha.PE)return!1;eb=!0;break;case 4:eb=!0;break;case 3:Uc=eb=!0;break;case 5:rc=eb=!0;break;default:return!1}return eb&&("number"!==typeof Ha.PS||"number"!==typeof Ha.TS)||
Uc&&("object"!==typeof Ha.OS||!Ha.OS||!Pb.validateVersionedCpData(Ha.OS))||rc&&("number"!==typeof Ha.PE||"number"!==typeof Ha.TE)||bd&&("object"!==typeof Ha.OE||!Ha.OE||!Pb.validateVersionedCpData(Ha.OE))?!1:!0},ib=Ha=>{let eb="";if("number"!==typeof Ha.I)return{returnValue:!1,Yna:"Invalid PacketId Type"};if("number"!==typeof Ha.O)return{returnValue:!1,Yna:"Invalid Operation Type"};if("string"!==typeof Ha.A)return{returnValue:!1,Yna:"Invalid ClientId Type"};if("object"!==typeof Ha.AN)return{returnValue:!1,
Yna:"Invalid Anchor Object Type"};if(!Ha.AN)return{returnValue:!1,Yna:"Null AnchorObject"};if(!tb(Ha.AN)){let rc;try{rc=N.c(Ha.AN)}catch(Uc){rc=String.format("Failed to JSON-serialize payload : {0}",Uc)}8E3<rc.length&&(rc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",rc.length,8E3));eb="Invalid AnchorObject: "+rc+", Client: "+Ha.C;return{returnValue:!1,Yna:eb}}return!Ha.O&&Ha.AN.RK?(eb="Invalid RangeKind:"+Ha.AN.RK+" for Caret",{returnValue:!1,Yna:eb}):2===Ha.O&&("number"!==
typeof Ha.TF||"undefined"!==typeof Ha.TX&&"string"!==typeof Ha.TX||1!==Ha.AN.RK&&Ha.AN.RK)?{returnValue:!1,Yna:"Invalid TypingData"}:3!==Ha.O||"object"===typeof Ha.AP&&Ha.AP&&"number"===typeof Ha.AP.TFA&&"number"===typeof Ha.AP.PN&&"number"===typeof Ha.AP.TN&&2===Ha.AN.RK?6!==Ha.O||"object"===typeof Ha.MP&&Ha.MP&&"number"===typeof Ha.MP.PM&&"number"===typeof Ha.MP.TM&&5===Ha.AN.RK?4!==Ha.O||"object"===typeof Ha.SP&&Ha.SP&&"number"===typeof Ha.SP.PA&&"number"===typeof Ha.SP.TA&&"number"===typeof Ha.SP.PB&&
"number"===typeof Ha.SP.TBS&&3===Ha.AN.RK&&(Ha.AN.PS===Ha.SP.PA||Ha.AN.PS===Ha.SP.PB)?7!==Ha.O||"object"===typeof Ha.SPS&&Ha.SPS&&"string"===typeof Ha.SPS.SF&&"boolean"===typeof Ha.SPS.SL?null!=Ha.ISS&&"number"!==typeof Ha.ISS?{returnValue:!1,Yna:"invalid StrictlySequentialId"}:{returnValue:!0,Yna:eb}:{returnValue:!1,Yna:"Invalid SymbolData"}:{returnValue:!1,Yna:"Invalid SplitParaData"}:{returnValue:!1,Yna:"Invalid RemoveParaData"}:{returnValue:!1,Yna:"Invalid AddParaData"}};var Rb=e(1549);class gc{constructor(Ha,
eb=null,rc=null){this.v6=this.Mmg=this.ULg=null;null!=Ha&&(this.ULg=Ha);null!=eb&&(this.Mmg=eb);null!=rc&&(this.v6=rc)}}Object(f.a)(gc,"AddParaData",null,[]);class xc{constructor(Ha=null,eb=null){this.tCc=this.Lmg=null;null!=Ha&&(this.Lmg=Ha);null!=eb&&(this.tCc=eb)}}Object(f.a)(xc,"MergeRemoveParaData",null,[]);class Nc{constructor(Ha,eb,rc,Uc,bd,Hd,Pe=null,Le=null,De=null,lf=null,Af=null,mg=null,hi=0,Uh=null){this.lud=this.text=this.d4b=this.u3b=this.Agd=this.Qec=this.Bqa=null;this.packetId=Ha;
this.client=rc;this.operationType=Uc;this.clientId=eb.toLowerCase();this.xY=bd;this.version=hi;Hd&&(this.Bqa=Hd);null!=Pe&&(this.d4b=Pe);void 0!==Le&&null!==Le&&(this.text=Le);De&&(this.Qec=De);lf&&(this.Agd=lf);Af&&(this.u3b=Af);mg&&(this.lud=mg);this.strictlySequentialId=Uh}}Object(f.a)(Nc,"RTTData",null,[]);class Kc{constructor(Ha=null,eb=null,rc=null,Uc=null){this.TLg=this.Kmg=this.QLg=this.Jmg=null;null!=Ha&&(this.Jmg=Ha);null!=eb&&(this.QLg=eb);null!=rc&&(this.Kmg=rc);null!=Uc&&(this.TLg=Uc)}}
Object(f.a)(Kc,"SplitParaData",null,[]);class fd{constructor(Ha=null,eb=null){this.nKg=this.mKg=null;Ha&&(this.mKg=Ha);null!=eb&&(this.nKg=eb)}}Object(f.a)(fd,"SymbolData",null,[]);class jd{constructor(Ha,eb=null,rc=null){null!=Ha&&(this.TFA=Ha);null!=eb&&(this.PN=eb);null!=rc&&(this.TN=rc)}}Object(f.a)(jd,"SerializableAddParaDataV1",null,[]);class Id{constructor(Ha=null,eb=null){null!=Ha&&(this.PM=Ha);null!=eb&&(this.TM=eb)}}Object(f.a)(Id,"SerializableMergeRemoveParaDataV1",null,[]);class ce{}Object(f.a)(ce,
"SerializableRTTDataV1",null,[]);class Fe{constructor(Ha=null,eb=null,rc=null,Uc=null){null!=Ha&&(this.PA=Ha);null!=eb&&(this.TA=eb);null!=rc&&(this.PB=rc);null!=Uc&&(this.TBS=Uc)}}Object(f.a)(Fe,"SerializableSplitParaDataV1",null,[]);class Fd{constructor(Ha=null,eb=null){Ha&&(this.SF=Ha);null!=eb&&(this.SL=eb)}}Object(f.a)(Fd,"SerializableSymbolDataV1",null,[]);const Qb=Ha=>{var eb;if(!({Yna:eb}=ib(Ha)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",
eb),null;let rc=eb=null,Uc=null,bd=null,Hd=null,Pe=null,Le=null,De=null;Ha.WD&&(eb=Ha.WD);null!=Ha.TF&&(rc=Ha.TF);void 0!==Ha.TX&&null!==Ha.TX&&(Uc=Ha.TX);Ha.AP&&(bd=new gc(Ha.AP.TFA,Ha.AP.PN,Ha.AP.TN));Ha.MP&&(Hd=new xc(Ha.MP.PM,Ha.MP.TM));Ha.SP&&(Pe=new Kc(Ha.SP.PA,Ha.SP.TA,Ha.SP.PB,Ha.SP.TBS));Ha.SPS&&(Le=new fd(Ha.SPS.SF,Ha.SPS.SL));null!=Ha.ISS&&(De=Ha.ISS);return new Nc(Ha.I,Ha.A,Ha.C,Ha.O,Rb.a(Ha.AN),eb,rc,Uc,bd,Hd,Pe,Le,1,De)},ch=Ha=>{let eb=Ha;if("number"===typeof eb.V){if(1===eb.V)return Qb(Ha);
l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let rc=0,Uc=null;for(let bd=0;bd<Ha.length;bd++)eb=Ha[bd],zc.isSupported(eb.V)&&eb.V>rc&&(rc=eb.V,Uc=Ha[bd]);return 1===rc?Qb(Uc):null},Nf=Ha=>{if(Ha){const eb=new ce;eb.I=Ha.packetId;eb.V=1;eb.A=Ha.clientId;eb.C=Ha.client;eb.O=Ha.operationType;eb.AN=Rb.c(Ha.xY);Ha.Bqa&&(eb.WD=Ha.Bqa);null!=Ha.d4b&&(eb.TF=Ha.d4b);void 0!==Ha.text&&null!==Ha.text&&0<Ha.text.length&&(eb.TX=Ha.text);Ha.Qec&&(eb.AP=new jd(Ha.Qec.ULg,Ha.Qec.Mmg,Ha.Qec.v6));
Ha.Agd&&(eb.MP=new Id(Ha.Agd.Lmg,Ha.Agd.tCc));Ha.u3b&&(eb.SP=new Fe(Ha.u3b.Jmg,Ha.u3b.QLg,Ha.u3b.Kmg,Ha.u3b.TLg));Ha.lud&&(eb.SPS=new Fd(Ha.lud.mKg,Ha.lud.nKg));eb.ISS=Ha.strictlySequentialId;Ha=eb}else Ha=null;return Ha};var Mf=e(49);class Df{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){this.LocalCobaltSessionId=Ha;this.SkypeChatThreadId=eb;this.ChatThreadDiscoveryUri=rc;this.InChat=Uc;this.Capabilities=bd;this.Email=Hd;this.UserName=Pe;this.IsAnonymous=Le;this.PresenceStatus=De}}Object(f.a)(Df,"SerializableWacData",
null,[]);class Ig{constructor(){this.qQd=this.pQd=0}jIm(){this.qQd===Number.MAX_VALUE&&(this.qQd=0);this.qQd++;return this.qQd}iIm(){this.pQd===Number.MAX_VALUE&&(this.pQd=0);this.pQd++;return this.pQd}static get instance(){return Ig.IUk}}Ig.IUk=new Ig;Object(f.a)(Ig,"StrictlySequentialIdGenerator",null,[786]);var pg=e(1448);class Rf{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le=0){this.gAa=null;this.dryDeletion=0;this.sQ=Ha;this.jUa=Hd;this.Ld=bd;this.qMb=Pe;this.qd=eb;this.shapeId=Le;this.oPa=rc;this.Uda=
Pe.create(this,Uc,bd,Hd)}clone(){return new Rf(this.sQ,this.qd,this.oPa,this.Uda.M5b,this.Ld,this.jUa,this.qMb,this.shapeId)}get paragraphId(){return this.gAa?this.gAa:this.sQ.Itb(this.qd)}kkg(){this.gAa||(this.gAa=this.paragraphId,this.Uda.kkg())}isValid(){return 0<=this.Uda.cp}getData(){const Ha=this.Uda.M5b;return Ha?new pg.a(0,this.qd,this.oPa,Ha,null,null,null,0,this.shapeId):null}static hPb(Ha,eb,rc,Uc,bd){return eb?new Rf(eb,parseInt(Ha.C0a),Ha.shb,Ha.EW,rc,Uc,bd,Ha.shapeId):null}}Object(f.a)(Rf,
"WordPresenceIp",null,[771,45,772]);class qf{constructor(Ha,eb,rc){this.x2a=this.eia=this.jOc=!1;this.mmb=Ha;this.F5a=rc;this.user=eb}get ip(){return this.F5a}get $tc(){return this.jOc}set $tc(Ha){(this.jOc=Ha)&&this.ip.kkg()}ZQf(){const Ha=Ig.instance.iIm();return new Nc(this.mmb,this.user.clientId,1,0,this.ip?this.ip.getData():null,new Df(this.user.FH,this.user.XXc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,
this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ha)}kEi(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Mf.a.nil.toString())}isValid(){const Ha=!!this.user&&this.user.isValid(),eb=!this.ip||this.ip.isValid();return Ha&&eb}clone(){const Ha=new qf;Ha.mmb=this.mmb;Ha.jOc=this.jOc;Ha.user=this.user?this.user.clone():null;Ha.F5a=this.ip?this.ip.clone():null;Ha.eia=this.eia;Ha.x2a=this.x2a;return Ha}static hwf(Ha,eb,rc,Uc,bd){if(!Ha||!eb)return null;if(Ha.operationType)return l.ULS.sendTraceTag(7685324,
302,15,"Presence packet is of unexpected operationType {0}",Ha.operationType),null;let Hd;Hd=void 0!==Ha.Bqa&&null!==Ha.Bqa?Na.lei(Ha.clientId,Ha.Bqa.UserName,Ha.Bqa.Capabilities,Ha.Bqa.LocalCobaltSessionId,Ha.Bqa.SkypeChatThreadId,Ha.Bqa.Email,Ha.client,Ha.Bqa.ChatThreadDiscoveryUri,Ha.Bqa.InChat,!1,Ha.Bqa.IsAnonymous,Ha.Bqa.PresenceStatus):Na.lei(Ha.clientId,null,0,void 0,void 0,void 0,Ha.client);return new qf(Ha.packetId,Hd,Rf.hPb(Ha.xY,eb,rc,Uc,bd))}}Object(f.a)(qf,"WordPresenceInfo",null,[778,
45]);class Mh extends Db{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi,Uh){super(Ha,Hd,Uh,eb);this.Wvk=rc;this.mSk=Uc;this.GQk=bd;this.pb=Pe;Mh.LA=Le;this.sQ=De;this.Ld=lf;this.jUa=Af;this.ugf=mg;this.nSa=hi}XQg(Ha){this.nSa.g$i(Ha.CommandValueId);return super.XQg(Ha)}oDn(Ha){let eb;({Ipg:eb}=this.B3f(Ha)).returnValue&&(this.mSk(eb.ip.paragraphId,eb.ip.Uda.cp),m.AFrameworkApplication.J.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Ha=Mh.WQm(eb),void 0!==Ha&&null!==Ha?(l.ULS.sendTraceTag(20764574,
325,50,"Attempting to move IP to the editing location of the selected user"),this.pb.Uc(Ha),Sa.FocusManager.kO()&&Sa.FocusManager.instance().Rg(cc.AFrame.Co)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ha=new Ca.a(2,1,0,()=>{this.ga.Zb($b.a.nDe,2,eb)}),Cb.TaskManager.instance.pc(Ha))}PJi(Ha){return Ha?(Ha=qf.hwf(ch(Ha),this.sQ,this.Ld,this.jUa,this.ugf.instance))&&Ha.isValid()&&Ha.ip?Ha:null:null}Prl(Ha){return this.Twn(Ha)?this.gsl(Ha)?
!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}Twn(Ha){return!!this.PJi(Ha)}B3f(Ha){Ha=this.PJi(Ha);return{returnValue:!!Ha,Ipg:Ha}}gsl(Ha){let eb;return({Ipg:eb}=this.B3f(Ha)).returnValue?this.Wvk(eb.ip.paragraphId,eb.ip.Uda.cp):!1}Onm(){if(!this.XG)return[];const Ha=[];for(const eb of this.XG.Tsb())eb.userName?Ha.push(eb):l.ULS.sendTraceTag(592229832,
304,15,"The looked up RTC User has no name");return Ha}dIl(Ha){let eb;return({Ipg:eb}=this.B3f(Ha)).returnValue&&eb.user&&eb.user.presenceStatus&&"0"!==eb.user.presenceStatus?String.format(WacWordeditorStrings.PresenceStatusOnPage,eb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Xzo(){this.GQk(this.settings.id)}static createInstance(Ha,eb,rc,Uc,bd,Hd,Pe){const Le=Ua.StaticActiveAppFrame.Aa().tb,De=m.AFrameworkApplication.va,lf=lb.a.instance,Af=Ma.a.instance.resolve("Box4.ICoauthCashTelemetry");
return new Mh(Ha,eb,mg=>Le.Xc.Aj?Le.Xc.pqf(mg,!0):!1,(mg,hi)=>{Le.Xc.Aj&&Le.Xc.H1b(mg,hi,!0,!0,!1,!1,wb.a.bio)},()=>{Fa.a.HD.tL.Awd()},De,lf,Le,rc,Uc,bd,Hd,Af,Pe)}static WQm(Ha){const eb=Mh.LA.rd.Hd.Mb(Ha.ip.paragraphId);if(void 0===eb||null===eb)return l.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!kb.ParagraphReader.lc(eb))return l.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;Ha=Ob.a.jd(eb,Ha.ip.Uda.cp);return new nc.Selection([Ha],
!0)}}Mh.LA=null;Object(f.a)(Mh,"WordEditorPeoplesWell",Db,[]);class ed{constructor(){this.Gz=()=>{m.AFrameworkApplication.kyj?ed.wxa.jF().continueWith(this.$id):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.$id=()=>{ed.wi=ed.wxa.jF().result;if(ed.wi){var Ha=()=>{const eb=Ua.StaticActiveAppFrame.Aa().tb;return eb?eb.rd?eb.rd.Hd:(l.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,
"Workspace is null"),null)};sb.a.uDa().continueWith(()=>{const eb=sb.a.uDa().result.Vj,rc=qb.a.VLm(m.AFrameworkApplication.mr,m.AFrameworkApplication.mr,m.AFrameworkApplication.mr,m.AFrameworkApplication.mr),Uc=ab.createInstance(rc,eb,Object(Xa.a)(ed.wi.hze,ed.wi.hze.Mnc,"getUserPresence"),Object(Xa.a)(ed.wi.hze,ed.wi.hze.yYa,"getUserStatusInfo"),m.AFrameworkApplication.J.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));Ma.a.instance.ja("RealtimePresenceUI.WordEditorPeoplesWell",()=>Mh.createInstance(Uc,
Ea.a.xr(ed.Z.Za("Common.IPeopleInfoProvider")),ed.Z.Wa("WordEditor.ParagraphWordIdMapping"),ed.Z.Wa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ha,ed.Z.Za("WordEditor.Presence.IWordPresenceCpFactory"),ed.Z.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();ed._instance=Ma.a.instance.resolve("Common.IPeoplesWell");ed._instance.yDo();l.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,15,
"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}Ec(Ha){ed.Z=Ha}init(){m.AFrameworkApplication.J.lq(this.Gz)}dispose(){ed._instance&&(ed._instance.dispose(),ed._instance=null)}static get wxa(){return null!=ed.p8g?ed.p8g:ed.p8g=Ma.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}ed._instance=null;ed.Z=null;ed.wi=null;Object(f.a)(ed,"WordEditorPeoplesWellControlPackage",null,[0,1]);var dd=e(113),Vh=e(265);class Gf{constructor(Ha,
eb,rc,Uc,bd,Hd,Pe,Le,De=!1){this.Kib=null;this.HVe=!0;this.H7e=this.Hl=this.vOe=null;this.sa=new pa.a;this.scn=()=>{this.wQ.result&&this.sFh.result&&(this.Hl=this.wQ.result,this.H7e=this.sFh.result,this.Hl.jBa(this.GW),this.vOe=new Ca.a(2,2,this.keh,this.xCp,88),Gf.Sb.pc(this.vOe))};this.GW=(lf,Af)=>{(this.HVe||this.Awo(Af.aka))&&Gf.Sb.Z5(this.vOe,0)};this.xCp=lf=>{var Af=this.Hl.Hlc();if(Af){var mg=new Date,hi=!1;if(this.HVe){this.Kib=Af;this.HVe=!1;var Uh=this.Kib;for(var nk in Uh){Af=nk;var fi=
Uh[nk];fi.Psc<mg&&(mg=fi.Psc);2===fi.status&&(hi=!0,this.H7e.iod(Af))}hi&&this.gEj();Gf.Sb.Z5(lf,this.FHi(mg))}else{fi=new U.a;nk=!1;var kc=this.Kib;for(Uh in kc){kc=Uh;if(!(kc in this.Kib)||this.dUa.clientId===kc)continue;var Ze=this.Kib[kc];const Fg=Af[kc];if(Ze&&Fg){Ze=Ze.status;const ii=Fg.status;2===Ze&&1===ii?(fi.add(kc),l.ULS.sendTraceTag(38052609,392,50,kc+" returned from away")):1===Ze&&2===ii&&(nk=hi=!0,this.H7e.iod(kc),l.ULS.sendTraceTag(38052610,392,50,kc+" went away"));1===ii&&Fg.Psc<
mg&&(mg=Fg.Psc)}}this.Kib=Af;Gf.Sb.Z5(lf,this.FHi(mg));(0<fi.count||hi)&&this.gEj();0<fi.count&&!this.QQk?(lf=this.nsm(fi),this.ktp(lf)):lf=new U.a;(nk||0<lf.count)&&this.HPk(mc.a.IZd,2)}}};this.dUa=Ha;this.wQ=eb;this.sFh=rc;this.BQc=Uc;this.keh=Hd;Gf.Sb=bd;this.HPk=Pe;this.bba=Le;this.QQk=De;E.Task.WAA(eb,rc).continueWith(this.scn)}f9k(Ha){this.sa.addHandler("u",Ha)}gEj(){this.sa.raiseEvent("u",null,this)}Awo(Ha){for(const rc in Ha){var eb=this.BQc.Kae({key:rc,value:Ha[rc]});if(eb&&eb.clientId&&
(eb=eb.clientId.toLowerCase(),(eb=this.Kib[eb]||this.Kib[eb.toUpperCase()])&&2===eb.status))return!0}return!1}ktp(Ha){if(Ha.count)for(const eb of Ha)Ha=this.bba.Hma(String.format(CommonUIStrings.l_EditorsToastArriving,eb),!1),Ha.image=5,Ha.Pna="CoAuth_AuthorStatus_16x16x32",this.bba.yB(Ha)}nsm(Ha){const eb=this.Hl.Ssb(),rc=new U.a;for(const Uc in eb){const bd={key:Uc,value:eb[Uc]};if(Ha.contains(bd.key)){const Hd=this.BQc.Kae(bd);Hd&&(rc.add(Hd.userName),Ha.remove(bd.key))}}rc.count||l.ULS.sendTraceTag(38052611,
392,10,"There were no coauthor names found");return rc}FHi(Ha){const eb=new Date;return Math.max(Ha.getTime()+this.keh-eb.getTime(),0)}}Gf.Sb=null;Object(f.a)(Gf,"AwayManager",null,[]);var Td=e(807);class Xc{constructor(Ha=0){this.updates=Ha}get TVf(){return 0!==this.updates}Aha(Ha){return!!(this.updates&Ha)}pgb(Ha){this.updates|=Ha}toString(){if(this.Aha(0))return"none";const Ha=new U.a;this.Aha(1)&&Ha.add("user(s) joined");this.Aha(2)&&Ha.add("user(s) disconnected");this.Aha(4)&&Ha.add("user(s) updated");
return Ha.toArray().join(", ")}}Object(f.a)(Xc,"UserUpdateEvent",null,[]);var de=e(25);class ze{constructor(Ha,eb,rc,Uc,bd=null){this.sa=new pa.a;this.dL=this.wi=null;this.VAh=this.wBh=this.Vm=!1;this.xs=new dc.a;this.vQg=()=>{if(this.wi){var Hd=!1,Pe=this.wi.Hlc();for(const De in Pe){var Le=Pe[De];const lf=De;this.users.Bb(lf)&&(Le=this.g8j(Le),Hd=this.users.K(lf).zOb!==Le||Hd,this.users.K(lf).zOb=Le)}Hd&&(Hd=new Xc(4),this.lAe(Hd))}};this.vtj=(Hd,Pe)=>{2===Pe.newState&&(Hd=this.Abg(this.wi.Ssb()),
Hd.TVf&&this.lAe(Hd))};this.jZb=(Hd,Pe)=>{Hd=new Xc;var Le=this.dL.J4c();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",Le.length,Pe.H0n,Pe.Zlj);const De=new dc.a;for(var lf of Le){Le=lf.Id;const Af=this.vgi(Le);this.uQg(Hd,Af);De.W(Le,Af)}if((Pe=Pe.s7f)&&0<Pe.length)for(lf=0;lf<Pe.length;lf++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",
this.users.count,Pe.K(lf).Id),({value:Le}=this.users.Nc(Pe.K(lf).Id)).returnValue?Le?(this.users.remove(Pe.K(lf).Id),Hd.pgb(2),De.W(Pe.K(lf).Id,Le)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",Pe.K(lf).Id):l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",Pe.K(lf).Id);Pe=this.wi.Ssb();for(const Af in Pe)lf=this.BQc.Kae({key:Af,value:Pe[Af]}),De.W(lf.clientId,lf);for(const Af of this.users)De.Bb(Af.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",
Af.key),this.users.remove(Af.key),Hd.pgb(2));Hd.TVf&&this.lAe(Hd)};this.xtj=(Hd,Pe)=>{Hd=this.Abg(Pe.aka);for(const Le of Pe.d1c)this.users.Bb(Le)&&(Hd.pgb(2),this.users.K(Le).zOb=2);Hd.TVf&&this.lAe(Hd)};Ha.continueWith(()=>{this.wi=Ha.result;this.wi.jBa(this.xtj);this.wi.K0(this.vtj);this.vQg(null,null)});eb.continueWith(()=>{this.dL=eb.result;this.dL.s8a(this.jZb)});bd&&bd.continueWith(()=>{bd.result.f9k(this.vQg);this.vQg(null,null)});this.uUa=rc;this.BQc=Uc}get users(){return this.xs}hfc(Ha){this.sa.addHandler("UU",
Ha)}Mwg(Ha){this.sa.removeHandler("UU",Ha)}g8j(Ha){return 1===Ha.status?0:1}Tsb(){this.users.count||(this.wBh||(de.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.wBh=!0),this.dlo());const Ha=[];for(const eb of this.users)Array.add(Ha,eb.value);return Ha}dlo(){if(this.wi){var Ha=this.wi.Ssb();this.Abg(Ha)}if(this.dL){Ha=this.dL.J4c();for(const eb of Ha)eb.Id&&(Ha=this.vgi(eb.Id),this.uQg(new Xc,Ha))}}F$f(Ha){({value:Ha}=this.users.Nc(Ha));return Ha}dispose(){this.Vm||
(this.wi&&(this.wi.A1a(this.xtj),this.wi.MFa(this.vtj)),this.dL&&this.dL.uJj(this.jZb),this.Vm=!0)}Abg(Ha){const eb=new Xc;if(!Ha)return eb;for(const Uc in Ha){var rc=this.BQc.Kae({key:Uc,value:Ha[Uc]});rc&&(rc=rc.clone(),this.uQg(eb,rc))}return eb}uQg(Ha,eb){if(eb){var rc=eb.clientId,Uc=this.QOo(eb);({value:eb}=this.users.Nc(rc)).returnValue?eb.equals(Uc)||(Ha.pgb(4),this.users.W(rc,Uc)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,rc),Ha.pgb(1),
this.users.W(rc,Uc))}}vgi(Ha){return this.users.Bb(Ha)?this.users.K(Ha):xa.a.lMl(Ha)}QOo(Ha){if(!Ha||!Ha.clientId||!this.dL)return Ha;const eb=Ha.clone();eb.zOb=this.msm(Ha);if(Ha=this.dL.Vlc(eb.clientId))eb.isReadOnly=eb.isReadOnly||Ha.IsReadOnly?!0:!1,eb.userName=this.POo(eb,Ha),eb.capabilities=this.ZTn(eb.capabilities,Ha.Capabilities),eb.email=eb.email||Ha.SIPAddress||Ha.EmailAddress,Ha.JoinCoauthTime&&(eb.l_a=Ha.JoinCoauthTime);eb.color=this.uUa.Knc(new Td.a(eb.email,void 0,eb.userName,void 0,
eb.isAnonymous,eb.clientId),3);return eb}msm(Ha){if(!this.wi)return 2;if(Ha&&Ha.clientId){const eb=this.wi.Hlc();if(Ha.clientId in eb)return this.g8j(eb[Ha.clientId])}return 2}wDl(Ha,eb){eb.Name&&Ha.userName&&eb.Name!==Ha.userName&&!this.VAh&&(this.VAh=!0,de.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}ZTn(Ha,eb){Ha=Ha||new sa.a;eb&&(eb.SupportsRealtimeChannel&&Ha.pgb(1),eb.SupportsRename&&Ha.pgb(2),eb.SupportsChat&&Ha.pgb(4));return Ha}POo(Ha,eb){this.wDl(Ha,eb);return eb.Name||
Ha.userName||(Ha.isAnonymous||eb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}lAe(Ha){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Ha.toString());this.sa.raiseEvent("UU")}}Object(f.a)(ze,"PeopleInfoProvider",null,[1882,11]);var jf;(function(Ha){Ha[Ha.lXn=0]="multipleBrowsersImageClassName";Ha[Ha.$ho=1]="peopleImageClassName";Ha[Ha.aio=4]="peopleImageClusterPath";Ha[Ha.kXn=5]="multipleBrowserImageClusterPath";Ha[Ha.IUb=6]="imageDimension";Ha[Ha.rtl=8]="rtl";Ha[Ha.Dkd=
9]="pointerInputManager";Ha[Ha.JS=10]="clickInputManager";Ha[Ha.vertical=11]="vertical";Ha[Ha.zIndex=12]="zIndex";Ha[Ha.TOb=13]="contextMenuInputManager";Ha[Ha.Ybq=14]="imageDomElement";Ha[Ha.Czq=15]="useIdleTooltip";Ha[Ha.UMp=16]="viewportBoundsCallback";Ha[Ha.k9p=17]="flipHorizontalDirection";Ha[Ha.f9p=18]="fixRemoveFadeOutElementCrash";Ha[Ha.r$m=19]="ignoreEventOnExpandedTooltip";Ha[Ha.Ukn=20]="ipWidthAdjustForFlyout"})(jf||(jf={}));Object(f.b)("PresenceTooltipSettingKeys",jf);class hc{constructor(){this.Uw=
{}}get(Ha,eb=null){Ha=jf[Ha];return"number"===typeof eb?(eb=this.Uw[Ha])?Number.parseInvariant(eb.toString()):0:this.Uw[Ha]}add(Ha,eb){this.Uw[jf[Ha]]=eb}EVa(Ha,eb){jf[Ha]in this.Uw||(this.Uw[jf[Ha]]=eb)}remove(Ha){delete this.Uw[jf[Ha]]}}Object(f.a)(hc,"PresenceTooltipSettings",null,[]);class wc extends pa.a{constructor(Ha){super();this._element=null;this.element=Ha}get element(){return this._element}set element(Ha){this._element=Ha}get visible(){return"visible"===this.element.style.visibility}set visible(Ha){this.element.style.visibility=
Ha?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ha){this.element.dir=Ha?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ha){this.element.style.zIndex=String(Ha)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ha){return this.element.ownerDocument.createElement(Ha)}Vpa(){return!0}static Jfi(Ha){return"prControl"+(Ha?"Rtl":"")}}Object(f.a)(wc,"BasePresenceControl",
pa.a,[11,1885]);class Pc extends Sys.EventArgs{constructor(Ha,eb){super();this.type=Ha;this.iq=eb}}Pc.sZ="InteractivityChanged";Object(f.a)(Pc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class md{static Evm(Ha){return md.Fvm(Ha)}static Fvm(Ha){const eb=document.createElementNS(md.dTg,"svg");eb.setAttribute("viewBox",String.format(md.yTl,md.vgk,md.ugk));eb.appendChild(md.fTm(Ha));return eb}static fTm(Ha){const eb=md.vgk/Ha,rc=2*eb,Uc=md.ugk/2;Ha=(Ha-12-8)*eb/2;const bd=document.createElementNS(md.dTg,
"g");Sys.UI.DomElement.addCssClass(bd,md.xTl);for(let Hd=1;3>=Hd;Hd++)bd.appendChild(md.Xrm(Hd,rc,Ha+(6*Hd-2)*eb,Uc));return bd}static Xrm(Ha,eb,rc,Uc){const bd=document.createElementNS(md.dTg,"circle");Sys.UI.DomElement.addCssClass(bd,String.format("{0}-{1}",md.axl,Ha));bd.setAttribute("cx",String.format("{0}",rc));bd.setAttribute("cy",String.format("{0}",Uc));bd.setAttribute("r",String.format("{0}",eb));return bd}}md.dTg="http://www.w3.org/2000/svg";md.xTl="prDancingDots";md.axl="prAnimateCircle";
md.yTl="0 0 {0} {1}";md.ugk=40;md.vgk=120;Object(f.a)(md,"ModernPresenceTooltipDancingDots",null,[]);var fe=e(104),se=e(105),$d=e(10),Md=e(204),Ub=e(169),Vc=e(82);class qd extends wc{constructor(Ha,eb){super(Ha);this.kPh=this.xkb=this.kQe=this._img=this.dQ=this.hz=this.xh=null;this.QUa=eb.get(8,!1);this.dkb=eb.get(6,0);this.cYk=eb.get(15,!1);this.ef=eb;this.Kmh=0;this.element=Ha;this.element.className=qd.uHf;this._span=document.createElement("span");this.element.appendChild(this._span);this.fAk=md.Evm(eb.get(6,
0));this.EG(eb);this._state=5}QMb(Ha){this.addHandler(Pc.sZ,Ha)}P0b(Ha){this.removeHandler(Pc.sZ,Ha)}get user(){return this.kPh}get state(){return this._state}dispose(){this.element&&(this.xh.Gc($d.a.click,this.element,Object(Xa.a)(this,this.onClick,"onClick")),this.xh.Gc($d.a.dF,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),this.hz.Gc($d.a.Lu,this.element,Object(Xa.a)(this,this.rA,"onPointerDown")),this.hz.Gc($d.a.kJ,this.element,Object(Xa.a)(this,this.RN,"onPointerOut")),
this.hz.Gc($d.a.WN,this.element,Object(Xa.a)(this,this.eU,"onPointerOver")),this.dQ.Gc(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}EG(Ha){this.xh=Ha.get(10);this.xh.Cb($d.a.click,this.element,Object(Xa.a)(this,this.onClick,"onClick"));this.xh.Cb($d.a.dF,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior"));this.hz=Ha.get(9);this.hz.Cb($d.a.WN,this.element,Object(Xa.a)(this,this.eU,"onPointerOver"));this.hz.Cb($d.a.kJ,
this.element,Object(Xa.a)(this,this.RN,"onPointerOut"));this.hz.Cb($d.a.Lu,this.element,Object(Xa.a)(this,this.rA,"onPointerDown"));this.dQ=Ha.get(13);this.dQ.Cb(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior"))}hide(Ha=null,eb=0,rc=0){this.cYk&&Ha?this.Fep(Ha,eb,rc):(3===this.state&&this.cIj(),this.visible=!1,this._state=5)}Fep(Ha,eb,rc=0){this.show(Ha,eb,15,4,void 0,rc)}JZj(Ha,eb,rc=!1,Uc=!1,bd=!1,Hd=0){this.show(Ha,eb,20,rc?2:Uc?1:0,bd,Hd)}bep(Ha,eb,rc,Uc=!1,
bd=0){this.show(Ha,eb,rc+20,3,Uc,bd)}show(Ha,eb,rc,Uc=3,bd=!1,Hd=0){!Ha||Uc===this.state&&this.o5m(eb,rc)||(this.y0k(Uc,bd,Hd),this.Tla(Ha,Uc,Hd),this._state=Uc,4===Hd||0===Hd&&!this.QUa?this.element.style.left=eb+"px":this.element.style.right=eb+"px",this.element.style.top=rc+"px",this.visible=!0)}Tla(Ha,eb,rc){this.kPh=Ha;Vc.a.fH(this._span);Ub.a.Hyl(this._span);this._span.id="fly_"+Ha.clientId;this._span.style.backgroundColor=Ha.color;4!==eb?(this._span.style.height=this.dkb+"px",this._span.style.lineHeight=
this.dkb+"px",Ub.a.y2b(this._span,"border-radius",this.dkb+"px")):4===rc||0===rc&&!this.QUa?this._span.style.left="0px":this._span.style.right="0px";2!==eb&&(4===eb?Vc.a.Mz(this._span,""):1===eb?this._span.appendChild(this.fAk):(this._span.setAttribute("dir","auto"),rc=Lb.a.lDm(Ha.userName),(!Ha.isAnonymous||m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&rc||0!==eb?(Ha=Ha.userName,0===eb&&(Ha=rc,Ub.a.y2b(this._span,"text-align","center")),
Vc.a.Mz(this._span,Ha)):(this._img||(this._img=this.SJl()),this._span.appendChild(this._img),Ub.a.y2b(this._span,"text-align","start"))))}onClick(Ha){if(0===this.state)return this.raiseEvent(Pc.sZ,new Pc(1,Ha)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}RN(Ha){3===this.state&&this.raiseEvent(Pc.sZ,new Pc(3,Ha));return!1}eU(Ha){3!==Ha.Og&&this.raiseEvent(Pc.sZ,new Pc(2,Ha));return!1}rA(Ha){if(3!==Ha.Og)return!0;this.raiseEvent(Pc.sZ,new Pc(4,Ha));
return!1}SJl(){const Ha=document.createElement("img");Ha.src=fe.a.Bga("doughperson_white_glyph.svg");Ha.setAttribute("Unselectable","on");Md.a.ju(Ha,Md.a.fi,Md.a.NA);return se.createClusteredImageFromClusterWithImageClass(this.dkb,this.dkb,null,null,qd.Bhm,"",!1,"",this.element.ownerDocument,Ha)}y0k(Ha,eb=!1,rc=0){if(!this.Lad(this.state)||!this.Lad(Ha))switch(Sys.UI.DomElement.removeCssClass(this.element,this.kQe),this.state){case 4:3===Ha?this.g8a(qd.vHf,qd.Xui):this.Lad(Ha)&&this.g8a(qd.tHf,qd.Xui);
break;case 3:4===Ha?this.g8a(qd.yHf,qd.Wui):this.Lad(Ha)&&(eb&&this.cIj(),this.g8a(qd.tHf,qd.Wui,eb?qd.Ahm:""));break;case 0:case 1:case 2:4===Ha?this.g8a(qd.yHf,qd.wHf):3===Ha&&(eb&&this.K1k(),this.g8a(qd.vHf,qd.wHf,eb?qd.Yui:"",3===rc?qd.Ehm:qd.Chm));break;default:4===Ha?this.g8a(qd.yHf):3===Ha?this.g8a(qd.vHf):this.Lad(Ha)&&this.g8a(qd.tHf)}}g8a(...Ha){this.kQe=Ha.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.kQe)}K1k(){this.Kmh=window.setTimeout(()=>{this.element&&(this.xkb=this.element.cloneNode(!0),
this.element.parentNode.appendChild(this.xkb),this.element.style.zIndex="2",this.xkb.style.zIndex="1")},300)}cIj(){window.clearTimeout(this.Kmh);this.xkb&&(Sys.UI.DomElement.removeCssClass(this.xkb,qd.wHf+" "+qd.Yui),Sys.UI.DomElement.addCssClass(this.xkb,qd.zhm),E.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.xkb.parentNode&&this.element.parentNode.removeChild(this.xkb)}),Ub.a.$xc(this.element,"z-index"))}Lad(Ha){return 0===Ha||1===Ha||2===Ha}o5m(Ha,eb){const rc=
Ub.a.D2(this.element.style.top);return Ub.a.D2(this.element.style.left)===Ha&&rc===eb}Pxg(Ha){3===Ha&&Ub.a.sga(this.element,"left")?(Ha=Ub.a.D2(this.element.style.left),Ub.a.$xc(this.element,"left"),this.element.style.right=-1*Ha+"px"):4===Ha&&Ub.a.sga(this.element,"right")&&(Ha=Ub.a.D2(this.element.style.right),Ub.a.$xc(this.element,"right"),this.element.style.left=-1*Ha+"px")}}qd.uHf="prModernFlyout UIFont";qd.yHf="flyoutIdle";qd.vHf="flyoutExpanded";qd.tHf="flyoutCollapsed";qd.Xui="flyoutFromIdle";
qd.Wui="flyoutFromExpanded";qd.wHf="flyoutFromCollapsed";qd.Yui="flyoutStacked";qd.Ahm="flyoutFromStacked";qd.zhm="flyoutFadeOut";qd.Bhm="cui-img-cont-float cui-img-20by20";qd.Chm="flyoutLtrDir";qd.Ehm="flyoutRtlDir";Object(f.a)(qd,"ModernPresenceTooltipFlyoutControl",wc,[]);class vb{constructor(Ha,eb,rc=2,Uc=4){this.offsetTop=Ha;this.offsetLeft=eb;this.qgk=rc;this.cUi=Uc}}Object(f.a)(vb,"FlyoutsPositioningInfo",null,[]);var Kb=e(59);class Ic{constructor(Ha=!1,eb=!1){this.yGg=!1;this.zn=Ha;this.MVe=
eb;this.yGg=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.OfficeVSO:9192023_CalculateFlyoutDirectionsToHandleRTLScenarios")}AEm(Ha,eb,rc,Uc,bd){const Hd=bd.y,Pe=bd.height;var Le=this.iqm(Uc);const De=Le+eb,lf=Ha*rc+2*(Ha-1);rc=null;1===Ha||this.Crl(Le,lf,Hd,Pe)?Ha=new vb(0,0,2):(Ha=this.cHf(De,lf,Hd,Pe),Ha.offsetTop-=Le);this.MVe?rc=new vb(0,0,void 0,this.zn?4:3):(Uc=this.hqm(Uc,bd),Le=Math.max(0,bd.x),bd=bd.width,eb=Uc+eb,this.yGg?rc=this.Hrl(Uc,Le,bd):this.Drl(Uc,
Le,bd)?rc=new vb(0,0,void 0,this.zn?3:4):this.Erl(eb,Le)&&(rc=new vb(0,0,void 0,this.zn?4:3)),rc||(rc=this.ngm(Uc,eb,Le,bd)));return new vb(Ha.offsetTop,rc.offsetLeft,Ha.qgk,rc.cUi)}iqm(Ha){return Kb.a.AKf(Ha)}hqm(Ha,eb){return this.zn?this.yGg?Kb.a.zKf(Ha)-Kb.a.lzi(Ha):eb.width-Kb.a.zKf(Ha):Kb.a.yKf(Ha)}Crl(Ha,eb,rc,Uc){return Ha+eb<=rc+Uc}cHf(Ha,eb,rc,Uc){let bd=1,Hd=Math.max(rc,Ha-eb);eb>Ha-rc&&(bd=2,Hd=eb<Uc?Uc-eb:rc);return new vb(Hd,0,bd)}Hrl(Ha,eb,rc){const Uc=this.Frl(Ha,eb);Ha=this.Grl(Ha,
eb,rc);if(Uc||Ha)return new vb(0,0,void 0,this.zn?Uc?3:4:Ha?4:3)}Drl(Ha,eb,rc){return Ha+150<=eb+rc}Erl(Ha,eb){return 150<=Ha-eb}Grl(Ha,eb,rc){return Ha+150<=eb+rc}Frl(Ha,eb){return eb<=Ha-150}ngm(Ha,eb,rc,Uc){Uc-eb>=Ha-rc?Ha=4:(eb=Ha,Ha=3);return new vb(0,eb,void 0,Ha)}}Object(f.a)(Ic,"ModernPresenceTooltipPositioner",null,[]);class kd{constructor(Ha,eb,rc,Uc,bd,Hd,Pe){this.ofa=Ha;this._parent=eb;this.Zgh=rc;this.Swk=Uc;this.aFk=bd;this.xdc=Hd;this.QUa=Pe;this._element=document.createElement("div");
this.element.className="prTouchTarget"}get element(){return this._element}update(Ha,eb){if(3!==Ha)if(5!==Ha&&this.ofa&&this.ofa.length){if(4===Ha){var rc=this.aFk;var Uc=(this.xdc-rc)/2;this.element.style.height=this.xdc+"px";this.element.style.width=this.xdc+"px";Ha=Ub.a.D2(this.ofa[0].element.style.top);eb=Ub.a.D2(this.QUa?this.ofa[0].element.style.right:this.ofa[0].element.style.left)}else rc=this.Zgh,Uc=(this.xdc-rc)/2,this.element.style.height=this.xdc+"px",this.element.style.width=this.ssm()+
2*Uc+"px",Ha=Ub.a.D2(this.ofa[this.ofa.length-1].element.style.top),eb=this.Mql(this.ofa[this.ofa.length-1].element,rc,eb);Ub.a.y2b(this.element,"border-radius",this.xdc+"px");this.element.style.top=Ha-Uc-rc+"px";this.QUa?this.element.style.right=eb-Uc+"px":this.element.style.left=eb-Uc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}Mql(Ha,eb,rc){return this.QUa&&!rc?Ub.a.D2(Ha.style.right):
this.QUa||rc?this.QUa&&rc?-Ub.a.D2(Ha.style.left)-eb:-Ub.a.D2(Ha.style.right)-eb:Ub.a.D2(Ha.style.left)}ssm(){return this.ofa&&this.ofa.length?this.Zgh+Math.min(this.ofa.length-1,2)*this.Swk:0}}Object(f.a)(kd,"ModernPresenceTooltipTarget",null,[]);var Wd=e(152),Ye=e(189);class Re extends wc{constructor(Ha,eb,rc){super(Ha);this.Sbc=this.yTa=this.Qrh=this.xGb=!1;this.xs=[];this.k0a=(Uc,bd)=>{Uc=this.s4b;this.Njl()||2!==bd.type&&(4!==bd.type||3===Uc)?4===bd.type&&3===Uc?(this.yTa&&(this.yTa=!1),this.Qsf()):
3!==bd.type||3!==Uc||this.xGb||(1<this.cab?(this.yTa=!0,E.Task.delay(250).continueWith(()=>{this.uhc(!0);this.yTa=!1})):this.Qsf()):(this.yTa&&(this.yTa=!1),3!==Uc&&(this.yri(),3===bd.iq.Og&&this.Qsf(2E3)));this.raiseEvent(Pc.sZ,bd)};this.lvc=Uc=>{3===Uc.Og?this.k0a(this,new Pc(4,Uc)):Uc.eventName===$d.a.WN?this.k0a(this,new Pc(2,Uc)):Uc.eventName===$d.a.kJ&&this.k0a(this,new Pc(3,Uc));return!1};this.tGd={};this.ef=rc;this.zn=rc.get(8,!1);this.Aqh=rc.get(15,!1);this.Xyk=rc.get(12,0);this.ppb=rc.get(6,
0);this.xnb=eb;this.GPh=rc.get(16);this.MVe=rc.get(17,!1);this.dFk=rc.get(19,!1);this.xPk=rc.get(20,!1);this.hJd=0;this.rPk=new Ic(this.zn,this.MVe);this.SFc=this.QBi();this.DJb=!1;this.t6b=[];this.GLc=[];this.element.id=Re.Hsb();this.element.className=wc.Jfi(this.zn);this.e$a&&(this.zIndex=this.e$a);this.rtl=this.zn;this.CCg(eb);this.Eaa=this.createElement("div");this.Eaa.className="prFlyoutContainer";this.element.appendChild(this.Eaa);this.ofa=[];this.Xkb=new kd(this.P8,this.element,this.ppb,4,
6,32,this.zn);this.hz=rc.get(9);this.hz.Cb($d.a.Lu,this.Xkb.element,this.lvc);this.hz.Cb($d.a.WN,this.Xkb.element,this.lvc);this.hz.Cb($d.a.kJ,this.Xkb.element,this.lvc)}get oue(){return Ye.a.clone(this.xs)}get P8(){return this.ofa}get e$a(){return this.Xyk}get cab(){return this.P8?this.P8.length:0}get s4b(){return 0<this.cab?this.P8[0].state:5}get l1f(){return 3===this.s4b&&!this.xGb}QMb(Ha){this.addHandler(Pc.sZ,Ha)}P0b(Ha){this.removeHandler(Pc.sZ,Ha)}dispose(){if(this.l1f)this.DJb=!0;else{if(this.P8)for(const Ha of this.P8)Ha.P0b(this.k0a),
dd.a.BF(Ha);this.ofa=null;this.hz.Gc($d.a.Lu,this.Xkb.element,this.lvc);this.hz.Gc($d.a.WN,this.Xkb.element,this.lvc);this.hz.Gc($d.a.kJ,this.Xkb.element,this.lvc);super.dispose()}}PAc(){this.uhc();this.visible=!0}Nsd(){this.visible=!0;this.yri();this.xGb=!0}BGg(){this.Nsd()}hide(){this.JIj();this.Hbb();this.Xkb.update(this.s4b,this.Sbc)}Tla(Ha){const eb=this.s4b,rc=this.xGb;Ha.clientId||(Ha.clientId=(Re.$Lc++).toString());if(Ha.clientId in this.tGd){var Uc=this.ARb(Ha.clientId);if(0<=Uc){Uc=this.xs[Uc];
if(Uc.color===Ha.color&&Uc.userName===Ha.userName)return;this.Cfb(Ha.clientId)}}this.hide();Uc=new qd(this.createElement("div"),this.ef);Uc.QMb(this.k0a);this.Eaa.insertBefore(Uc.element,this.Eaa.firstChild);this.tGd[Ha.clientId]=Uc;Array.add(this.xs,Ha);Array.add(this.P8,Uc);this.qek(eb,rc);this.visible=!0}Cfb(Ha){if(this.l1f)Array.add(this.GLc,Ha);else{var eb=this.s4b,rc=this.xGb;this.hide();this.hod(Ha);this.qek(eb,rc)}}Okj(Ha){const eb=this.ARb(Ha);if(!(0>=eb)){var rc=this.xs[eb];Ha=this.tGd[Ha];
Array.removeAt(this.xs,eb);Array.insert(this.xs,0,rc);Array.removeAt(this.P8,eb);Array.insert(this.P8,0,Ha);this.Eaa.removeChild(Ha.element);this.Eaa.appendChild(Ha.element);this.uhc()}}qek(Ha,eb){0>=this.xs.length?this.hide():3===Ha&&eb?this.Nsd():this.PAc()}DEf(Ha){if(this.l1f&&this.dFk)return!1;Ha=Re.oQf(Ha);if(this.Eaa!==Ha&&Vc.a.yZa(this.Eaa,Ha))return!0;for(const eb of this.P8)if(Vc.a.yZa(eb.element,Ha))return!0;return!1}position(Ha,eb){this.element.style.top=eb+"px";this.element.style.left=
Ha+"px"}uhc(Ha=!1){if(!Ha||this.yTa){this.Qrh&&this.yVj(!0);var eb=Math.min(3,this.cab)-1;Ha=0;var rc=1,Uc=0;this.Sbc&&(Ha=this.SFc,rc=-1,Uc=-this.ppb);for(let bd=this.cab-1;bd>eb;bd--)this.P8[bd].JZj(this.xs[bd],-4*eb*rc+Uc,!0,!1,!0,Ha);for(;0<=eb;eb--)this.P8[eb].JZj(this.xs[eb],-4*eb*rc+Uc,0<eb,Array.contains(this.t6b,this.xs[eb].clientId),eb!==this.hJd,Ha);this.hJd=0;this.Xkb.update(0,this.Sbc);this.zIndex=this.e$a;this.xGb=!1;this.JIj(0);this.DJb&&this.dispose()}}yri(){this.Qrh&&this.yVj(!1);
this.zIndex=this.e$a+1;const {offsetX:Ha,offsetY:eb,bUi:rc}=this.l2o();for(let Uc=0;Uc<this.cab;Uc++)this.P8[Uc].bep(this.xs[Uc],Ha,eb+(this.ppb+2)*Uc,Uc!==this.hJd,rc)}Hbb(){let Ha=0,eb=0;this.Sbc&&(Ha=this.SFc,eb=-6);for(let rc=0;rc<this.cab;rc++)this.P8[rc].hide(this.xs[rc],eb,Ha);this.zIndex=this.e$a;this.visible=this.xGb=!1;this.DJb&&this.dispose()}Qsf(Ha=0){Ha?(this.yTa=!0,E.Task.delay(Ha).continueWith(()=>{this.Aqh?this.e7m():this.uhc(!0);this.yTa=!1})):this.Aqh?this.hide():this.uhc()}e7m(){this.yTa&&
this.hide()}Njl(){if(m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Pb.oEa&&Wd.c()){const Ha=appChrome.selectors.getShyState();return Ha.isActive&&0!==Ha.state}return!1}CCg(Ha){this.element.style.width=Ha+"px";this.element.style.height=this.ppb+"px"}hod(Ha){this.sFo(Ha);Ha=this.ARb(Ha);if(!(0>Ha)){var eb=this.xs[Ha];Array.removeAt(this.xs,Ha);delete this.tGd[eb.clientId];eb=this.P8[Ha];this.Eaa.removeChild(eb.element);this.ef.get(18,!1)&&eb.P0b(this.k0a);Array.removeAt(this.P8,Ha);eb.dispose()}}JIj(Ha=
5){if(this.GLc.length){this.visible&&this.Hbb();for(let eb=0;eb<this.GLc.length;eb++)this.hod(this.GLc[eb]);Array.clear(this.GLc);0>=this.xs.length||5===Ha?this.hide():0===Ha&&this.PAc()}}ARb(Ha){for(let eb=0;eb<this.xs.length;eb++)if(this.xs[eb].clientId===Ha)return eb;return-1}sFo(Ha){-1===this.ARb(Ha)?l.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.t6b,Ha)&&(Array.remove(this.t6b,Ha),this.xs[0].clientId===Ha&&0<this.t6b.length&&
this.Okj(this.t6b[this.t6b.length-1]),this.xs[0].clientId===Ha&&1===this.s4b&&this.uhc())}yVj(Ha){Ha?Sys.UI.DomElement.addCssClass(this.Eaa,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.Eaa,"prBackgroundSelection")}l2o(){let Ha,eb;eb=Ha=0;var rc=this.SFc;if(this.GPh){const Uc=this.GPh(this);if(!Uc)return{offsetX:Ha,offsetY:eb,bUi:rc};const bd=4===this.s4b;rc=this.rPk.AEm(this.cab,bd?6:this.ppb,this.ppb,this.element,Uc);eb=rc.offsetTop;this.hJd=this.aDm(rc.qgk,rc.offsetTop);rc=rc.cUi;
rc!==this.SFc&&(this.Pxg(rc),this.element.dir=3===rc?"rtl":"ltr",this.SFc=rc);rc!==this.QBi()?(Ha=this.xPk?-2:bd?-6:-this.ppb,this.Sbc=!0):this.Sbc=!1}return{offsetX:Ha,offsetY:eb,bUi:rc}}aDm(Ha,eb){if(1===Ha)return this.cab-1;Ha=Math.abs(eb);return 0<Ha?Ha/(this.ppb+2):0}Pxg(Ha){for(let eb=0;eb<this.cab;eb++)this.P8[eb].Pxg(Ha)}QBi(){return this.zn?3:4}static Hsb(){return String.format("{0}-{1}","presencetooltip",Re.$Lc++)}static oQf(Ha){return Ha.Yb.rawEvent.relatedTarget}}Re.$Lc=0;Object(f.a)(Re,
"ModernPresenceTooltipControl",wc,[1930,11]);var le=e(307),Bh=e(309);class gf{constructor(Ha){this.ef=Ha;this.ef.EVa(10,le.a.instance);this.ef.EVa(9,Vh.a.instance);this.ef.EVa(6,20);this.ef.EVa(13,Bh.a.instance);this.ef.EVa(17,!1)}Qvf(Ha,eb=!1){this.ef.EVa(15,eb);return new Re(Ha,20,this.ef)}}Object(f.a)(gf,"ModernPresenceTooltipFactory",null,[1929]);class Wf extends wc{constructor(Ha,eb){super(Ha);this.xs=null;this.QUa=eb.get(8,!1);this.dkb=eb.get(6,0);this.element=Ha;this.element.className=Wf.uHf;
this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.xh=eb.get(10);this.xh.Cb($d.a.click,this.element,Object(Xa.a)(this,this.onClick,"onClick"));this.hz=eb.get(9);this.hz.Cb($d.a.kJ,this.element,Object(Xa.a)(this,this.RN,"onPointerOut"));this.hz.Cb($d.a.Lu,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior"));this.dQ=eb.get(13);this.dQ.Cb(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior"))}QMb(Ha){this.addHandler(Pc.sZ,
Ha)}P0b(Ha){this.removeHandler(Pc.sZ,Ha)}get users(){return this.xs}dispose(){this.element&&(this.xh.Gc($d.a.click,this.element,Object(Xa.a)(this,this.onClick,"onClick")),this.hz.Gc($d.a.Lu,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),this.hz.Gc($d.a.kJ,this.element,Object(Xa.a)(this,this.RN,"onPointerOut")),this.dQ.Gc(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ha,eb,rc){this.hide();
!Ha||0>=Ha.length||(this.QUa?this.element.style.right=eb+"px":this.element.style.left=eb+"px",this.element.style.top=rc+"px",this.V5k(Ha),this.visible=!0)}V5k(Ha){this.xs=Ha;Vc.a.fH(this._ul);for(let eb=Ha.length-1;0<=eb;eb--)this.Tla(Ha[eb])}Tla(Ha){const eb=document.createElement("li");eb.style.backgroundColor=Ha.color;eb.style.height=this.dkb+"px";eb.id="fly_"+Ha.clientId;eb.style.lineHeight=this.dkb+"px";Vc.a.Mz(eb,Ha.userName);eb.setAttribute("dir","auto");this._ul.appendChild(eb)}onClick(){this.hide();
return!1}RN(Ha){this.raiseEvent(Pc.sZ,new Pc(3,Ha));return!1}}Wf.uHf="prFlyout UIFont";Object(f.a)(Wf,"PresenceTooltipFlyoutControl",wc,[]);class $i extends wc{constructor(Ha,eb,rc){super(Ha);this._img=null;this.xs=[];this.element.className="prGlyph";this.ef=eb;this.xbc=this.ef.get(9);this.Ws=this.ef.get(10);this.dQ=this.ef.get(13);this.R8m();this.Tla(rc);this.k_e=!1}get jeb(){return this.xs.length}get users(){return this.xs}QMb(Ha){this.addHandler(Pc.sZ,Ha)}P0b(Ha){this.removeHandler(Pc.sZ,Ha)}dispose(){this.nAp();
super.dispose()}Tla(Ha){Array.add(this.xs,Ha);2===this.jeb?this.uqa(!0):1===this.jeb?this.uqa(!1):this.uqa(this.k_e)}Cfb(Ha){this.Fdm(Ha)&&(1<this.jeb&&this.uqa(!0),1===this.jeb?this.uqa(!1):1>this.jeb&&this.hide())}show(){this.uqa(2<=this.jeb);this.visible=!0}hide(){this.visible=!1}NCm(Ha){return Ha?this.oAi(0,5):this.oAi(1,4)}Fdm(Ha){for(let eb=0;eb<this.jeb;eb++)if(this.xs[eb].clientId===Ha)return Ha=this.xs[eb],Array.removeAt(this.xs,eb),Ha;return null}uqa(Ha){this.k_e!==Ha&&(this._img&&this.element.removeChild(this._img),
this._img=this.NCm(Ha),this.element.appendChild(this._img),this.k_e=Ha);this._img.childNodes[0].style.backgroundColor=this.xs[this.xs.length-1].color}oAi(Ha,eb){const rc=this.ef.get(6,0),Uc=this.ef.get(14);return se.createClusteredImageFromClusterWithImageClass(rc,rc,this.ef.get(Ha),this.ef.get(eb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Uc?Uc.cloneNode(!0):null)}eU(Ha){3!==Ha.Og&&this.raiseEvent(Pc.sZ,new Pc(2,Ha));return!1}onClick(Ha){this.raiseEvent(Pc.sZ,new Pc(1,
Ha));return!0}RN(Ha){3!==Ha.Og&&this.raiseEvent(Pc.sZ,new Pc(3,Ha));return!1}nAp(){this.element&&(this.xbc.Gc($d.a.Lu,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),this.xbc.Gc($d.a.WN,this.element,Object(Xa.a)(this,this.eU,"onPointerOver")),this.xbc.Gc($d.a.kJ,this.element,Object(Xa.a)(this,this.RN,"onPointerOut")),this.Ws.Gc($d.a.dF,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),this.Ws.Gc($d.a.click,this.element,Object(Xa.a)(this,
this.onClick,"onClick")),this.dQ.Gc(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")))}R8m(){this.element&&(this.xbc.Cb($d.a.Lu,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),this.xbc.Cb($d.a.WN,this.element,Object(Xa.a)(this,this.eU,"onPointerOver")),this.xbc.Cb($d.a.kJ,this.element,Object(Xa.a)(this,this.RN,"onPointerOut")),this.Ws.Cb($d.a.dF,this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")),
this.Ws.Cb($d.a.click,this.element,Object(Xa.a)(this,this.onClick,"onClick")),this.dQ.Cb(this.element,Object(Xa.a)(this,this.Vpa,"stopPropagationAndPreventDefaultBehavior")))}}Object(f.a)($i,"PresenceTooltipGlyph",wc,[]);class wf extends wc{constructor(Ha,eb,rc){super(Ha);this.xs=[];this.GO=[];this.fUa=0;this.JSc=this.F9b=!1;this.zch=null;this.k0a=(Uc,bd)=>{var Hd=Object(z.a)($i,Uc);Hd=Hd?this.yti(Hd):-1;if(2===bd.type||1===bd.type&&-1!==Hd&&!this.eha[Hd].visible)this.due(Uc);else if(1===bd.type)this.Hbb(),
this.F9b=!1;else if(3===bd.type){if(this.DEf(bd.iq))return;this.F9b||this.Hbb()}this.raiseEvent(Pc.sZ,bd)};this.uGd={};this.ef=rc;this.zn=rc.get(8,!1);this.Lra=rc.get(11,!1);Ha=rc.get(12,0);this.IUb=rc.get(6,0);this.xnb=eb;this.element.id=wf.Hsb();this.element.className=wc.Jfi(this.zn);Ha&&(this.zIndex=Ha);this.rtl=this.zn;this.CCg(eb);this.tIa=this.createElement("div");this.tIa.className=this.Lra?"prContainerV":"prContainerHr";this.element.appendChild(this.tIa);this.Snh=Array(this.fUa);for(eb=0;eb<
this.fUa;eb++)this.eha[eb]=new Wf(this.createElement("div"),this.ef),this.eha[eb].QMb(this.k0a),this.element.appendChild(this.eha[eb].element)}get oue(){return Ye.a.clone(this.xs)}get eha(){return this.Snh}get ARh(){return this.zch}get WDe(){return this.IUb+2}get width(){return this.Lra?this.WDe:this.xnb}get height(){return this.Lra?this.xnb:this.WDe}QMb(Ha){this.addHandler(Pc.sZ,Ha)}P0b(Ha){this.removeHandler(Pc.sZ,Ha)}dispose(){if(this.eha)for(const Ha of this.eha)Ha.P0b(this.k0a),dd.a.BF(Ha);dd.a.Vzg(this.GO);
this.GO=this.Snh=null;super.dispose()}PAc(){this.Hbb();this.OGg();this.visible=!0;this.F9b=!1}Nsd(){!this.GO||1>this.GO.length||(this.Hbb(),this.visible=!0,this.OGg(),this.due(this.GO[this.GO.length-1]),this.F9b=!0)}BGg(){if(this.GO&&!(1>this.GO.length)){this.visible=!0;this.OGg();var Ha=0;for(const eb of this.GO)this.due(eb,Ha++);this.F9b=!1;this.JSc=!0}}hide(){this.visible=!1;this.Hbb();for(let Ha=0;Ha<this.GO.length;Ha++)this.GO[Ha].hide();this.F9b=!1}n6h(){if(!this.JSc)return!1;let Ha=0;for(const eb of this.eha)eb.visible&&
Ha++;return this.JSc=0<Ha&&(this.xs.length<=this.fUa?Ha===this.xs.length:Ha===this.fUa)}Tla(Ha){if(!(0>=this.fUa)){Ha.clientId||(Ha.clientId=(wf.$Lc++).toString());if(Ha.clientId in this.uGd){var eb=this.ARb(Ha.clientId);if(0<=eb){eb=this.xs[eb];if(eb.color===Ha.color&&eb.userName===Ha.userName)return;this.Cfb(Ha.clientId)}}eb=this.n6h();var rc=0;if(this.xs.length<this.fUa){var Uc=new $i(this.createElement("div"),this.ef,Ha);Uc.QMb(this.k0a);this.zn&&!this.Lra&&0<this.xs.length?this.tIa.insertBefore(Uc.element,
this.tIa.firstChild):(this.tIa.appendChild(Uc.element),rc=this.GO.length);Array.add(this.GO,Uc)}else this.zn&&!this.Lra?Uc=this.GO[0]:(rc=this.GO.length-1,Uc=this.GO[rc]),Uc.Tla(Ha);Uc.show();this.uGd[Ha.clientId]=Uc;Array.add(this.xs,Ha);this.Wbk(Uc,rc);eb&&this.BGg()}}Cfb(Ha){const eb=this.n6h();eb&&this.Hbb();this.hod(Ha);this.xs.length>=this.fUa&&this.GO.length<this.fUa&&this.Gwo();0>=this.xs.length?this.hide():eb&&this.BGg()}Okj(){}hod(Ha){var eb=this.ARb(Ha);0>eb||(Ha=this.xs[eb],Array.removeAt(this.xs,
eb),eb=this.uGd[Ha.clientId],delete this.uGd[Ha.clientId],eb.Cfb(Ha.clientId),this.Wbk(eb),0>=eb.jeb&&(this.tIa.removeChild(eb.element),Array.remove(this.GO,eb),eb.dispose()))}Gwo(){var Ha=this.ZJm();!Ha||1>=Ha.users.length||(Ha=Array.clone(this.xs),Ha.forEach(eb=>{this.hod(eb.clientId)}),Ha.forEach(eb=>{this.Tla(eb)}))}ARb(Ha){for(let eb=0;eb<this.xs.length;eb++)if(this.xs[eb].clientId===Ha)return eb;return-1}ZJm(){return this.zn&&!this.Lra?this.GO[0]:this.GO[this.GO.length-1]}position(Ha,eb){this.element.style.top=
eb+"px";this.element.style.left=Ha+"px"}OGg(){for(let Ha=0;Ha<this.GO.length;Ha++)this.GO[Ha].show()}Hbb(){for(let Ha=0;Ha<this.fUa;Ha++)this.eha[Ha].hide();this.JSc=!1}due(Ha,eb=0){if(Ha)if(this.zch=Ha,this.Lra){const rc=this.IUb;if(1<Ha.users.length)this.eha[eb].show(Ha.users,rc,this.height-this.IUb);else{const Uc=this.tIa.children.length;for(let bd=0;bd<this.tIa.children.length;bd++)Ha.element===this.tIa.children[bd]&&this.eha[eb].show(Ha.users,rc,this.height-(Uc-bd)*this.WDe+2)}}else this.eha[eb].show(Ha.users,
this.width,0)}DEf(Ha){Ha=wf.oQf(Ha);let eb=!1;for(const rc of this.eha)if(Vc.a.yZa(rc.element,Ha)){eb=!0;break}return this.tIa!==Ha&&Vc.a.yZa(this.tIa,Ha)||eb}Wbk(Ha,eb=0){const rc=this.dln(Ha);rc&&0>=Ha.jeb?this.eha[eb].hide():rc?this.due(Ha):this.eha[eb].hide()}yti(Ha){let eb=0;for(const rc of this.GO){if(Ha===rc)return eb;eb++}return-1}dln(Ha){const eb=this.yti(Ha);return!!this.ARh&&Ha===this.ARh&&-1!==eb&&this.eha[eb].visible}CCg(Ha){this.fUa=Ha===this.IUb?1:Math.floor(Ha/this.WDe);this.Lra?(this.element.style.height=
Ha+"px",this.element.style.width=this.IUb+"px"):(this.element.style.width=Ha+"px",this.element.style.height=this.IUb+"px")}static Hsb(){return String.format("{0}-{1}","presencetooltip",wf.$Lc++)}static oQf(Ha){Ha=Ha.Yb.rawEvent;return Ha.relatedTarget||Ha.toElement}}wf.$Lc=0;Object(f.a)(wf,"PresenceTooltipControl",wc,[1930,11]);class Hf{constructor(Ha){this.ef=Ha;this.ef.EVa(10,le.a.instance);this.ef.EVa(9,Vh.a.instance);this.ef.EVa(6,16);this.ef.EVa(13,Bh.a.instance)}Qvf(Ha){return new wf(Ha,16,
this.ef)}}Object(f.a)(Hf,"PresenceTooltipFactory",null,[1929]);var vf=e(269),Ui=e(135),rf=e(57),ug=e(5),Eg=e(120),th=e(6),ei=e(133),Yj=e(80),Zk=e(540),yg=e(315),Kk=e(257);class Jh extends Sys.EventArgs{constructor(Ha,eb){super();this.paragraphId=Ha;this.rGn=eb}}Object(f.a)(Jh,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class zf extends wc{constructor(Ha,eb,rc,Uc,bd,Hd=null,Pe=null){super(null);this.nGd=this.Vo=null;this.zed=!1;this.qya=0;this.sr=Ha;this.LTc=eb;this.hz=rc;this.wk=Uc;this.nSa=
bd;zf.OGb=0;this.NWh=new dc.a;this.BMj=new dc.a;this.u0=Hd;this.za=Pe;this.aCk=this.za.sc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.nXk=this.za.sc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Ijb=0}get Vdb(){return m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}E6k(Ha){this.addHandler("CR",Ha)}sJj(Ha){this.removeHandler("CR",Ha)}Ewe(){this.raiseEvent("CR",new Jh(this.sr.ip.paragraphId,this.zed))}Acg(){if(Object(Kk.a)(Re,this.Vo)){const Ha=Object(z.a)(Re,this.Vo);
zf.OGb=0<zf.OGb?zf.OGb+1:Ha.e$a+1;Ha.zIndex=zf.OGb;this.element.style.zIndex=String(zf.OGb)}}VNo(){if(Object(Kk.a)(Re,this.Vo)){const Ha=Object(z.a)(Re,this.Vo);zf.OGb=Ha.e$a;Ha.zIndex=Ha.e$a;this.element.style.zIndex=String(Ha.e$a)}}ufj(){this.u0&&!this.owp()&&this.u0.continueWith(()=>{this.u0.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.aCk)&&this.Ijb++})}owp(){return this.Ijb>=this.nXk}static Lej(){zf.Dnh||(zf.Dnh=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Hsb(Ha){return zf.k$m+
Ha.kEi()}}zf.EAj="data-presence-control";zf.awj="OverlayControlElementOwner";zf.k$m="ipId_";zf.FAj="WacPresence";zf.jeo="PresenceIpPaddingDiv";zf.Dnh=!1;zf.OGb=0;Object(f.a)(zf,"APresenceControl",wc,[1610,11]);class cg{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.Jgb=!1}}Object(f.a)(cg,"PresenceImageControlStyle",null,[1609]);var xe=e(161);class wi extends zf{constructor(Ha,eb,rc,Uc,bd,Hd=null,Pe=null){super(Ha,eb,rc,Uc,bd,Hd,Pe);this.RN=()=>{this.Sjj();return!1};this.Kre=
Le=>{this.Vo&&3===Le.Og&&(2!==this.qya?(this.Acg(),this.l3b()):this.Sjj());return!1}}Cfb(Ha){this.Vo&&this.Vo.Cfb(Ha)}mJe(){return this.Vo?this.Vo.oue.length:0}updatePosition(Ha){if(this.element&&this.element.parentNode){var eb=this.NEi(Ha);if(eb){var rc=Sys.UI.DomElement.getBounds(this.element.parentNode),Uc,bd;({left:rc,top:Uc,height:bd,width:eb}=this.JMm(eb,rc,this.element.parentNode,this.wk.instance));this.element.style.top=Uc+"px";this.element.style.left=rc+"px";this.element.style.height=bd+
"px";this.element.style.width=eb+"px";rc=this.UEi(Ha);Ub.a.y$(this.element,rc);Ha=this.KNf(Ha,this.sr.ip.shapeId);this.bWj(rc,eb,this.isSelected(Ha),m.AFrameworkApplication.isRtl);this.l3b()}}}I2(){this.element&&(Vc.a.yF(this.element),this.Vo.Cfb(this.sr.user.clientId),this.Ewe())}S$h(Ha,eb,rc,Uc){eb=new cg;if(!Uc||!rc)return eb;rc=this.NEi(Ha);if(!rc)return eb;eb.top=rc.y;eb.left=rc.x;eb.height=rc.height;eb.width=rc.width;eb.rotation=this.tPm(Ha);eb.Jgb=!0;return eb}nKj(Ha,eb,rc,Uc){zf.Lej();this.nGd=
Ha;if(Uc){const bd=this.KNf(Ha,this.sr.ip.shapeId);if(!bd)return;const Hd=!this.element;Hd&&this.Vvf(eb.ownerDocument,Ha);Hd||!this.element.parentNode?bd.appendChild(this.element):this.element.parentNode!==bd&&(this.element.parentNode.removeChild(this.element),bd.appendChild(this.element));this.Vo.Tla(this.sr.user);this.element.style.borderColor=this.sr.user.color;this.element.id=zf.Hsb(this.sr);rc.Jgb&&(this.element.style.height=rc.height+"px",this.element.style.top=rc.top+"px",this.element.style.left=
rc.left+"px",this.element.style.width=rc.width+"px",Ub.a.y$(this.element,rc.rotation),Ub.a.y$(this.Vo.element,-1*rc.rotation),this.bWj(rc.rotation,rc.width,this.isSelected(bd),m.AFrameworkApplication.isRtl),this.l3b())}this.zed=!Uc;this.Ewe()}tPm(Ha){return this.element&&this.element.parentNode&&this.gLi(Ub.a.getTransform(this.element.parentNode))?this.gLi(Ub.a.getTransform(this.element)):this.UEi(Ha)}gLi(Ha){return Ha&&-1<Ha.indexOf("deg")&&(Ha=parseInt(Ha.substring(Ha.indexOf("(")+1,Ha.indexOf("deg"))),
!isNaN(Ha))?Ha:0}xbk(Ha){this.element.style.borderColor=this.sr.user.color;this.element.id=zf.Hsb(this.sr);this.updatePosition(Ha)}Vvf(Ha,eb){this.element=Ha.createElement("div");this.element.setAttribute(zf.EAj,!0);Ui.a.un(this.element,zf.awj,this);this.element.className=wi.eno;(Ha=eb.Jb)&&Ha.LV&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Vo=this.LTc.Qvf(this.createElement("div"),!0);this.Vo.Tla(this.sr.user);this.Vo.hide();this.hz.Cb($d.a.kJ,
this.Vo.element,this.RN);this.hz.Cb($d.a.Lu,this.Vo.element,this.Kre);this.Vo.element.classList.add(zf.FAj);this.element.appendChild(this.Vo.element)}JMm(Ha,eb,rc,Uc){let bd=Ha.y,Hd=Ha.x,Pe=Ha.height;Ha=Ha.width;(1<Math.abs(eb.width-rc.offsetWidth)||1<Math.abs(eb.height-rc.offsetHeight))&&Uc&&(bd=Math.round(bd/Uc.Ql),Hd=Math.round(Hd/Uc.Ql),Pe=Math.round(Pe/Uc.Ql),Ha=Math.round(Ha/Uc.Ql));return{left:Hd,top:bd,height:Pe,width:Ha}}isSelected(Ha){return Ha.classList.contains(yg.a.Uic)}bWj(Ha,eb,rc,
Uc){this.Vo.element.style.left="auto";this.Vo.element.style.top="auto";this.Vo.element.style.right="auto";this.Vo.element.style.bottom="auto";rc=rc?Math.round(.5*wi.pya)+wi.bup:0;0<=Ha&&90>Ha||360===Ha?(this.Vo.element.style.top=-.5*wi.pya-rc+"px",Uc?this.Vo.element.style.right=eb-.5*wi.pya+"px":this.Vo.element.style.left=eb-.5*wi.pya+"px"):90<=Ha&&180>Ha?(this.Vo.element.style.left=-.5*wi.pya-rc+"px",Uc?this.Vo.element.style.bottom=-.5*wi.pya+"px":this.Vo.element.style.top=-.5*wi.pya+"px"):180<=
Ha&&270>Ha?(this.Vo.element.style.bottom=-.5*wi.pya-rc+"px",Uc?this.Vo.element.style.left=eb-.5*wi.pya+"px":this.Vo.element.style.right=eb-.5*wi.pya+"px"):(this.Vo.element.style.right=-.5*wi.pya-rc+"px",Uc?this.Vo.element.style.top=-.5*wi.pya+"px":this.Vo.element.style.bottom=-.5*wi.pya+"px")}rj(Ha,eb){const rc=this.e$d(Ha,eb);return rc?rc.properties:(Ha=this.TEi(Ha,eb))?Ha.properties:null}KNf(Ha,eb){var rc=this.e$d(Ha,eb);return rc&&(rc=rc.jDa(Ha.Gh,Ha))?rc.element:(eb=this.TEi(Ha,eb))?Object(z.a)(Zk.a,
eb).ug(Ha.Lc).htmlElement:null}e$d(Ha,eb){Ha=Yj.i(Ha.Jb,5);for(const rc of Ha)if(rc.properties.getValue(ug.a.w$a)===eb)return rc;return null}TEi(Ha,eb){Ha=th.a.kb(Ha.Jb);let rc=Ha.ic(6);for(;rc;){const Uc=rc.properties.getValue(ug.a.w$a);if(ei.a.nr(rc)&&Uc===eb)return rc;rc=Ha.gg(6)}return null}DCm(Ha){const eb=rf.a.Rf(ei.a.XD(Ha),0);Ha=rf.a.Rf(ei.a.iF(Ha),1);return{Eqa:eb,y6m:Ha}}UEi(Ha){Ha=this.rj(Ha,this.sr.ip.shapeId);return ei.a.N4(Ha)}NEi(Ha){var eb=this.sr.ip;if(!eb||!eb.shapeId)return null;
var rc=this.rj(Ha,eb.shapeId);const Uc=this.KNf(Ha,eb.shapeId);if(!rc||!Uc)return null;let bd=Ha=1,Hd;({Eqa:eb,y6m:Hd}=this.DCm(rc));Object(xe.d)(rc)?(rc=ei.a.Dua(rc),Ha=rf.a.Rf(rc[Eg.a.left],0),bd=rf.a.Rf(rc[Eg.a.top],1)):rc.hasProperty(ug.a.Nia)?(rc=rc.getValue(ug.a.Nia),Ha+=rf.a.Rf(rc[Eg.a.left],0),bd+=rf.a.Rf(rc[Eg.a.top],1)):(Ha+=0<Uc.offsetWidth?(Uc.offsetWidth-eb)/2:2,bd+=0<Uc.offsetHeight?(Uc.offsetHeight-Hd)/2:2);return new Sys.UI.Bounds(Math.round(Ha),Math.round(bd),Math.round(eb),Math.round(Hd))}Sjj(){this.Vo&&
(this.Vo.PAc(),this.qya=1)}l3b(){for(const Ha of this.Vo.oue)if(Ha.clientId===this.sr.user.clientId&&!Ha.equals(this.sr.user)){this.Vo.Tla(this.sr.user);break}if(this.sr.x2a||2===this.qya)this.Vo.Nsd(),this.sr.x2a=!1,this.sr.eia=!0,this.qya=2;this.sr.eia&&1!==this.qya||(this.Vo.PAc(),this.sr.eia=!0,this.qya=1)}}wi.eno="WACImgPresenceHighlight";wi.pya=20;wi.bup=6;Object(f.a)(wi,"PresenceImageControl",zf,[]);var ig=e(284);class Qi{constructor(){this.height=this.top=this.left=this.VZi=0;this.Jgb=!1;
this.Zx=this.Yh=null}}Object(f.a)(Qi,"PresenceIpControlStyle",null,[1609]);var el=e(63);class mj extends zf{constructor(Ha,eb,rc,Uc,bd,Hd=null,Pe=null,Le=null){super(Ha,eb,rc,Uc,bd,Hd,Pe);this.SSc=this.G5a=this.Vcc=null;this.eU=De=>{!this.Vo||this.Vdb&&!this.Vo.DEf(De)||(this.Acg(),this.Cze(De));this.xbk(this.nGd);return!1};this.RN=()=>{this.Vo&&this.iW();return!1};this.Kre=De=>{this.Vo&&3===De.Og&&(2!==this.qya?(this.Acg(),this.Cze(De)):this.iW());return!1};this.XG=Le}Vvf(Ha){this.element=Ha.createElement("div");
this.element.setAttribute(zf.EAj,!0);Ui.a.un(this.element,zf.awj,this);this.element.className=zf.jeo;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.hz.Cb($d.a.WN,this.element,this.eU);this.Vdb&&(this.hz.Cb($d.a.kJ,this.element,this.RN),this.hz.Cb($d.a.Lu,this.element,this.Kre));this.G5a=this.createElement("div");this.G5a.className=mj.fno;this.Vdb||(this.SSc=this.createElement("div"),this.SSc.className=mj.ino,this.G5a.appendChild(this.SSc));this.Vo=this.LTc.Qvf(this.createElement("div"),
this.Vdb);Ha=this.za.$("NoPresenceUserLookUpBeforeRender");this.XG&&!Ha&&(this.sr.user=this.XG.F$f(this.sr.user.clientId)||this.sr.user);this.Vo.Tla(this.sr.user);this.Vo.hide();this.Vo.element.classList.add(this.Vdb?zf.FAj:mj.Sho);this.G5a.appendChild(this.Vo.element);this.element.appendChild(this.G5a)}LWl(){this.Vcc&&(Cb.TaskManager.instance.Kf(this.Vcc),this.Vcc=null)}l3b(Ha){for(var eb of this.Vo.oue)if(eb.clientId===this.sr.user.clientId&&!eb.equals(this.sr.user)){this.Vo.Tla(this.sr.user);break}eb=
!1;mj.rUl===this.sr.user.color?({value:eb}=this.NWh.Nc(this.sr.user.clientId,!1),eb||(this.NWh.W(this.sr.user.clientId,!0),l.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.sr.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:eb}=this.BMj.Nc(this.sr.user.clientId,!1),eb||(this.BMj.W(this.sr.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.sr.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ha||this.sr.x2a||2===this.qya?(this.ufj(),this.Vo.Nsd(),
this.sr.x2a=!1,this.sr.eia=!0,this.qya=2,mj.Gsp):this.sr.eia&&1!==this.qya?0:(this.ufj(),this.Vo.PAc(),this.sr.eia=!0,this.qya=1,mj.Fsp)}Cze(Ha=null){this.LWl();const eb=this.l3b(!!Ha);this.Vdb&&Ha&&Ha.eventName===$d.a.WN||this.GTo(eb)}iW(){this.Vo&&this.qya&&(this.VNo(),this.Vo.hide(),this.qya=0)}GTo(Ha){this.Vcc=new Ca.a(2,1,Ha,()=>{this.Vcc=null;this.iW()},56);Cb.TaskManager.instance.pc(this.Vcc)}updatePosition(Ha){if(this.element&&this.element.parentNode){var eb=this.FFi(Ha);if(eb){Ha=Sys.UI.DomElement.getBounds(this.element.parentNode);
eb=new Sys.UI.Bounds(eb.x-Ha.x,eb.y-Ha.y,mj.ZZi,eb.height);var rc;({left:Ha,top:eb,height:rc}=this.MMm(eb,Ha,this.element.parentNode,this.wk.instance));this.element.style.height=2*mj.$vc+rc+"px";this.element.style.top=eb-mj.$vc+"px";this.element.style.left=Ha-mj.$vc+"px";this.G5a.style.height=Math.max(mj.Hjj,rc)+"px";this.Cze()}}}I2(){this.element&&(Vc.a.yF(this.element),this.Ewe())}S$h(Ha,eb,rc,Uc,bd){const Hd=new Qi;if(!Uc||!rc)return Hd;Uc=this.FFi(Ha);if(!Uc)return Hd;var Pe=rc;rc=Ha;if(Ha.ik){var Le=
Ha.rc;Pe=Ha.lg.snc(this.sr.ip.Uda.cp);0>Pe&&0==Pe;Ha.rc.doa?Vc.a.yZa(Le.editingElement,Ha.lg.Rj.K(Pe))||(rc=Object(el.a)().Pd.Dm(Ha.source),eb=rc.lg.Rj.K(Pe)):eb=rc.lg.Rj.K(Pe);Pe=eb.getBoundingClientRect()}Pe=new Sys.UI.Bounds(Uc.x-Pe.x,Uc.y-Pe.y,mj.ZZi,Uc.height);Ha=Pe.y;Uc=Pe.x;Pe=Pe.height;Le=this.wk.instance;bd&&Le&&(bd=Le.Ql,Ha=Math.round(Ha/bd),Uc=Math.round(Uc/bd),Pe=Math.round(Pe/bd));Hd.top=Ha-mj.$vc;Hd.left=Uc-mj.$vc;Hd.height=2*mj.$vc+Pe;Hd.VZi=Math.max(mj.Hjj,Pe);Hd.Jgb=!0;Hd.Yh=eb;Hd.Zx=
rc;return Hd}nKj(Ha,eb,rc,Uc){zf.Lej();this.nGd=Ha;Ha=rc.Yh;eb=rc.Zx;if(Ha&&eb){if(Uc){const bd=!this.element;bd&&this.Vvf(Ha.ownerDocument);bd||!this.element.parentNode?Ha.appendChild(this.element):this.element.parentNode!==Ha&&(this.element.parentNode.removeChild(this.element),Ha.appendChild(this.element));this.nGd=eb;Ha=this.sr.user.color;this.G5a.style.borderColor=Ha;this.Vdb||(this.SSc.style.borderColor=Ha);this.element.id=zf.Hsb(this.sr);rc.Jgb&&(this.element.style.height=rc.height+"px",this.element.style.top=
rc.top+"px",this.element.style.left=rc.left+"px",this.G5a.style.height=rc.VZi+"px",this.Cze())}this.zed=!Uc;this.Ewe()}else l.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Ha} or paragraphViewElement is null:${!eb}`)}dispose(){this.element&&(this.I2(),this.hz.Gc($d.a.WN,this.element,this.eU),this.Vdb&&(this.hz.Gc($d.a.kJ,this.element,this.RN),this.hz.Gc($d.a.Lu,this.element,this.Kre)),dd.a.BF(this.Vo),this.element=this.Vo=null);super.dispose()}xbk(Ha){const eb=
this.sr.user.color;this.G5a.style.borderColor=eb;this.Vdb||(this.SSc.style.borderColor=eb);this.element.id=zf.Hsb(this.sr);this.updatePosition(Ha)}MMm(Ha,eb,rc,Uc){let bd=Ha.y,Hd=Ha.x;Ha=Ha.height;(1<Math.abs(eb.width-rc.offsetWidth)||1<Math.abs(eb.height-rc.offsetHeight))&&Uc&&(bd=Math.round(bd/Uc.Ql),Hd=Math.round(Hd/Uc.Ql),Ha=Math.round(Ha/Uc.Ql));return{left:Hd,top:bd,height:Ha}}FFi(Ha){const eb=this.sr.ip;if(!eb)return null;let rc;try{const Uc=eb.Uda.cp;rc=ig.a.m4(Uc,Ha,0<Uc,!1,!1,!1)}catch(Uc){l.ULS.sendTraceTag(4301318,
302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",Cb.TaskManager.instance.UB,Uc.message,Uc.stack),rc=null}return rc}}mj.Sho="WacPawn";mj.ZZi=2;mj.Fsp=7E3;mj.Gsp=2E3;mj.$vc=5;mj.fno="presenceIp";mj.ino="PresenceSmallBox";mj.Hjj=10;mj.rUl="0xcccccc";Object(f.a)(mj,"PresenceIpControl",zf,[]);class Uf{constructor(Ha,eb,rc,Uc,bd=null,Hd=null,Pe=null){this.qIc={};this.oIc={};this.Dgh={};this.LTc=Ha;this.hz=eb;this.vv=rc;this.nSa=Uc;this.u0=bd;this.za=Hd;this.XG=Pe}get NSl(){return this.qIc}get Zgi(){return this.oIc}IMm(Ha){const eb=
!!this.za&&this.za.$("PeoplesWellExtraButtonInfoIsEnabled");return Ha.ip.shapeId&&eb?this.NMm(Ha):this.OMm(Ha)}NMm(Ha){const eb=Ha.ip.shapeId.toString();this.Dgh[Ha.user.clientId]=eb;const rc=this.oIc[eb];return rc?(rc.sr=Ha,{returnValue:rc,jJe:!0}):{returnValue:this.oIc[eb]=new wi(Ha,this.LTc,this.hz,this.vv,this.nSa,this.u0,this.za),jJe:!1}}OMm(Ha){const eb=Ha.user.clientId,rc=this.qIc[eb];return rc&&rc.sr.user.equals(Ha.user)?(rc.sr=Ha,{returnValue:rc,jJe:!0}):{returnValue:this.qIc[eb]=new mj(Ha,
this.LTc,this.hz,this.vv,this.nSa,this.u0,this.za,this.XG),jJe:!1}}GFi(Ha){return this.qIc[Ha]}zCm(Ha){return(Ha=this.oIc[this.Dgh[Ha]])&&!Ha.mJe()?Ha:null}d1l(){var Ha=this.qIc;for(const eb in Ha)Ha[eb].dispose();Ha=this.oIc;for(const eb in Ha)Ha[eb].dispose()}}Object(f.a)(Uf,"PresenceControlProvider",null,[]);var hh=e(610);class Jj{constructor(){this.mmb=0}JHi(){this.mmb++;this.mmb===Number.MAX_VALUE&&(this.mmb=1);return this.mmb}static get instance(){return Jj.SPc}}Jj.SPc=new Jj;Object(f.a)(Jj,
"PacketIdGenerator",null,[779]);class $h{constructor(Ha,eb,rc){this.UTo=Ha;this.Tan=eb;this.V$i=rc}}Object(f.a)($h,"SuccessfulInboundReplicationCallbackData",null,[]);class pi{constructor(Ha,eb,rc,Uc,bd,Hd,Pe){this.qRo=(Le,De)=>{De.type||(Le=this.Rk.Sni>=this.jAk,this.EWk&&Le?(Le=this.IWe())?Le.WDf():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.DC())};this.Z$n=Le=>{if(Le=Object(z.a)($h,Le)){var De=Le.Tan.qj.toString(),lf=
this.IWe(),Af=lf.Au,mg="";Af!==Le.V$i&&(l.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",Le.UTo.toString()),mg=this.RHm(lf,Af,Le.V$i));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",mg,De)}else l.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.oRo=Ha;this.IWe=eb;this.Rk=rc;this.EWk=bd;this.jAk=Hd;this.S$b=Uc;this.Eq=Pe;this.oRo.CQ(this.qRo)}DC(){const Ha=this.IWe();if(!Ha)l.ULS.sendTraceTag(19682514,
500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.S$b()&&Ha.Lsc){let eb=-1;null!=Ha&&(eb=Ha.mxa());const rc=this.Eq.rg("Task","ShoulderTapInboundReplicationTimer");Ha.DC(this.Z$n,null,new $h(eb,rc,Ha.Au))}}RHm(Ha,eb,rc){const Uc=new Sys.StringBuilder;Ha=Ha.node.Hd.UFa.NTb(eb);if(!Ha)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:eb}),"";for(Uc.append(Ha.id.gv);eb!==
rc;){Uc.append(", ");Uc.append(eb.gv);Ha=Ha.dH;if(!Ha)break;eb=Ha.id}return Uc.toString()}}Object(f.a)(pi,"ContentNotificationManager",null,[]);class vh extends pi{constructor(Ha,eb,rc,Uc,bd,Hd,Pe){super(Ha,eb,rc,Uc,bd,Hd,Pe)}static get wxa(){return null!=vh.r8g?vh.r8g:vh.r8g=Ma.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Ua.StaticActiveAppFrame.Aa()){var Ha=Ua.StaticActiveAppFrame.Aa().tb;Ha&&(Ha.gga(vh.Phd),Ha=Ha.rd)&&(vh.kV=Ha.Jg,vh.kV&&sb.a.uDa().continueWith(vh.Yhg))}}static Yhg(){vh.pBd=
sb.a.uDa().result;vh.pBd&&vh.pBd.pn&&vh.wxa.jF().continueWith(vh.$id)}static $id(){vh.wi=vh.wxa.jF().result;if(vh.wi){var Ha=m.AFrameworkApplication.J,eb=Ha.$("Box4ThrottleInboundRequests");Ha=Ha.sc("Box4ThrottleInboundsAtUserCount",20);vh.kV.lnc=()=>vh.wi.xda;vh.mBd=vh.mBd||new vh(vh.wi,()=>vh.kV,vh.pBd,()=>m.AFrameworkApplication.isShuttingDown,eb,Ha,Ua.StaticActiveAppFrame.Aa().Kt);vh.mBd.DC()}}static Phd(Ha){vh.mBd||(Ha.z1a(vh.Phd),vh.init())}}vh.mBd=null;vh.wi=null;vh.kV=null;vh.pBd=null;Object(f.a)(vh,
"WordContentNotificationManager",pi,[]);class Bl{constructor(Ha,eb,rc,Uc,bd,Hd){this.iCd=null;this.qFh=Ha;this.Ld=rc;this.jUa=Uc;this.$H=bd;this.Ii=Hd;this.M5b=eb}clone(){return new Bl(this.qFh,this.M5b.clone(),this.Ld,this.jUa,this.$H,this.Ii)}get cp(){if(null!=this.iCd)return this.iCd;var Ha=this.qFh.paragraphId;if(Ha.equals(Mf.a.nil))return 0;var eb=this.jUa();if(!eb)return 0;Ha=eb.Mb(Ha);if(!Ha)return l.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;
eb=this.Ld.bPb(this.Ld.J0a(Ha.characterData,Ha.ra),this.M5b);if(this.$H){const rc=Ob.a.jd(Ha,eb);this.Ii&&Ha.Iy&&(rc.Ob=this.Ii.XOf(Ha,eb,this.M5b.VKa));eb=this.$H.cLa(rc,!0)}return eb}kkg(){null==this.iCd&&(this.iCd=this.cp)}equals(Ha){return Ha?this.M5b.isEqual(Ha.M5b,!1):!1}}Object(f.a)(Bl,"WordPresenceCp",null,[796,45,797]);class Bj{constructor(Ha,eb){this.$H=Ha;this.Ii=eb}create(Ha,eb,rc,Uc){return new Bl(Ha,eb,rc,Uc,this.$H,this.Ii)}}Object(f.a)(Bj,"Factory",null,[769]);class Vj extends Sys.EventArgs{constructor(Ha,
eb,rc){super();this.paragraphId=Ha;this.tK=eb;this.y_f=rc}}Object(f.a)(Vj,"ParagraphChangedEventArg",Sys.EventArgs,[]);class mh{constructor(Ha){this.cp=Ha}equals(Ha){return Ha?this.cp===Ha.cp:!1}clone(){return new mh(this.cp)}}Object(f.a)(mh,"PresenceCp",null,[796,45]);class xf{constructor(Ha,eb,rc,Uc,bd){this.paragraphId=Ha;this.cp=eb;this.length=rc;this.shapeId=Uc;this.dryDeletion=bd}}Object(f.a)(xf,"SerializablePresenceIpData",null,[]);class Wg{constructor(Ha,eb,rc,Uc=0,bd=0){this.gAa=null;Ha&&
(this.gAa=Mf.a.Of(Ha));this.pFh=new mh(eb);this.oPa=rc;this.RJh=Uc;this.nlh=bd}get paragraphId(){return this.gAa}get Uda(){return this.pFh}get shapeId(){return this.RJh}get dryDeletion(){return this.nlh}isValid(){return 0<=this.Uda.cp&&!!this.paragraphId&&!this.paragraphId.equals(Mf.a.nil)}getData(){return new xf(this.paragraphId.toString(),this.Uda.cp,this.oPa,this.shapeId,this.dryDeletion)}clone(){const Ha=new Wg;Ha.gAa=this.paragraphId;Ha.pFh=this.Uda?this.Uda.clone():null;Ha.oPa=this.oPa;Ha.RJh=
this.shapeId;Ha.nlh=this.dryDeletion;return Ha}static hPb(Ha){return Ha.paragraphId&&void 0!==Ha.cp&&null!==Ha.cp&&void 0!==Ha.length&&null!==Ha.length?new Wg(Ha.paragraphId,Ha.cp,Ha.length,void 0,Ha.dryDeletion):null}}Object(f.a)(Wg,"PresenceIp",null,[771,45]);class Oj{constructor(Ha,eb){this.ip=Ha;this.user=eb}}Object(f.a)(Oj,"SerializablePresenceData",null,[]);class Bg{constructor(Ha,eb){this.x2a=this.eia=this.$tc=!1;this.F5a=eb;this.user=Ha}get ip(){return this.F5a}ZQf(){return new Oj(this.ip?
this.ip.getData():null,this.user.getData())}kEi(){return this.user.clientId+(this.F5a?this.F5a.paragraphId.toString():Mf.a.nil.toString())}isValid(){const Ha=!!this.user&&this.user.isValid(),eb=!this.ip||this.ip.isValid();return Ha&&eb}clone(){const Ha=new Bg;Ha.user=this.user?this.user.clone():null;Ha.F5a=this.F5a?this.F5a.clone():null;Ha.eia=this.eia;Ha.$tc=this.$tc;Ha.x2a=this.x2a;return Ha}static hPb(Ha){return Ha?new Bg(Na.hPb(Ha.user),Ha.ip?Wg.hPb(Ha.ip):null):null}}Object(f.a)(Bg,"PresenceInfo",
null,[778,45]);class Xg extends pa.a{constructor(){super();this.bQc={};this.l4a={};this.ynh=!1}get ufo(){return this.bQc}get f5i(){return!!m.AFrameworkApplication.J&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}mVh(Ha){this.addHandler("PPC",Ha)}XJj(Ha){this.removeHandler("PPC",Ha)}Z6c(Ha){return Ha.ip.paragraphId.toString()}rif(Ha,eb=!1){this.ynh||(this.ynh=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var rc=({gno:Uc}=this.sBn(Ha)).returnValue;
if(Uc&&!eb)(rc=this.l4a[Ha.user.clientId])&&0<=rc.length&&(rc[rc.length-1].ip.oPa=Ha.ip.oPa);else{rc||this.OIj(Ha.user.clientId);this.f5i&&rc&&this.oFp(Ha);eb=this.Z6c(Ha);var Uc=Ha.user.clientId;var bd=this.bQc[eb]||[],Hd=this.l4a[Uc]||[];Hd.length>=Xg.tij&&(Hd=Hd.splice(-Xg.L_n,Xg.tij));rc||bd.push(Uc);Hd.push(Ha);this.bQc[eb]=bd;this.l4a[Uc]=Hd;Ha.ip.paragraphId.equals(Mf.a.nil)||this.gtg(Ha.ip.paragraphId,Ha,!0)}}sBn(Ha){var eb=this.l4a[Ha.user.clientId];const rc=!eb||0>=eb.length?null:eb[eb.length-
1],Uc=!!rc&&this.Z6c(rc)===this.Z6c(Ha);eb=Uc&&rc.ip.Uda.equals(Ha.ip.Uda)&&rc.user.equals(Ha.user);this.f5i&&eb&&rc.ip.shapeId&&Ha.ip.shapeId&&rc.ip.shapeId!==Ha.ip.shapeId&&(eb=!1);return{returnValue:Uc,gno:eb}}oFp(Ha){const eb=this.aTl(Ha);eb&&eb.ip.shapeId&&(Ha.ip.shapeId&&Ha.ip.shapeId===eb.ip.shapeId||this.gtg(eb.ip.paragraphId,eb,!1))}aTl(Ha){Ha=this.l4a[Ha.user.clientId];return!Ha||0>=Ha.length?null:Ha[Ha.length-1]}OIj(Ha){const eb=this.l4a[Ha];if(eb&&0<eb.length){const rc=eb[0].ip.paragraphId,
Uc=this.Z6c(eb[0]);delete this.l4a[Ha];this.aHo(Uc,Ha);rc.equals(Mf.a.nil)||this.gtg(rc,eb[0],!1)}}hAi(Ha){return this.bQc[Ha]}N4c(Ha,eb,rc,Uc=!1){const bd=[],Hd=this.hAi(Ha);if(!Hd)return bd;for(let Pe=0;Pe<Hd.length;Pe++){const Le=Hd[Pe],De=this.l4a[Le];let lf=!1;for(let Af=De.length-1;0<=Af;Af--){const mg=De[Af];if(Uc){if(mg.eia&&mg.ip.paragraphId.equals(Mf.a.Of(Ha))){lf=!0;bd.push(mg);break}}else if(Object(Kk.a)(Bg,mg)?mg.ip.oPa===eb:mg.ip.oPa===rc){lf=!0;mg.$tc=!0;bd.push(mg);this.l4a[Le]=De.splice(Af,
De.length);break}}!lf&&0<De.length&&De[0].$tc&&De[0].ip.paragraphId.equals(Mf.a.Of(Ha))&&bd.push(De[0])}return bd}Fnm(Ha){if(!Ha||!Ha.Ya||!Ha.Ya.node)return null;Ha=this.N4c(Ha.Ya.node.id.toString(),0,0,!0);Ha=this.cXm(Ha);Ha.sort((eb,rc)=>{if(!(eb&&eb.userName&&rc&&rc.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Ha}cXm(Ha){if(!Ha||!Ha.length)return[];const eb=[],rc=new D.a(G.a.Oh());for(let Uc=0;Uc<Ha.length;Uc++){const bd=
Ha[Uc].user;bd.isAnonymous&&rc.contains(bd.clientId)||!bd.isAnonymous&&bd.email&&rc.contains(bd.email)||(eb.push(bd),rc.add(bd.isAnonymous?bd.clientId:bd.email))}return eb}gtg(Ha,eb,rc){this.raiseEvent("PPC",new Vj(Ha,eb,rc))}aHo(Ha,eb){Array.remove(this.bQc[Ha],eb)}}Xg.tij=10;Xg.L_n=2;Object(f.a)(Xg,"PresenceDataManager",pa.a,[1582]);class kl extends Xg{constructor(Ha){super();this.AJ=Ha}rif(Ha,eb=!1){super.rif(Ha,eb)}Z6c(Ha){return Ha.ip.qd.toString()}hAi(Ha){Ha=this.AJ.Mb(Mf.a.Of(Ha));if(!Ha)return null;
Ha=Ha.ka(ug.a.qd,0);return this.ufo[Ha.toString()]}}Object(f.a)(kl,"WordPresenceDataManager",Xg,[]);var ff=e(1371),gj=e(1264),ej=e(1906),zi=e(39),Lk=e(1276);class Gh{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi,Uh,nk,fi,kc,Ze,Fg,ii,te,pe,Ee,rd){this.oVa=Array(5);this.cff=this._started=this.gaf=!1;this.E7e=null;this.QFh=new D.a(G.a.Oh());this.uMd={};this.n0e=!1;this.afo=()=>{if(!this.cff&&!this.ym.ay){var wj=new Ca.a(0,1,20,()=>{const ui=new U.a;var Ch=this.ymb.NSl;for(var $g in Ch){const fa=
Ch[$g];fa.zed&&ui.add(fa.sr.ip.paragraphId)}if(this.ape){Ch=this.ymb.Zgi;for(const fa in Ch)$g=Ch[fa],$g.zed&&!ui.contains($g.sr.ip.paragraphId)&&ui.add($g.sr.ip.paragraphId)}this.pyi(ui);this.cff=!1},72);this.Sb.pc(wj);this.cff=!0}};this.Gqj=()=>{this.gaf&&(this.kBg(),this.gaf=!1)};this.V9=(wj,ui)=>{this.GRj(ui.Pn.currentSelection)};this.GW=(wj,ui)=>{wj=ui.aka;for(var Ch in wj){const $g=wj[Ch];this.za.$("CashTelemetryIsEnabled")&&this.m2c($g,new Date,null);$g.ip?this.jif($g):this.iod($g.user.clientId)}ui=
ui.d1c;for(Ch=0;Ch<ui.length;++Ch)this.uXl(ui[Ch]);this.Wxe()};this.lkg=(wj,ui)=>{ui.paragraphId?this.kHp(ui.paragraphId.toString(),ui.rGn,this.uMd):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.GAj=(wj,ui)=>{ui.paragraphId&&(wj=this.rO.Mb(ui.paragraphId))&&((Object(Kk.a)(Bg,ui.tK)?this.yWe(wj):this.zWe(wj))===ui.tK.ip.oPa&&this.NTo(ui.paragraphId),this.ape&&this.hno(ui))};this.Wq=Ha;this.pb=Uc;this.XG=bd;this.MJb=Hd;this.ym=De;this.hAk=lf;this.ymb=Af;this.rO=rc;this.yWe=hi;this.zWe=Uh;
this.lsk=Pe;this.kAk=Le;this.dUa=nk;this.Rt=fi;this.Zc=kc;this.Sb=Ze;this.jNh=pe;this.zQk=rd;this.F7e=ii;this.za=te;this.YLd=eb;Gh.aNd=new dc.a;for(Ha=0;Ha<this.YLd.length;Ha++)this.YLd[Ha].oDo(this);this.MJb.mVh(this.GAj);this.Wq.jBa(this.GW);Ee&&this.ym.d8(this.afo);this.Wq.nxe(this)}get ape(){return!!this.za&&this.za.$("PeoplesWellExtraButtonInfoIsEnabled")}Wxe(Ha=!1){this.jNh&&!Ha||this.jKj()}jKj(){const Ha=new U.a,eb=this.uMd;for(const rc in eb)Ha.add(Mf.a.Of(rc));this.pyi(Ha);this.uMd={}}kBg(){this.pb.ob&&
this.GRj(this.pb.ob.currentSelection,!0)}GRj(Ha,eb=!1){this.zQk||(this.rO.Dn.Nva||eb?Ha?(eb=this.uPl(Ha))?this.Wq.xBg(eb):(this.Wq.xBg(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ha.Ya.contextId)):this.Wq.xBg(null):this.gaf=!0)}uPl(Ha){if(!this.ape||!Ha.Gwb)if(Ha=zi.a.Xk(Ha,!0,!1),!zi.a.qn(Ha))return null;return this.U1h(Ha)}U1h(Ha){const eb=Ha.Ya.cpBegin,rc=Ha.Ya.node.id;Ha=this.yWe(Ha.Ya.node);return new Wg(rc.toString(),eb,Ha)}m2c(Ha,eb,rc){if(this.F7e)if(Ha&&
Ha.user&&Ha.user.clientId){var Uc=Ha.user.clientId;this.QFh.contains(Uc)||(this.E7e?(this.E7e.m2c(Uc,eb,null,Gh.DPm(rc||Ha.user.client)),this.QFh.add(Uc)):this.F7e.continueWith(()=>{this.E7e=this.F7e.result;this.m2c(Ha,eb,rc)}))}else l.ULS.sendTraceTag(42262876,302,15,"invalid presence")}KMm(Ha){const eb=new U.a;for(let rc=0;rc<Ha.length;rc++)eb.add(this.UWm(Ha[rc]));return eb}jif(Ha){var eb=null;Ha&&Ha.user&&(eb=Ha.user.client);Ha=Ha.clone();Ha.user=this.XG.F$f(Ha.user.clientId)||Ha.user;this.za.$("CashTelemetryIsEnabled")&&
this.m2c(Ha,new Date,eb);Ha.isValid()&&!Ha.user.vZ()&&(eb=Ha.user.clientId,Gh.aNd.Bb(eb)||this.ZQi(eb),this.$Gp(eb),Ha.user.userName=CommonUIStrings.l_AnonymousUserName);this.MJb.rif(Ha,!1)}$Gp(Ha){const {value:eb}=Gh.aNd.Nc(Ha,!1);eb||(Gh.aNd.W(Ha,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ha+'" , "Event" : "CreateAnonymousGrayPawn"}'))}ZQi(){}iod(Ha){this.MJb.OIj(Ha)}uXl(Ha){this.iod(Ha);const eb=this.ymb.GFi(Ha);eb&&(eb.sJj(this.lkg),eb.dispose());this.ape&&(Ha=this.ymb.zCm(Ha))&&
(Ha.sJj(this.lkg),Ha.dispose())}Tmc(Ha){if(12!==Ha.type)return new U.a;Ha=this.MJb.N4c(Ha.id.toString(),this.yWe(Ha),this.zWe(Ha));return 0>=Ha.length?new U.a:this.KMm(Ha)}kHp(Ha,eb,rc){!eb&&Ha in rc&&delete rc[Ha]}dispose(){this.stop();this.MJb.XJj(this.GAj);this.Wq.A1a(this.GW);this.Wq.MOg(this);for(let Ha=0;Ha<this.YLd.length;Ha++)this.YLd[Ha].fBp(this);dd.a.Vzg([this.lsk,this.kAk,this.Wq]);this.ymb.d1l()}UWm(Ha){let eb=!1;Ha=({jJe:eb}=this.ymb.IMm(Ha)).returnValue;eb||Ha.E6k(this.lkg);return Ha}VOi(Ha){Ha=
this.rO.Mb(Ha);if(!Ha)return this.oVa[0]||(l.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.oVa[0]=!0),null;if(!kb.ParagraphReader.lc(Ha))return this.oVa[1]||(l.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.oVa[1]=!0),null;if(!Ha.ug(this.ym.Lc))return this.oVa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.oVa[2]=!0),null;if(!Ha.anchor)return this.oVa[3]||(l.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.oVa[3]=
!0),null;this.oVa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.oVa[4]=!0);return Ha}uIj(Ha){Ha=this.MJb.N4c(Ha.toString(),-1,-1,!0);if(!Ye.a.jg(Ha))for(const eb of Ha)(Ha=this.ymb.GFi(eb.user.clientId))&&Ha.element&&Ha.I2()}pyi(Ha){if(Ha.count){var eb=new U.a;for(var rc of Ha)(Ha=this.VOi(rc))?eb.add(Ha):this.uIj(rc);if(eb.count){rc=this.Zc.Vc(2);try{rc.set(this.Rt);for(const Uc of eb)this.emi(Uc)}finally{rc&&rc.dispose()}}}}emi(Ha){Ha.fK(this.ym.Lc,32,
!0);Ha.fK(this.hAk,32,!0)}NTo(Ha){this.uMd[Ha.toString()]=null;this.jNh&&!this.n0e&&(Ha=new Ca.a(0,1,200,()=>{this.n0e=!1;this.jKj()},70),this.Sb.pc(Ha),this.n0e=!0)}hno(Ha){if(Ha.tK.ip.shapeId&&!Ha.y_f){var eb=this.ymb.Zgi[Ha.tK.ip.shapeId.toString()];eb&&eb.Cfb(Ha.tK.user.clientId)}}stop(){this._started&&(this._started=!1,this.pb.vpa(this.V9),Lk.a.instance.SJj(this.Gqj))}start(){if(!this._started){this._started=!0;this.pb.BD(this.V9);Lk.a.instance.VUd(this.Gqj);var Ha=this.Wq.Ssb();delete Ha[this.dUa.clientId];
this.GW(null,new ej.a(Ha,[]));this.kBg()}}nDe(Ha){if(Ha&&Ha.isValid()&&Ha.ip){var eb=this.MJb.N4c(Ha.ip.paragraphId.toString(),-1,-1),rc=!1,Uc=null;for(let bd=0;bd<eb.length;bd++)if(Uc=eb[bd],Uc.user.clientId===Ha.user.clientId){rc=Uc.x2a=!0;break}if(rc)if(eb=Uc.ip.paragraphId,Ha=this.VOi(eb)){eb=this.Zc.Vc(2);try{eb.Eb(Ha),this.emi(Ha)}finally{eb&&eb.dispose()}}else this.uIj(eb)}}static DPm(Ha){return Ha?Ha?1===Ha?1:2===Ha?2:0:2:0}}Gh.aNd=null;Object(f.a)(Gh,"PresenceManager",null,[1574,11,743,1575,
1576,1577]);class aj{constructor(Ha,eb,rc,Uc){this.k8b=null;this._started=this.NZe=!1;this.ZLb=null;this.p0a=(bd,Hd)=>{if(!m.AFrameworkApplication.isShuttingDown&&(bd=this.Ack(Hd.Pn),this.k8b&&bd)){bd=this.tSe.N4c(this.k8b.toString(),-1,-1,!0);for(Hd=0;Hd<bd.length;Hd++)this.ZLb[bd[Hd].user.clientId]=bd[Hd];0>=bd.length||(bd=this.FLl(bd),this.Tq.sendNotification(bd,!0))}};this.zsj=(bd,Hd)=>{this.pb.ob&&!m.AFrameworkApplication.isShuttingDown&&this.NZe&&this.k8b&&this.k8b.equals(Hd.paragraphId)&&(bd=
null,!Hd.y_f||Hd.tK.user.clientId in this.ZLb?Hd.y_f||(bd=this.tfi(Hd.tK.user.userName,!1),delete this.ZLb[Hd.tK.user.clientId]):(bd=this.tfi(Hd.tK.user.userName,!0),this.ZLb[Hd.tK.user.clientId]=Hd.tK),bd&&this.Tq.sendNotification(bd,!0))};this.wi=Uc;this.pb=eb;this.tSe=Ha;this.Tq=rc;this.wi.nxe(this)}start(){this._started||(this._started=!0,this.ZLb={},this.tSe.mVh(this.zsj),this.pb.BD(this.p0a),this.Ack(this.pb.ob))}stop(){this._started&&(this._started=!1,this.ZLb=null,this.tSe.XJj(this.zsj),this.pb.vpa(this.p0a))}FLl(Ha){if(1===
Ha.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Ha[0].user.userName);const eb=[],rc=Ha.length;for(let Uc=0;Uc<rc;Uc++)eb.push(Ha[Uc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,eb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}tfi(Ha,eb){return String.format(eb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ha)}dispose(){this.wi.MOg(this);this.stop()}Ack(Ha){if(!Ha)return!1;
Ha=Ha.currentSelection;if(!Ha)return!1;Ha=Ha.Ya;if(!Ha)return!1;this.NZe=zi.a.Df(Ha);Ha=Ha.node.id;if(Ha.equals(this.k8b)||!this.NZe)return!1;this.k8b=Ha;this.ZLb={};return!0}}Object(f.a)(aj,"PresenceAccessibilityManager",null,[11,743]);class ck{constructor(Ha,eb){this._started=!1;this.dL=null;this.uHd=!1;this.jZb=()=>{this._started&&this.rRj()};this.wi=Ha;eb&&(this.dL=eb,this.dL.s8a(this.jZb));this.wi.nxe(this)}start(){this._started||(this._started=!0,this.dL?this.rRj():this.wi.sE(1,this.$di()))}rRj(){const Ha=
this.uHd;(this.uHd=!!this.dL.qA)&&!Ha&&this.wi.sE(1,this.$di())}$di(){const Ha={};Ha.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ha.HQ=!1;Ha.NT=1;Ha.WEB=!0;return Ha}stop(){this._started&&(this._started=this.uHd=!1)}dispose(){this.wi.MOg(this);this.dL&&this.dL.uJj(this.jZb)}}Object(f.a)(ck,"EditorsTableNotifier",null,[11,743]);var yk=e(350),eh=e(19);class vg extends Gh{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi,Uh,nk,fi,kc,Ze,Fg,ii,te,pe,Ee,rd,wj,ui,Ch,$g,fa,Ya,Hb){super(Ha,
eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,hi,Uh,nk,fi,Fg,ii,te,pe,Ee,rd,wj,ui,fa);this.Rk=null;this.i5l=Yb=>{const qa=!!this.Rk.Wy.Vlc(Yb);l.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Yb,qa)};this.h5l=(Yb,qa)=>{l.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",qa,Yb)};this.apa=()=>{if(2===vg.wi.connectionState&&!Ga.SessionStatusManager.instance.ada){const Yb={};Yb.qs=m.AFrameworkApplication.rootQuerySignature;vg.wi.T$(Yb)}};mg.nb(eh.a.rfp,
Vb.a.application,vg.a4k,64);mg.nb(eh.a.Qvg,Vb.a.application,vg.Qvg,64);mg.nb(eh.a.ysg,Vb.a.application,vg.ysg,96);mg.nb($b.a.nDe,Vb.a.application,vg.qfp,64);this.sQ=kc;this.Ld=Ze;this.qMb=Ch;this.dUa.Uwc=$g;this.dUa.Uwc.H8k(vg.Asj);Ya.continueWith(()=>{this.Rk=Ya.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.Q3=Hb)&&this.Q3.execute(Yb=>{Yb.HVa(this.apa)})}Ymc(Ha){if(!Ha||!Ha.anchor)return null;for(Ha=Ha.anchor.rt;Ha;Ha=Ha.fE)if(Ha.NNa)return Ha.Ku.node;return null}U1h(Ha){var eb=
null;eb=m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled");var rc=Ha.Ya.cpBegin,Uc=Ha.Ya.node;eb&&ei.a.nr(Uc)&&(Uc=this.Ymc(Uc));if(!Uc)return l.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Uc=this.zWe(Uc);const bd=Ha.Ya.node.ka(ug.a.qd,0);if(!this.sQ)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Hd=this.sQ.value.Itb(bd);const Pe=vg.AJ.Mb(Hd);if(!Pe)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Hd),null;rc=this.Ld.DEc(this.Ld.J0a(Pe.characterData,
Pe.ra),rc);rc.VKa=-1===Ha.Ya.Ob?0:Ha.Ya.Ob;Hd=0;eb&&Ha.Gwb&&(Hd=this.nRm(Ha));return eb=new Rf(this.sQ.value,bd,Uc,rc,this.Ld,()=>vg.AJ,this.qMb,Hd)}nRm(Ha){const eb=ei.a.HMa(Ha.Ya);return eb?eb.properties.ka(ug.a.w$a,0):Ha.Ya.node.properties.ka(ug.a.w$a,0)}ZQi(Ha){this.Rk&&this.Rk.aua&&this.Rk.aua.DC(this.i5l,this.h5l,Ha)}dispose(){this.Q3&&this.Q3.execute(Ha=>{Ha.S0b(this.apa)});super.dispose()}static get ry(){return Ma.a.instance.resolve("Common.Utils.IAriaNotifier")}static jF(){return vg.aMc.task}static get_instance(){return vg.$Md.task}static PMm(){return vg.rFh.task}static get wxa(){return null!=
vg.q8g?vg.q8g:vg.q8g=Ma.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){vg.$Md||(vg.$Md=new w.a);vg.Knh&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),vg.Knh=!1);if(Ua.StaticActiveAppFrame.Aa()){var Ha=Ua.StaticActiveAppFrame.Aa().tb;Ha?(Ha.gga(vg.Phd),vg.XPc=Ha.Xc,Ha.Fva()?(vg.mTa=Ha.rd.Jg,vg.mTa?(vg.AJ=Ha.rd.Hd,vg.AJ?vg.wxa.jF().continueWith(vg.V9n):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
l.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static V9n(){vg.wi=
vg.wxa.jF().result;if(vg.wi){var Ha=[vg.XPc.Djd,vg.XPc.Ve.Djd],eb=lb.a.instance,rc=Ma.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Uc=new aj(rc,eb,vg.ry,vg.wi),bd=m.AFrameworkApplication.J.$("DoNotAddToEditorsTableOnFrameIsEnabled")?sb.a.Gd().Wy:null;bd=new ck(vg.wi,bd);var Hd=Ma.a.instance.zf("WordEditor.IParagraphWordIdMapping"),Pe=Ma.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Le=Ma.a.instance.resolve("Common.IPeopleInfoProvider");vg._instance=
new vg(vg.wi,Ha,vg.AJ,eb,Le,rc,Uc,bd,vg.XPc,vg.XPc.Ve.Lc,Ma.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,vg.mTa,kb.ParagraphReader.textLength,kb.ParagraphReader.bua,Ma.a.instance.resolve("Box4.Presence.MyPresenceUser"),Hd,Pe,Fa.a.wf.Um,new yk.a,Cb.TaskManager.instance,ff.a.get_instance(),Ea.a.xr(Ma.a.instance.Za("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.J,m.AFrameworkApplication.J.$("Box4ThrottleAndBatchPresenceRendering"),
m.AFrameworkApplication.J.$("Box4DoNotRenderPresenceOutOfView"),Ma.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Ma.a.instance.resolve("Common.IPresenceStatusProvider"),!Fa.a.Wu&&!Fa.a.Yn,sb.a.uDa(),Ma.a.instance.Za("Common.ISessionExpirationManager"));l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");vg.$Md.setResult(vg._instance);vg.aMc.setResult(vg._instance);vg.rFh.setResult(vg._instance);Ha=Ma.a.instance;Ha.ja("WordEditor.Presence.WordPresenceManager",
()=>vg._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();Ha.resolve("WordEditor.Presence.WordPresenceManager")}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Phd(Ha){vg._instance||(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ha=Object(z.a)(753,Ha))&&Ha.z1a(vg.Phd),vg.init())}static Asj(){vg._instance.kBg()}static a4k(Ha,eb,rc,Uc,bd){rc=
bd.split(",");if(!rc||3!==rc.length)return 8;Ha=rc[0].trim();eb=rc[1].trim();rc=Number.parseInvariant(rc[2].trim());Ha=new Bg(new Na(Ha),new Wg(eb,rc,-1));if(!vg.aMc.task.isCompleted)return 8;eb=vg.jF().result;eb.jif(Ha);eb.Wxe();return 32}static Qvg(Ha,eb,rc,Uc,bd){if(!vg.aMc.task.isCompleted)return 8;Ha=vg.jF().result;Ha.iod(bd);Ha.Wxe();return 32}static qfp(Ha,eb,rc,Uc,bd){if(!vg.aMc.task.isCompleted)return 8;Ha=vg.jF().result;if(!Ha)return 8;Ha.nDe(bd);return 32}static ysg(Ha,eb,rc,Uc,bd){if(1===
rc)return 32;if(!vg.wxa.jF().isCompleted)return 8;Ha=vg.wxa.jF().result;if(!Ha)return l.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;bd[gj.a.Value]=2===Ha.connectionState?WacWordeditorStrings.RtcConnected:1===Ha.connectionState?WacWordeditorStrings.RtcConnecting:"";return 32}}vg._instance=null;vg.Knh=!0;vg.$Md=new w.a;vg.aMc=new w.a;vg.rFh=new w.a;vg.AJ=null;vg.XPc=null;vg.mTa=null;vg.wi=null;Object(f.a)(vg,"WordPresenceManager",Gh,[]);class tm{constructor(Ha,
eb){this.Heb=Ha;this.Cmn=eb;this.sa=new pa.a}H8k(Ha){this.sa.addHandler("X",Ha)}rJo(Ha){this.sa.removeHandler("X",Ha)}getStatus(){return this.Cmn?this.Heb.GIi().toString():"0"}}Object(f.a)(tm,"WordPresenceStatusProvider",null,[766]);class Cm{constructor(Ha,eb,rc,Uc){this.wi=null;this.Cnh=this.$2e=!1;this.W9n=()=>{this.wQ.isCompleted&&this.wQ.result?(this.wi=this.wQ.result,this.wi.jBa(this.GW),l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,
"RtcTask did not complete successfully. No monitoring")};this.GW=(bd,Hd)=>{bd=Hd.aka;for(const Pe in bd)if(Hd=bd[Pe],!this.$2e&&Hd.user.FH&&Hd.user.FH!==this.zJ.FH){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.zJ.FH,Hd.user.FH);this.$2e=!0;break}this.$2e&&this.wi.A1a(this.GW);this.Cnh||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.Cnh=!0)};this.Rk=Ha;this.zJ=eb;this.wQ=rc;rc.continueWith(this.W9n);this.pLk=
Uc;this.pLk.p9f=this.zJ}}Object(f.a)(Cm,"WordPresenceUpdateMonitor",null,[]);var Fj=e(432),hj=e(1999),wg=e(1359),Od=e(231),zg=e(1910),nh=e(1911),Vi=e(1775);class he{constructor(Ha,eb,rc,Uc,bd,Hd,Pe){this.sa=new pa.a;this.vuh=this.twh=this.o1e=this.lzh=!1;this.iff=this.HSd=0;this.$dc=null;this.dUa=Hd;this.dUa.clientId=Ha.clientId;this.Hl=Ha;this.bfa=eb;this.zfa=Uc;this.nCk=bd;this.Sb=rc;this.Zjb=new Od.a;this.fr=Pe;this.bfa&&this.bfa.continueWith(()=>{this.bfa.mq||this.bfa.wj||this.bfa.result.nUh(Object(Xa.a)(this,
this.Aoj,"onAmIAloneChanged"))})}get connectionState(){return this.Hl.connectionState}jBa(Ha){this.sa.addHandler("PU",Ha)}A1a(Ha){this.sa.removeHandler("PU",Ha)}K0(Ha){this.sa.addHandler("CSC",Ha)}MFa(Ha){this.sa.removeHandler("CSC",Ha)}Cob(Ha){this.sa.addHandler("PSU",Ha)}Rzb(Ha){this.sa.removeHandler("PSU",Ha)}Bob(Ha){this.sa.addHandler("PSC",Ha)}Qzb(Ha){this.sa.removeHandler("PSC",Ha)}wBg(){}get clientId(){return this.Hl.clientId}CQ(Ha){this.sa.addHandler("UN",Ha)}OFa(Ha){this.sa.removeHandler("UN",
Ha)}Kcn(){this.$dc=Array(12);for(let Ha=0;12>Ha;Ha++)this.$dc[Ha]=0;this.twh=this.fr?this.fr.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.IG(()=>{this.lOn()})}init(){this.Hl.K0(Object(Xa.a)(this,this.bM,"onConnectionStateChanged"));this.Hl.jBa(Object(Xa.a)(this,this.GW,"onPresenceUpdated"));this.Hl.Cob(Object(Xa.a)(this,this.Cia,"onPersistentStateUpdated"));this.Hl.Bob(Object(Xa.a)(this,this.o0a,"onPersistentStateCleared"));this.Hl.CQ(Object(Xa.a)(this,this.fU,"onUpdateNotificationReceived"));
this.gai();this.Kcn()}nxe(Ha){this.Zjb.contains(Ha,(eb,rc)=>eb===rc)||(this.Zjb.add(Ha),2===this.connectionState&&Ha.start())}MOg(Ha){for(let eb=0;eb<this.Zjb.length;eb++)if(this.Zjb.K(eb)===Ha){this.Zjb.VJ(eb);break}}connect(){this.o1e||this.Hl.connect()}disconnect(){this.Hl.disconnect()}get hze(){return this.Hl}Qji(Ha){return Bg.hPb(Ha)}VBg(Ha,eb){return(new Bg(Ha,eb)).ZQf()}xBg(Ha){Ha&&Ha.isValid()&&!this.zfa()?this.Hl.wBg(this.VBg(this.dUa.uHm(),Ha)):E.Task.T8(null)}hGa(Ha,eb){return this.Hl.hGa(Ha,
eb)}Rsb(Ha){return this.Hl.Rsb(Ha)}Hlc(){return this.Hl.Hlc()}sE(Ha,eb,rc=!1){return this.Hl.sE(Ha,eb,rc)}Ssb(){return this.Qdi(this.Hl.Ssb())}T$(Ha){const eb=new w.a;Vi.a.getInstance().Hwe(Ha,eb);return eb.task}get xda(){return this.Hl.xda}bM(Ha,eb){2===eb.newState&&this.Zjb.forEach(rc=>{rc.start();return!0});eb.newState||this.fr.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.o1e||this.Zjb.forEach(rc=>{rc.stop();return!0});this.sa.raiseEvent("CSC",eb)}eHf(Ha){return Ha.toLowerCase()}GW(Ha,
eb){if(!this.zfa()){Ha=this.Qdi(eb.aka);eb=this.Sdi(eb.d1c);var rc=new ej.a(Ha,eb);eb=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PU",rc)},57);this.Sb.pc(eb)}}Qdi(Ha){const eb={};for(const Uc in Ha){var rc=Uc;const bd=this.Qji(Ha[Uc]);bd&&bd.isValid()?eb[this.eHf(rc)]=bd:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",rc)}return eb}Sdi(Ha){const eb=Array(Ha.length);for(let rc=0;rc<Ha.length;rc++)eb[rc]=this.eHf(Ha[rc]);return eb}Cia(Ha,eb){if(!this.zfa()){var rc={};Ha=eb.aka;for(var Uc in Ha)rc[this.eHf(Uc)]=
Ha[Uc];Uc=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new zg.a(eb.type,rc))},80);this.Sb.pc(Uc)}}o0a(Ha,eb){if(!this.zfa()){Ha=this.Sdi(eb.Tpb);var rc=new nh.a(Ha);Ha=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PSC",rc)},81);this.Sb.pc(Ha)}}fU(Ha,eb){this.twh?this.Ruj(eb):(Ha=new Ca.a(0,1,0,()=>{this.Ruj(eb)},58),this.Sb.pc(Ha))}Ruj(Ha){var eb=Date.now();this.sa.raiseEvent("UN",Ha);eb=Date.now()-eb;500<=eb&&(this.HSd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",
Ha.type,eb),this.zfm(Ha));this.iff++}zfm(Ha){0>Ha.type||21<=Ha.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Ha.type):this.$dc[Ha.type]++}lOn(){if(!this.vuh){var Ha={};Ha.TC=this.iff;Ha.HRC=this.HSd;this.$dc&&0<this.HSd&&(Ha.TBC=this.$dc);this.HSd=this.iff=0;this.$dc=null;l.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Ha);this.vuh=!0}}dispose(){this.Zjb=new Od.a;this.Hl.MFa(Object(Xa.a)(this,this.bM,"onConnectionStateChanged"));
this.Hl.A1a(Object(Xa.a)(this,this.GW,"onPresenceUpdated"));this.Hl.Rzb(Object(Xa.a)(this,this.Cia,"onPersistentStateUpdated"));this.Hl.Qzb(Object(Xa.a)(this,this.o0a,"onPersistentStateCleared"));this.Hl.OFa(Object(Xa.a)(this,this.fU,"onUpdateNotificationReceived"));this.bfa&&this.bfa.continueWith(()=>{this.bfa.mq||this.bfa.wj||this.bfa.result.tIo(Object(Xa.a)(this,this.Aoj,"onAmIAloneChanged"))});this.Hl.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}Aoj(){this.gai()}gai(){let Ha=
!1;this.bfa?this.bfa.continueWith(()=>{this.bfa.mq||this.bfa.wj||(Ha=!this.bfa.result.Yq);this.Hl.connectionState||!Ha&&!this.nCk()?2!==this.Hl.connectionState||Ha||(this.disconnect(),l.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.lzh&&Ha&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.lzh=!0)}):
(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}jjc(){this.o1e=!0;this.disconnect();l.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(he,"RtcProxy",null,[1578,11,1579,1580]);class td extends he{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi){super(Ha,eb,rc,Uc,bd,Hd,hi);this.xla=null;this.sQ=Pe;this.Ld=Le;this.jUa=De;this.SPc=lf;this.Sbf=Af;this.qMb=mg}get rJ(){return this.xla||(this.xla=this.Sbf())}bM(Ha,eb){2===eb.newState&&
l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.AHp();super.bM(Ha,eb)}AHp(){this.rJ&&this.rJ.OW("RtcConnectionStatusLabel")}Qji(Ha){return qf.hwf(ch(Ha),this.sQ,this.Ld,this.jUa,this.qMb)}VBg(Ha,eb){return Object(Kk.a)(Rf,eb)?(Ha=new qf(this.SPc.JHi(),Ha,eb),Nf(Ha.ZQf())):super.VBg(Ha,eb)}}Object(f.a)(td,"WordRtcProxy",he,[]);class kh{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi){this.Xr=new w.a;this.AKh=!0;this.qe=eb;this.Sb=rc;this.zfa=Uc;this.dUa=bd;this.sQ=Hd;this.VAa=Pe;this.jUa=
Le;this.SPc=De;this.Sbf=lf;this.Q3=Af;this.qMb=mg;this.za=hi}jF(){this.Wwp();return this.Xr.task}NSb(){return Fj.a.then(this.jF(),Ha=>Ha)}Wwp(){if(this.AKh)if(this.AKh=!1,Fa.a.v4f()&&Fa.a.q2f()){var Ha=m.AFrameworkApplication.pe;if(Ha){var eb="{"+m.AFrameworkApplication.userSessionId+"}",rc=m.AFrameworkApplication.userSessionId,Uc=m.AFrameworkApplication.Lzg,bd=this.za.$("RtcAlwaysOnEnabled"),Hd=Le=>{const De=new td(Le,bd?null:sb.a.uDa(),this.Sb,this.zfa,kh.Rim,this.dUa,this.sQ,this.VAa,this.jUa,
this.SPc,this.Sbf,this.qMb,m.AFrameworkApplication.J);wg.a.G4o(De);this.fDo(De);De.init();hh.a.XPa=De;this.Q3.execute(lf=>{lf.Aob(()=>{De.jjc()})});this.Xr.setResult(De)};if(m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1))Promise.all([e.e(4),e.e(2),e.e(10)]).then(e.bind(null,2133)).then(Le=>{Pe=Le.RealtimeChannelNetCore.createInstance(eb,rc,Uc,Ha,this.Q3,1,this.qe,this.za.rb("RtcEndpointUrl"),void 0,void 0,null,this.za.$("FindSessionOnBootIsEnabled")?
Ma.a.instance.resolve("Common.IFindSessionUtils"):null,this.za.rb("RtcBootToken"));Hd(Pe)});else{var Pe=hj.RealtimeChannel.createInstance(eb,rc,Uc,Ha,this.Q3,1,this.qe,this.za.rb("RtcEndpointUrl"),void 0,void 0,null,this.za.$("FindSessionOnBootIsEnabled")?Ma.a.instance.resolve("Common.IFindSessionUtils"):null,this.za.rb("RtcBootToken"));Hd(Pe)}}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}fDo(Ha){const eb=
Ma.a.instance;eb.ja("WordEditor.Presence.WordRtcProxy",()=>Ha).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();eb.resolve("Common.IRealtimeChannelBasic")}static Rim(){return!1}}Object(f.a)(kh,"WordRtcProxyProvider",null,[767,768]);class eg{constructor(){this.Z=null;this.Vm=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Fa.a.Rhk&&(this.Z.resolve("WordEditor.Presence.WordRtcProxyProvider").jF(),vg.init(),this.Z.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
Fa.a.BZc&&vh.init();this.Z.resolve("Common.App.Presence.AwayManager");this.Z.resolve("Common.IPeopleInfoProvider");if(eg.iuh){const Ha=this.Z.resolve("WordEditor.IMainViewModeManager");Ha.SUd(this.Lvc);eg.T_e=1===Ha.vz||2===Ha.vz}}dispose(){if(!this.Vm){this.Vm=!0;vg.jF().continueWith(()=>{dd.a.BF(vg.jF().result)});var Ha=this.Z.resolve("Box4.Presence.MyPresenceUser");Ha&&Ha.Uwc&&Ha.Uwc.rJo(vg.Asj)}}Ec(Ha){this.Z=Ha;this.Z.ja("Box4.Presence.MyPresenceUser",()=>new ub).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();
Ha.ja("WordEditor.Presence.IWordPresenceCpFactory",()=>new Bj(Ha.resolve("Box4.CpConversionManagerImpl"),Ha.resolve("Box4.IContentControlReader"))).ha();Ha.ja("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Cm(new P.a(()=>sb.a.Gd()),vf.a.instance,Ha.resolve("WordEditor.Presence.WordRtcProxyProvider").NSb(),Ha.resolve("Box4.Presence.IMyPresenceUser"))).ha();Ha.ja("WordEditor.Presence.WordRtcProxyProvider",()=>new kh(m.AFrameworkApplication.buildVersion,Ua.StaticActiveAppFrame.Aa().Kt,Cb.TaskManager.instance,
()=>m.AFrameworkApplication.isShuttingDown,Ma.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Ma.a.instance.Wa("WordEditor.ParagraphWordIdMapping"),Ma.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.ta&&Ua.StaticActiveAppFrame.Aa().tb&&Ua.StaticActiveAppFrame.Aa().tb.rd?Ua.StaticActiveAppFrame.Aa().tb.rd.Hd:null,Jj.instance,()=>Ma.a.instance.Wa("WordEditor.IStatusBarUser"),Ma.a.instance.Za("Common.ISessionExpirationManager"),Ma.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
m.AFrameworkApplication.J)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Ha.ja("Box4.Presence.PresenceControlProvider",()=>new Uf(eg.uRl(),Vh.a.instance,Ma.a.instance.Za("Common.IZoomManager"),Ma.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ea.a.xr(Ma.a.instance.Za("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.J,Ha.resolve("Common.IPeopleInfoProvider"))).ha();Ha.ja("Common.App.Presence.AwayManager",()=>new Gf(Ma.a.instance.resolve("Common.IPresenceUser"),
Ma.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").NSb(),vg.PMm(),Ma.a.instance.resolve("Common.IPresenceConverter"),Cb.TaskManager.instance,m.AFrameworkApplication.J.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.J.sc("AwayCoauthorThresholdMs",9E5),Object(Xa.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.Vb,"processAction"),Ua.StaticActiveAppFrame.Aa().$L,m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();Ha.ja("WordEditor.Presence.WordPresenceStatusProvider",
()=>new tm(Ma.a.instance.resolve("WordEditor.IClientPaginationPageNumberFinder"),Ma.a.instance.resolve("WordEditor.ClientPagination.IClientPaginationSettings").pdb)).as("Common.IPresenceStatusProvider").ha();Ha.ja("Common.App.Presence.PeopleInfoProvider",()=>new ze(Ha.resolve("WordEditor.Presence.WordRtcProxyProvider").NSb(),sb.a.uDa().CWR(()=>sb.a.uDa().result.Wy),Ha.resolve("Common.App.People.IPeopleColorUtils"),Ha.resolve("Common.IPresenceConverter"),Ea.a.xr(Ha.Za("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();
Ha.ja("Box4.Presence.WordPresenceDataManager",()=>new kl(Ua.StaticActiveAppFrame.Aa().tb.rd.Hd)).as("Box4.IPresenceDataManager").ha()}Lvc(Ha,eb){Ua.StaticActiveAppFrame.Aa()&&Ua.StaticActiveAppFrame.Aa().VH&&(eg.VLd=null,eg.T_e=1===eb.$db||2===eb.$db)}static get Svj(){!eg.VLd&&Ua.StaticActiveAppFrame.Aa()&&Ua.StaticActiveAppFrame.Aa().VH&&(eg.VLd=hh.a.Xm.VH.getElementsByClassName(eg.T_e&&eg.iuh?"PaginatedContentContainerDisplayWrapper":"OutlineContainerDisplayWrapper")[0]);return eg.VLd}static uRl(){const Ha=
m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"),eb=m.AFrameworkApplication.J.$("PresenceIgnoreEventOnExpandedTooltip"),rc=m.AFrameworkApplication.J.$("PresenceIpWidthAdjustForFlyout"),Uc=new hc;Uc.add(jf.lXn,se.getImageClassWithCluster(m.AFrameworkApplication.Q1,"MoreUsersGlyph16"));Uc.add(jf.kXn,m.AFrameworkApplication.mr);Uc.add(jf.$ho,se.getImageClassWithCluster(m.AFrameworkApplication.Q1,Ha?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Uc.add(jf.aio,m.AFrameworkApplication.mr);
Uc.add(jf.zIndex,1);Uc.add(jf.rtl,m.AFrameworkApplication.isRtl);Uc.add(jf.UMp,eg.FXm);Uc.add(jf.r$m,eb);Uc.add(jf.Ukn,rc);return Ha?new gf(Uc):new Hf(Uc)}static FXm(){return eg.Svj?Kb.a.getElementBounds(eg.Svj):null}}eg.T_e=!0;eg.iuh=m.AFrameworkApplication.J.$("FlippedFlyoutForPaginationViewIsEnabled");eg.VLd=null;Object(f.a)(eg,"WordPresencePackage",null,[0,1]);var li=e(1056),Ll=e(1285),mi=e(1066),Ek=e(218);class Ml{constructor(Ha,eb){this.kif=Ha;this.paragraphId=eb}get opType(){return 2}get operation(){return this.kif}}
Object(f.a)(Ml,"RttAppliedAddParagraphOp",null,[770]);class Qk{constructor(Ha,eb){this.KLo=Ha;this.paragraphId=eb}get opType(){return 6}get operation(){return this.KLo}}Object(f.a)(Qk,"RttAppliedReplaceSymbolRangeOp",null,[770]);class km{constructor(Ha,eb){this.OLo=Ha;this.paragraphId=eb}get opType(){return 1}get operation(){return this.OLo}}Object(f.a)(km,"RttAppliedReplaceTextRangeOp",null,[770]);class $l{constructor(Ha,eb,rc){this.U1j=Ha;this.VDe=eb;this.R_c=rc}get opType(){return 4}get operation(){return this.U1j}get xZk(){return this.U1j.jic()?
this.R_c:this.VDe}}Object(f.a)($l,"RttAppliedSplitParagraphOp",null,[770]);class ll{constructor(){this.Wib=new dc.a}h6f(Ha){return Ha.toString()}ZUc(Ha,eb){Ha=this.h6f(Ha);this.Wib.Bb(Ha)||this.Wib.W(Ha,new U.a);this.Wib.K(Ha).add(eb)}Ujg(Ha){switch(Ha.opType){case 1:var eb=Object(z.a)(km,Ha);this.ZUc(eb.paragraphId,Ha);break;case 6:eb=Object(z.a)(Qk,Ha);this.ZUc(eb.paragraphId,Ha);break;case 4:eb=Object(z.a)($l,Ha);this.ZUc(eb.VDe,Ha);this.ZUc(eb.R_c,Ha);break;case 2:eb=Object(z.a)(Ml,Ha),this.ZUc(eb.paragraphId,
Ha)}}A5n(Ha){return this.vyb(Ha)}vyb(Ha){Ha=this.h6f(Ha);if(!this.Wib.Bb(Ha))return new U.a;const eb=this.Wib.K(Ha);this.Wib.remove(Ha);for(const rc of eb)rc.operation&&(rc.operation.Gba=null);return eb}yJm(Ha){let eb;return({value:eb}=this.Wib.Nc(this.h6f(Ha),eb)).returnValue?eb:new U.a}Omm(Ha){for(const eb of this.Wib.values){if(!eb.count)continue;if(2!==eb.K(0).opType)continue;const rc=eb.K(0);if(rc.kif.vfg===Ha)return rc}return null}}Object(f.a)(ll,"RttAppliedOpTracker",null,[752]);var tk=e(259),
am;(function(Ha){Ha[Ha.Q$l=0]="expired";Ha[Ha.g6p=1]="dried"})(am||(am={}));Object(f.b)("RemoveChangeReason",am);class bf{constructor(){this.hHa=new tk.a}t0k(Ha){if(!Ha)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const eb=Ha.qd,rc=Ha.kk;this.hHa.Bb(eb)||this.hHa.add(eb,new tk.a);this.hHa.K(eb).W(rc,Ha);return this.wTl(eb,rc)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",eb),this.hHa.K(eb).remove(rc),
!1):!0}$Of(Ha,eb){if(!this.hHa.Bb(Ha))return null;Ha=this.hHa.K(Ha);return Ha.Bb(eb)?Ha.K(eb):null}hae(Ha){const eb=new U.a;for(const rc of this.hHa.keys){const Uc=this.hHa.K(rc);for(const bd of Uc.keys){const Hd=Uc.K(bd);Ha(Hd)&&eb.add(Hd)}}return eb}GIj(Ha,eb){let rc=null;({value:rc}=this.hHa.Nc(Ha.qd,rc)).returnValue?(Ha.activity.Shg(am[eb]),rc.remove(Ha.kk),rc.count||this.hHa.remove(Ha.qd)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Ha.qd,eb)}wvg(Ha){this.GIj(Ha,1)}Bvg(Ha){this.GIj(Ha,0)}wTl(Ha,eb){if(!this.hHa.Bb(Ha))return!1;Ha=this.hHa.K(Ha);if(!Ha.Bb(eb))return!1;for(var rc=Ha.K(eb);rc;){rc=rc.v6;if(rc===eb)return!0;if(!Ha.Bb(rc))break;rc=Ha.K(rc)}return!1}}Object(f.a)(bf,"RttDataStore",null,[750,751]);var Cj=e(292),Wh=e(42),zk=e(281),Hl=e(215),Xf=e(13),we=e(61);class Rk{constructor(Ha,eb){this.eqe=(rc,Uc)=>{4===this.Gp.opType?l.ULS.shipAssertTag(9204866,355,12===Uc.node.type||11===Uc.node.type,"Unexpected graph modification detected during RTT edit"):
l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.vyb=()=>{l.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.Hqj=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Gp=Ha;if(this.yn=eb)Ha=this.yn.Hf(12),Ha.wv(this.eqe),Ha.bA(this.vyb),Ha.yq(this.Hqj)}dispose(){if(this.yn){const Ha=this.yn.Hf(12);Ha.VW(this.eqe);Ha.jxa(this.vyb);Ha.nU(this.Hqj)}}}Object(f.a)(Rk,
"GraphChangeValidator",null,[11]);class ml{constructor(Ha,eb,rc,Uc){this.id=Ha;this.cpBegin=eb;this.cpEnd=rc;this.tul=Uc}ALp(Ha){var eb=this.id===Ha.id;eb&&(eb=this.tul.replace("\u00a0"," "),Ha=Ha.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),eb=eb===Ha);return eb}}Object(f.a)(ml,"RttOpValidator",null,[803]);class Nl{constructor(Ha,eb){this.Gba=this.kEc=this.activity=null;this.opType=Ha;this.metadata=eb}$Rf(){return""}serialize(){return null}}Object(f.a)(Nl,"RttOp",
null,[765]);class kk extends Nl{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){super(De,Le);this.qd=Ha;this.kk=eb;this.EW=rc;this.P9=Uc;this.v6=bd;this.gCb=Hd;this.CL=Pe}Sfi(){return this.EW.isEqual(this.P9,!0)?new pg.a(0,this.qd,this.kk,this.EW,void 0,void 0,void 0,this.CL):new pg.a(1,this.qd,this.kk,this.EW,this.qd,this.kk,this.P9,this.CL)}static c9j(Ha){let eb,rc;var Uc=Ha.xY;if(1===Uc.Mwe&&(Uc.C0a!==Uc.jPa||Uc.shb!==Uc.sCc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
rc=eb=null,Ha=Uc=-1,{returnValue:!1,EW:rc,P9:eb,qd:Ha,kk:Uc};if(Uc.CL)return rc=eb=null,Ha=Uc=-1,{returnValue:!1,EW:rc,P9:eb,qd:Ha,kk:Uc};eb=rc=Uc.EW;1===Uc.Mwe&&(eb=Uc.P9);Ha=Uc.C0a;Uc=Uc.shb;return{returnValue:!0,EW:rc,P9:eb,qd:Ha,kk:Uc}}}Object(f.a)(kk,"RttReplaceRangeOp",Nl,[]);var Sn=e(1284),kg=e(475),gb=e(1023),Fb=e(527),Wb=e(459);class Cc extends Fb.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Hn(){return Wb.a.uRo}static yma(Ha,eb){const rc=new Cc;rc.FileId=Ha;rc.RttStatusRecords=
eb;return rc}}Object(f.a)(Cc,"RttStatusRequest",Fb.a,[]);class id{}Object(f.a)(id,"RttStatusOp",null,[]);class Ad{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(f.a)(Ad,"WireRttStatusOpRecord",null,[]);class Cd extends kg.a{constructor(){super();this.occ=new U.a;this.m$e=new U.a;this.Tm=new Sn.a(m.AFrameworkApplication.J.sc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;hh.a.w6.register(this)}Yok(){const Ha=Date.now();for(const eb of this.occ)eb.BZb&&1===eb.BZb&&(eb.BZb=2,eb.timeToRender=Ha-eb.metadata.jMg)}PKe(Ha){const eb=new id;eb.metadata=Ha.operation.metadata;eb.opType=Ha.opType;eb.BZb=1;this.occ.add(eb)}get rwa(){return"RttStatusReplicator"}zha(){return this.Oe&&this.Oe.status===gb.a.$Z?!0:1===this.enabled&&this.Tm.X4()?this.rG():!1}rG(){for(const Ha of this.occ)if(Ha.BZb&&2===Ha.BZb)return!0;return!1}G1a(){if(1===this._state){this._state=3;const eb=this.occ.toArray().filter(rc=>
2===rc.BZb);var Ha=this.$Kl(eb);Ha=Cc.yma(m.AFrameworkApplication.rootQuerySignature,Ha);eb.forEach(rc=>this.occ.remove(rc));eb.forEach(rc=>this.m$e.add(rc));this.Oe.Ls=Ha;this.Oe.MH="RttStatusRequest";this.Oe.status=gb.a.xK}else 3===this._state&&this.Oe&&this.Oe.status===gb.a.$Z&&(this.Tm.V$(),2!==this.Oe.statusCode&&this.occ.PC(0,this.m$e),this.m$e.clear(),this._state=1)}$Kl(Ha){const eb=[];Ha.forEach(rc=>{const Uc=new Ad;Uc.clientId=rc.metadata.clientId;Uc.clientType=rc.metadata.clientType;Uc.packetId=
rc.metadata.packetId;Uc.packetVersion=rc.metadata.packetVersion;Uc.strictlySequentialId=rc.metadata.strictlySequentialId;Uc.contentType=rc.opType;Uc.contentState=rc.BZb;Uc.timeToRender=rc.timeToRender;eb.push(Uc)});return eb}X2b(){return!0}DC(){}lG(){}}Object(f.a)(Cd,"RttStatusReplicator",kg.a,[]);class qe{constructor(Ha,eb,rc,Uc,bd,Hd){this.packetId=Ha;this.clientId=eb;this.clientType=rc;this.jMg=Uc;this.packetVersion=bd;this.strictlySequentialId=Hd}static create(Ha){let eb=null;null!=Ha.strictlySequentialId&&
(eb=Ha.strictlySequentialId);return new qe(Ha.packetId,Ha.clientId,Ha.client,Date.now(),Ha.version,eb)}}Object(f.a)(qe,"RttOpMetadata",null,[]);class df extends Nl{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De){super(4,De);this.v6=0;this.qd=Ha;this.kk=eb;this.offset=rc;this.CL=Uc;this.FSg=bd;this.RLg=Hd;this.qKe=Pe;this.SLg=Le;this.FSg===this.qd?this.v6=this.RLg:this.qKe===this.qd?this.v6=this.SLg:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.v6=0)}jic(){return this.qd===
this.qKe}get rrp(){return this.v6}get tPp(){return this.jic()?this.FSg:this.qKe}get Q5j(){return this.jic()?this.RLg:this.SLg}serialize(){const Ha=new pg.a(3,this.qd,this.kk,this.offset,null,null,null,this.CL),eb=new Kc(this.FSg,this.RLg,this.qKe,this.SLg);return new Nc(this.metadata.packetId,this.metadata.clientId,1,4,Ha,null,void 0,void 0,void 0,void 0,eb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){const eb=Ha.xY,rc=Ha.u3b;return new df(eb.C0a,eb.shb,eb.EW,eb.CL,rc.Jmg,rc.QLg,
rc.Kmg,rc.TLg,qe.create(Ha))}static MPm(Ha,eb,rc){if(1!==Ha.type)return null;const Uc=rc.J0a(Ha.Q9.characterData,Ha.Q9.ra);return new df(Ha.Q9.qd,Ha.Q9.kk,rc.DEc(Uc,Ha.G1j),Ha.CL,Ha.tMb.qd,Ha.tMb.kk,Ha.KWc.qd,Ha.KWc.kk,eb)}}Object(f.a)(df,"RttSplitParagraphOp",Nl,[747,765]);class Ef{constructor(Ha,eb,rc,Uc){this.A1n=()=>{this.AKb.Yok()};this.Uqa=Ha;this.nPc=eb;this.Cra=rc;this.BLb=Uc;null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.AKb=new Cd,Cj.a.instance.mUh(this.A1n))}iel(Ha,eb,rc,Uc=null){if(eb.isDirty)return Uc&&Uc.properties.W(Ef.Zwj,"1"),!1;const bd=new Rk(Ha,eb.ml);try{if(1===Ha.opType||6===Ha.opType){const Le=Object(z.a)(kk,Ha),De=this.FGl(Le,eb);var Hd=De.node.characterData;const lf=10<=De.cpBegin?De.cpBegin-10:0;let Af=De.cpEnd+10<=Hd.length?De.cpEnd+10:Hd.length;const mg=Hd.substr(lf,De.cpBegin-lf),hi=Hd.substr(De.cpEnd,Af-De.cpEnd);Af=Af+Le.gCb.length-(De.cpEnd-De.cpBegin);var Pe=new ml(De.node.id,lf,
Af,mg+Le.gCb+hi);const Uh=6===Le.opType;Hd="";Uh&&(Hd=Le.font);if(!this.tLo(De,Le.gCb,Uh,Hd,Uc))return!1;let nk;nk=1===Ha.opType?new km(Le,eb.id):new Qk(Le,eb.id);eb.bua=Ha.v6;Le.kEc=Pe;Ha.Gba=nk;rc.Ujg(nk);null!=this.AKb&&this.AKb.PKe(nk)}else return 4===Ha.opType?this.hel(Ha,eb,rc):!1}finally{bd&&bd.dispose()}return!0}hel(Ha,eb,rc){const Uc=Object(z.a)(df,Ha);var bd=this.BLb.J0a(eb.characterData,eb.ra);bd=this.BLb.bPb(bd,Uc.offset);if(!this.Z6i(Ob.a.createTextRange(eb,0,kb.ParagraphReader.textLength(eb))))return!1;
var Hd=th.a.kb(eb);Hd.Ib(10);if(this.Iie(Hd))return!1;let Pe;Hd=this.Cra.Vc(3);try{Hd.Eb(eb);const Le=eb.R2();try{const De=th.a.kb(eb);De.Ib(10);De.xd(11);let lf=De.currentNode;Uc.jic()&&(De.r1f?lf=null:(De.cR(),lf=De.currentNode));De.Ac();const Af=this.nPc.Jqb();De.QL(Af,lf,89);De.yk(Af);Pe=eb.clone();const mg=Pe.R2();try{Pe.setValue(ug.a.qd,Uc.tPp);Pe.setValue(ug.a.kk,Uc.Q5j);Pe.isDirty=!1;De.pg(Pe,2);De.yk(Pe);this.zIl(eb,Pe);const hi=Uc.jic()?Pe:eb,Uh=Uc.jic()?eb:Pe;hi.QS=!0;Uh.QS=!0;this.Uqa.qxg(this.gLa(hi,
bd,kb.ParagraphReader.textLength(hi)),"",!1,"");this.Uqa.qxg(this.gLa(Uh,0,bd),"",!1,"");eb.bua=Uc.rrp;Pe.bua=Uc.Q5j}finally{mg&&mg.dispose()}}finally{Le&&Le.dispose()}Hd.Y1a()}finally{Hd&&Hd.dispose()}eb=new $l(Uc,eb.id,Pe.id);Ha.Gba=eb;rc.Ujg(eb);null!=this.AKb&&this.AKb.PKe(eb);return!0}Iie(Ha){const eb=new th.a;eb.Ad(Ha);eb.xd(11);return Wh.a.Wg(eb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}Cem(Ha,eb,rc){var Uc=eb.Itb(Ha.qd);if(Uc.equals(Mf.a.nil))return null;
Uc=rc.Mb(Uc);if(!Uc||!kb.ParagraphReader.lc(Uc)||!Uc.isConnected)return null;const bd=th.a.kb(Uc);if(!bd.Ib(23))return null;if(Ha.ESg){Ha=eb.Itb(Ha.ESg);if(Ha.equals(Mf.a.nil))return null;rc=rc.Mb(Ha);if(!rc||!kb.ParagraphReader.lc(rc)||!rc.isConnected)return null;rc=th.a.kb(rc);if(!rc.Ib(23))return null;rc.xd(11);rc.cR();rc.ue();if(rc.currentNode!==Uc)return null}return this.Iie(bd)?null:bd}Owp(Ha,eb,rc,Uc){const bd=eb.currentNode,Hd=this.Cra.Vc(3);try{Hd.Eb(bd);eb.xd(11);const Pe=eb.currentNode;
eb.Ac();const Le=this.nPc.Jqb();eb.QL(Le,Pe,89);eb.yk(Le);const De=zk.a.instance.createInstance(we.a.paragraphNode),lf=De.R2();try{De.setValue(Xf.a.so,""),De.qcb=!0,Uc.M0b(De),Uc=[0],De.setValue(ug.a.qU,Uc),De.setValue(ug.a.A2,Uc),De.qcb=!1,De.setValue(ug.a.qd,Ha.vfg),De.setValue(ug.a.kk,Ha.ufg),De.isDirty=!1,eb.pg(De,2),De.QS=!0,De.bua=Ha.ufg}finally{lf&&lf.dispose()}Hd.Y1a();Ha.Gba=new Ml(Ha,De.id);rc.Ujg(Ha.Gba);null!=this.AKb&&this.AKb.PKe(Ha.Gba)}finally{Hd&&Hd.dispose()}return!0}gLa(Ha,eb,rc){return eb===
rc?Ob.a.jd(Ha,eb):Ob.a.createTextRange(Ha,eb,rc)}tLo(Ha,eb,rc,Uc,bd=null){const Hd=Ha.node;if(Ha.cpBegin!==Ha.cpEnd&&!this.Z6i(Ha))return bd&&bd.properties.W(Ef.kak,"1"),!1;bd=this.Cra.Vc(3);try{bd.Eb(Hd);const Pe=Hd.R2();try{Hd.QS=!0,this.Uqa.qxg(Ha,eb,rc,Uc)}finally{Pe&&Pe.dispose()}bd.Y1a()}finally{bd&&bd.dispose()}return!0}zIl(Ha,eb){eb.qcb=!0;eb.Fxa(Ha.characterData);eb.bua=Ha.bua;eb.ra.clear();for(var rc=0;rc<Ha.ra.length;rc++){const Uc=Ha.ra.jc(rc).rta(eb);eb.ra.add(Uc)}eb.eo();if(eb.Bf.length)for(Ha=
0;Ha<eb.ra.length;Ha++){if((rc=eb.ra.jc(Ha).formatting)&&-1!==rc.Re)for(;eb.Bf.length<=rc.Re;)eb.Bf.pZ(eb.Bf.length-1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");eb.qcb=!1}F5f(Ha){Ha=th.a.kb(Ha);Ha.Ib(23);Ha.Ac();return{returnValue:89===Ha.role,iterator:Ha}}lwg(Ha){const eb=new th.a;eb.Ad(Ha);eb.Ac();const rc=this.Cra.Vc(3);try{rc.Eb(eb.currentNode),Ha.qh()}finally{rc&&rc.dispose()}}EFo(Ha){if(Ha.anchor)if(({iterator:eb}=this.F5f(Ha)).returnValue)this.lwg(eb);
else{var eb=Ha.ed.Dn;var rc=this.Cra.Vc(3);try{rc.Eb(Ha),Ha.load(Object(Hl.d)(eb).Mb(Ha.id)),Ha.anchor.e5(4)}finally{rc&&rc.dispose()}}}azg(Ha,eb,rc){for(let Hd=eb.count-1;0<=Hd;Hd--){var Uc=eb.K(Hd);switch(Uc.opType){case 4:Uc=Object(z.a)($l,Uc);if(!Ha.id.equals(Uc.VDe)){l.ULS.shipAssertTag(9204885,355,Ha.id.equals(Uc.R_c));continue}Uc=rc.Mb(Uc.R_c);if(!Uc)break;if(!Uc||!kb.ParagraphReader.lc(Uc)){l.ULS.shipAssertTag(9204886,355,!1);break}if(!Uc.isConnected)continue;var bd=({iterator:Uc}=this.F5f(Uc)).returnValue;
l.ULS.shipAssertTag(9204887,355,bd);bd&&this.lwg(Uc);break;case 2:(Uc=Object(z.a)(Ml,Uc),Ha.id.equals(Uc.paragraphId))?Ha.isConnected&&(bd=({iterator:Uc}=this.F5f(Ha)).returnValue,l.ULS.shipAssertTag(16820002,355,bd),bd&&this.lwg(Uc)):l.ULS.shipAssertTag(16820001,355,!1)}}}FGl(Ha,eb){const rc=this.BLb.J0a(eb.characterData,eb.ra),Uc=this.BLb.bPb(rc,Ha.EW);Ha=this.BLb.bPb(rc,Ha.P9);return Uc===Ha?Ob.a.jd(eb,Uc):Ob.a.createTextRange(eb,Uc,Ha)}Z6i(Ha){const eb=Ha.node.ra,rc=Ha.cpBegin;Ha=Ha.cpEnd;for(let Uc=
0;Uc<eb.length;Uc++){const bd=eb.jc(Uc);if(bd.cp>=Ha)break;if(bd.cp>=rc){if(bd.Nf)return l.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(bd.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(bd.Fc||bd.Zcd||bd.mhe)return l.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Ef.Zwj="ParagraphAlreadyDirty";Ef.kak="UnsafeWetChange";Object(f.a)(Ef,"RttEditor",
null,[749]);var Sf=e(17),Je=e(1325),Ug=e(260);class Kf{constructor(){this.Fzd=new U.a}add(Ha){this.Fzd.add(Ha);return!0}hae(Ha){const eb=new U.a;for(const rc of this.Fzd)Ha(rc)&&eb.add(rc);return eb}wvg(Ha){Ha.activity.Shg("dried");this.Fzd.remove(Ha)}Bvg(Ha){Ha.activity.Shg("expired");this.Fzd.remove(Ha)}}Object(f.a)(Kf,"RttAddParagraphDataStore",null,[]);class fl extends Nl{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le){super(2,Le);this.qd=Ha;this.kk=eb;this.v6=rc;this.ESg=Uc;this.vfg=bd;this.ufg=Hd;this.CL=
Pe}serialize(){const Ha=new pg.a(2,this.qd,this.kk,null,this.ESg,null,null,this.CL),eb=new gc(this.v6,this.vfg,this.ufg);return new Nc(this.metadata.packetId,this.metadata.clientId,1,3,Ha,null,void 0,void 0,eb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){const eb=Ha.xY,rc=Ha.Qec;let Uc=null;null!=Ha.xY.jPa&&(Uc=Ha.xY.jPa);return new fl(eb.C0a,eb.shb,rc.ULg,Uc,rc.Mmg,rc.v6,eb.CL,qe.create(Ha))}static IPm(Ha,eb){return 3!==Ha.type?null:new fl(Ha.vwa.qd,Ha.vwa.kk,
Ha.XXn.kk,Ha.d0a?Ha.d0a.qd:null,Ha.OEa.qd,Ha.OEa.kk,Ha.CL,eb)}}Object(f.a)(fl,"RttAddParagraphOp",Nl,[]);class Ji{constructor(Ha){this.y_=Ha}mFj(){this.y_&&this.y_.properties.W(Ji.csi,"1")}Ywo(Ha){this.y_&&(this.y_.properties.Bb(Ji.Mcg)||this.y_.properties.W(Ji.Mcg,(Ha-this.y_.startTime).toString()))}Shg(Ha){this.y_&&(this.y_.properties.W(Ji.ZJj,Ha),this.y_.end())}vyo(Ha){this.y_&&this.y_.properties.W(Ji.gwj,Ha.toString())}tyo(Ha){this.y_&&this.y_.properties.W(Ji.Dvj,Ha)}static dYf(Ha){Ha.s$(eh.a.x1b,
Ji.csi,Je.a.Z3j);Ha.s$(eh.a.x1b,Ji.hbm,Je.a.Z3j);Ha.s$(eh.a.x1b,Ji.Mcg,Je.a.gil);Ha.s$(eh.a.x1b,Ji.ZJj,Je.a.bCa);Ha.s$(eh.a.x1b,Ji.gwj,Je.a.bCa);Ha.s$(eh.a.x1b,Ji.Dvj,Je.a.bCa)}static create(Ha){if(!Ha)return null;Ha=Ha.vr(eh.a.x1b,Ji.YNp);return new Ji(Ha)}}Ji.csi="FailedToFindInitialParaID";Ji.hbm="FailedToFindInitialTextID";Ji.Mcg="MsecUntilApplied";Ji.ZJj="RemovedBecause";Ji.gwj="PacketVersions";Ji.Dvj="OperationType";Ji.YNp=48E4;Object(f.a)(Ji,"RttOpActivity",null,[]);var lk;(function(Ha){Ha[Ha.unknown=
0]="unknown";Ha[Ha.Orq=1]="replaceTextRangeOp";Ha[Ha.w_p=2]="addParagraphOp";Ha[Ha.U4p=3]="deleteParagraphOp";Ha[Ha.nwq=4]="splitParagraphOp";Ha[Ha.Xfq=5]="mergeParagraphOp";Ha[Ha.Nrq=6]="replaceSymbolRangeOp"})(lk||(lk={}));Object(f.b)("RttOpType",lk);var Sj=e(117);class dk extends kk{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af){super(Uc,bd,Hd,Pe,Le,De,lf,Af,6);this.font=Ha;this.tGn=eb}$Rf(){return"OffsetStart: "+this.EW+"OffsetEnd: "+this.P9}serialize(){const Ha=this.Sfi();return new Nc(this.metadata.packetId,
this.metadata.clientId,1,7,Ha,null,this.v6,this.gCb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){let eb,rc,Uc,bd;if(!({EW:eb,P9:rc,qd:Uc,kk:bd}=kk.c9j(Ha)).returnValue)return null;let Hd,Pe;if(1===Ha.text.length)Hd=!1,Pe=Sj.AParagraphNode.jG;else if(2===Ha.text.length)if(Lb.a.d3i(Ha.text,0)&&Lb.a.VC(Ha.text,1))Hd=!0,Pe=Ha.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Ha.operationType),
null;else return l.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ha.operationType),null;const Le=Ha.lud,De=qe.create(Ha);return new dk(Le.mKg,Le.nKg,Hd,Uc,bd,eb,rc,Ha.d4b,Pe,Ha.xY.CL,De)}}Object(f.a)(dk,"RttReplaceSymbolRangeOp",kk,[747,765]);class Zd extends kk{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le){super(Ha,eb,rc,Uc,bd,Hd,Pe,Le,1)}$Rf(){return"OffsetStart: "+this.EW+"OffsetEnd: "+this.P9+"TextAddedLength: "+this.gCb.length}serialize(){const Ha=
this.Sfi();return new Nc(this.metadata.packetId,this.metadata.clientId,1,2,Ha,null,this.v6,this.gCb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){let eb,rc,Uc,bd;if(!({EW:eb,P9:rc,qd:Uc,kk:bd}=kk.c9j(Ha)).returnValue)return null;let Hd="";Ha.text&&(Hd=Ha.text);const Pe=qe.create(Ha);return new Zd(Uc,bd,eb,rc,Ha.d4b,Hd,Ha.xY.CL,Pe)}static KOm(Ha,eb,rc){if(Ha.type)return null;const Uc=rc.J0a(Ha.Q9.characterData,Ha.Q9.ra);return new Zd(Ha.Q9.qd,Ha.Q9.kk,rc.DEc(Uc,
Ha.cpBegin),rc.DEc(Uc,Ha.cpEnd),Ha.OEa.kk,Ha.wia,Ha.CL,eb)}}Object(f.a)(Zd,"RttReplaceTextRangeOp",kk,[747,765]);class qg{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le,De,lf,Af,mg,hi,Uh,nk,fi,kc,Ze,Fg,ii,te){this.mK=ii;this.Jkc=te;this.Hl=null;this.o0e=this.bQh=!1;this.BDd=!0;this.TBh=0;this.rJh=this.haf=this.tJh=this.qJh=this.sJh=!1;this.zkg=()=>{l.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Hl=this.wQ.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");
this.Hl.CQ(this.fU)};this.fU=(pe,Ee)=>{if(3===Ee.type||10===Ee.type)if(10===Ee.type)this.TBh="boolean"===typeof Ee.fC?Ee.fC?1:0:Ee.fC;else{if(Fa.a.Ppa){if(Fa.a.Qk&&!Fa.a.Qk.rub){l.ULS.sendTraceTag(508351552,355,15,"RTT channel did not get disconnected on lock release");return}}else if(this.Aac.value&&!this.Aac.value.rub){l.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");return}if(!Ee.fC)l.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty");else if(!this.Jkc||
2!==this.mK.vz)if(this.Iyo(),(pe=this.NXl(Ee.fC))&&1!==pe.metadata.clientType&&(this.Hyo(),(!this.Hq||this.Hq.jda||Sf.a.Avb||Sf.a.WT||Sf.a.Avb||Sf.a.WT)&&2!==this.TBh))switch(this.BDd&&(this.ncc.xFj(),this.BDd=!1),this.bQh||this.Mcn(),pe.opType){case 1:case 6:case 4:if(!({Eg:pe}=this.u0k(pe)).returnValue)break;this.kNh?this.HPj(pe):this.j$j(pe);break;case 2:this.ZFc.add(pe),this.rWi(pe),this.kNh?this.HPj(Mf.a.nil):this.i$j(pe)}}};this.P$l=()=>{const pe=this.oj.value;if(pe){var Ee=this.TG()-qg.QFo,
rd=this.uFb.hae(ui=>ui.metadata.jMg<Ee);0<rd.count&&this.Zwo();var wj=new Ug.a;for(const ui of rd)if(this.uFb.Bvg(ui),ui.Gba)switch(ui.Gba.opType){case 1:wj.add(ui.Gba.paragraphId.toString());break;case 6:wj.add(ui.Gba.paragraphId.toString());break;case 4:wj.add(ui.Gba.VDe.toString()),wj.add(ui.Gba.R_c.toString())}rd=this.ZFc.hae(ui=>ui.metadata.jMg<Ee);for(const ui of rd)this.ZFc.Bvg(ui),ui.Gba&&wj.add(ui.Gba.paragraphId.toString());for(const ui of wj)(wj=pe.Mb(Mf.a.Of(ui)))?wj.QS?(this.zKb.EFo(wj),
wj.QS||this.NNc.value.pJj(wj)):l.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.oj.UVf&&l.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.zKb=Ha;this.uFb=eb;this.NNc=rc;this.Aac=Uc;this.sQ=bd;this.wQ=Hd;this.oj=Pe;this.Sb=Le;this.TG=De;this.BLb=lf;this.Jd=Af;this.I7e=hi;this.Zc=Uh;this.kNh=nk;this.ncc=fi;this.kEb=
kc;this.ugf=Ze;this.cQc=new D.a(G.a.Oh());this.ZFc=new Kf;mg.execute(qg.dYf);this.Hq=Fg}Mcn(){const Ha=new Ca.a(3,2,qg.THo,this.P$l);this.Sb.pc(Ha);this.bQh=!0}init(){return this.wQ?this.wQ.continueWith(this.zkg):E.Task.T8(!1)}NXl(Ha){Ha=ch(Ha);if(!Ha)return null;switch(Ha.operationType){case 2:return Zd.create(Ha);case 7:return dk.create(Ha);case 4:return df.create(Ha);case 3:return fl.create(Ha);default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Ha.operationType),
null}}u0k(Ha){let eb=Mf.a.nil;if(!this.uFb.t0k(Ha))return{returnValue:!1,Eg:eb};this.rWi(Ha);if(!this.sQ)return{returnValue:!1,Eg:eb};const rc=this.sQ.Itb(Ha.qd);if(rc.equals(Mf.a.nil)||!this.oj.value.Mb(rc))return Ha.activity.mFj(),{returnValue:!1,Eg:eb};this.zFj();return{returnValue:!0,Eg:rc}}HPj(Ha){Ha.equals(Mf.a.nil)||this.cQc.add(Ha.toString());this.o0e||(Ha=new Ca.a(0,1,200,()=>{this.Myp();this.o0e=!1},71),this.Sb.pc(Ha),this.o0e=!0)}CTo(Ha){Ha=new Ca.a(0,1,0,Ha,71);this.Sb.pc(Ha)}rWi(Ha){Ha.activity=
Ji.create(this.Jd);Ha.activity.vyo(Ha.metadata.packetVersion);Ha.activity.tyo(lk[Ha.opType])}Myp(){var Ha=this.ZFc.hae(rc=>!rc.Gba);for(const rc of Ha)this.i$j(rc);if(this.cQc.count){Ha=null;for(var eb of this.cQc){eb=Mf.a.Of(eb);Ha=this.oj.value.Mb(eb);break}eb=this.Zc.Vc(3);try{eb.Eb(Ha);for(const rc of this.cQc)this.j$j(Mf.a.Of(rc))}finally{eb&&eb.dispose()}this.cQc.clear()}}j$j(Ha){Ha=this.oj.value.Mb(Ha);let eb;const rc=this.Zc.Vc(3);try{rc.Eb(Ha);eb=this.Jd.vr(eh.a.xYh);const Uc=this.BYh(Ha,
eb);eb.end();Uc&&this.$3k(Uc)}finally{rc&&rc.dispose(),this.ncc.Rtg(1),this.BDd=!0}}i$j(Ha){var eb=this.zKb.Cem(Ha,this.sQ,this.oj.value);eb&&(this.zFj(),this.zKb.Owp(Ha,eb,this.kEb,Ma.a.instance.resolve("Box4.IParagraphEditor"))&&(eb=this.oj.value.Mb(Ha.Gba.paragraphId),this.WYh(eb,Ha),this.ncc.Rtg(1),this.BDd=!0))}$3k(Ha){this.I7e.continueWith(()=>{if(1===Ha.opType){var eb=this.LMm(Ha);eb&&(this.I7e.result.jif(eb),this.I7e.result.Wxe(!0))}})}LMm(Ha){const eb=Ha.serialize();if(2!==eb.operationType||
eb.xY.jPa&&eb.xY.C0a!==eb.xY.jPa)return null;const rc=Ha.EW.clone();0<Ha.gCb.length&&(rc.e8h(),rc.cp+=Ha.gCb.length);eb.operationType=0;eb.text=null;eb.xY.Mwe=0;eb.xY.EW=rc;eb.xY.shb=eb.d4b;eb.xY.jPa=null;eb.xY.sCc=null;eb.xY.P9=null;eb.d4b=null;return qf.hwf(eb,this.sQ,this.BLb,()=>this.oj.value,this.ugf.instance)}WYh(Ha,eb){return this.NNc.value?this.NNc.value.d_k(Ha,eb.metadata.clientId).returnValue?!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,
355,!!this.NNc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}AYh(Ha,eb){this.BYh(Ha,eb)}BYh(Ha,eb){if(!Ha)return null;if(!Ha.anchor)return eb&&eb.properties.W(qg.Fmj,"1"),null;if(!Ha.hasProperty(ug.a.qd))return l.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Ha.hasProperty(ug.a.kk))return l.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Ha.hasProperty(ug.a.fli)&&Ha.getValue(ug.a.fli))return l.ULS.sendTraceTag(16815506,
355,50,"RTT edit disabled in paragraph"),null;const rc=Ha.getValue(ug.a.qd);var Uc=Ha.bua;eb&&(eb.properties.W(qg.RYn,Uc.toString()),eb.properties.W(qg.UYn,rc.toString()));Uc=this.uFb.$Of(rc,Uc);if(!Uc)return eb&&eb.properties.W(qg.tmj,"1"),null;if(!this.WYh(Ha,Uc))return eb&&eb.properties.W(qg.Qci,"1"),null;let bd=0,Hd=null;for(;Uc;){if(!this.zKb.iel(Uc,Ha,this.kEb,eb)){eb&&eb.properties.W(qg.hhk,"1");break}bd++;Uc.activity.Ywo(this.TG());Hd=Uc;Uc=Ha.bua;Uc=this.uFb.$Of(rc,Uc)}0<bd&&this.$Ej();eb&&
eb.properties.add(qg.ihk,bd.toString());return Hd}Cxe(Ha){if(Ha.hasProperty(ug.a.qd)&&Ha.hasProperty(ug.a.kk)){var eb=Ha.getValue(ug.a.qd),rc=Ha.ka(ug.a.kk,0),Uc=this.Jd.vr(eh.a.vHj),bd=this.kEb.A5n(Ha.id);0<bd.count&&(this.zKb.azg(Ha,bd,this.oj.value),this.kGo(Ha,bd,rc));var Hd=this.kEb.Omm(eb);if(Hd&&!Ha.id.equals(Hd.paragraphId)){const Pe=this.oj.value;this.CTo(()=>{const Le=this.kEb.vyb(Hd.paragraphId),De=Pe.Mb(Hd.paragraphId);l.ULS.shipAssertTag(16820032,355,!!De,"Could not find added graph node");
De&&(this.zKb.azg(De,Le,Pe),this.ZFc.wvg(Hd.kif))})}this.uFb.$Of(eb,rc)||this.NNc.value.pJj(Ha);this.AYh(Ha,Uc);Uc.end()}}kGo(Ha,eb,rc){let Uc=!1;for(let Hd=eb.count-1;0<=Hd;Hd--){var bd=eb.K(Hd);switch(bd.opType){case 1:case 6:case 4:bd=Object(z.a)(747,bd.operation);break;default:continue}bd.v6===rc&&(Uc=!0,bd.kEc&&!bd.kEc.ALp(Ha)&&l.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",
bd.opType,bd.$Rf(),Ha.id,bd.kEc.id,bd.kEc.cpBegin,bd.kEc.cpEnd));Uc&&this.uFb.wvg(bd)}Uc&&this.$Ej()}Iid(Ha){const eb=this.kEb.vyb(Ha.id);0<eb.count&&(2===eb.K(0).opType&&eb.removeAt(0),this.zKb.azg(Ha,eb,this.oj.value))}mCe(Ha){var eb=this.kEb.yJm(Ha.id);for(const rc of eb)if(4===rc.opType&&(eb=Object(z.a)($l,rc),Ha.id.equals(eb.xZk)))return!0;return!1}Iyo(){this.sJh||(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.sJh=!0)}Hyo(){this.qJh||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.qJh=!0)}zFj(){this.tJh||(l.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.tJh=!0)}$Ej(){this.haf||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.haf=!0)}Zwo(){this.haf||this.rJh||(l.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.rJh=!0)}static dYf(Ha){const eb=[eh.a.xYh,eh.a.vHj];for(const rc of eb)Ha.s$(rc,qg.ihk,Je.a.bCa),Ha.s$(rc,qg.tmj,Je.a.bCa),Ha.s$(rc,qg.Fmj,Je.a.bCa),Ha.s$(rc,qg.Qci,Je.a.bCa),Ha.s$(rc,
qg.hhk,Je.a.bCa),Ha.s$(rc,Ef.Zwj,Je.a.bCa),Ha.s$(rc,Ef.kak,Je.a.bCa);Ji.dYf(Ha)}}qg.THo=6E4;qg.QFo=18E4;qg.ihk="WetChangeCount";qg.tmj="NoChangesToApply";qg.Fmj="NodeNotConnected";qg.Qci="CouldNotGetLock";qg.hhk="WetChangeBlocked";qg.UYn="NodeWordId";qg.RYn="NodeTextId";Object(f.a)(qg,"RttManager",null,[748]);class sh{constructor(Ha,eb){this.qOj=0;this.Nk=Ha;this.tRo=eb}xFj(){this.qOj=this.Nk()}Rtg(Ha){const eb=this.Nk()-this.qOj;0<=eb&&this.tRo.track(Math.round(eb),0===Ha?"CTB":"RTP")}}Object(f.a)(sh,
"RttPerfCounter",null,[746]);var qi=e(2015);class Dm{constructor(){this.JRc=new qi.a}C4k(Ha,eb){this.JRc.back()&&eb&&this.JRc.back().w9a(Ha)||this.JRc.enqueue(Ha)}VHm(){return this.JRc.isEmpty?null:this.JRc.dequeue()}}Object(f.a)(Dm,"RttSendDataStore",null,[744]);class Ci extends Nl{constructor(Ha,eb,rc,Uc){super(3,Uc);this.qd=Ha;this.kk=eb;this.CL=rc}get v6(){return 0}serialize(){const Ha=new pg.a(4,this.qd,this.kk,null,null,null,null,this.CL);return new Nc(this.metadata.packetId,this.metadata.clientId,
1,5,Ha,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){const eb=Ha.xY;return new Ci(eb.C0a,eb.shb,eb.CL,qe.create(Ha))}static JPm(Ha,eb){return 4!==Ha.type?null:new Ci(Ha.Zic.qd,Ha.Zic.kk,Ha.CL,eb)}}Object(f.a)(Ci,"RttDeleteParagraphOp",Nl,[747,765]);class nj extends Nl{constructor(Ha,eb,rc,Uc,bd,Hd,Pe,Le){super(5,Le);this.DSg=Ha;this.P5j=eb;this.sPp=rc;this.srp=Uc;this.CL=bd;this.Vhk=Hd;this.tCc=Pe}get qd(){return this.DSg}get kk(){return this.P5j}get v6(){return this.DSg===
this.Vhk?this.tCc:0}serialize(){const Ha=new pg.a(5,this.DSg,this.P5j,null,this.sPp,this.srp,null,this.CL),eb=new xc(this.Vhk,this.tCc);return new Nc(this.metadata.packetId,this.metadata.clientId,1,6,Ha,null,void 0,void 0,void 0,eb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ha){const eb=Ha.xY,rc=Ha.Agd;return new nj(eb.C0a,eb.shb,eb.jPa,eb.sCc,eb.CL,rc.Lmg,rc.tCc,qe.create(Ha))}static KPm(Ha,eb){return 2!==Ha.type?null:new nj(Ha.vwa.qd,Ha.vwa.kk,Ha.d0a.qd,Ha.d0a.kk,Ha.CL,
Ha.gne.qd,Ha.gne.kk,eb)}}Object(f.a)(nj,"RttMergeParagraphOp",Nl,[747,765]);class mk{constructor(Ha,eb,rc,Uc,bd,Hd){this.nSc=this.wi=null;this.Tka=!1;this.eef=this.JNh=0;this.QQd=this.YOh=!1;this.l$e=0;this.zkg=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.wi=this.wQ.result;this.wi.nxe(this)};this.nsj=(Pe,Le)=>{if(this.wi&&(m.AFrameworkApplication.ud("i100g733;fbhi3553"),!(m.AFrameworkApplication.J.getBooleanFeatureGate("StopRTTMessageWhenAlone",!1)&&this.Aln()||
2!==this.wi.connectionState)&&(Pe=Le.qG,Pe.length)))if(Le.k4)100>this.eef&&(this.eef++,l.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",Le.Qjl,this.JNh,this.eef));else{for(Le=0;Le<Pe.length;Le++)if(!this.HBn(Pe[Le]))return;for(Le=0;Le<Pe.length;Le++){const De=Pe[Le];this.tIh.C4k(De,!De.type&&!Le)}this.nSc||this.Qrj(this.nSc,this.wi)}};this.wQ=Ha;this.tIh=eb;this.Hlb=rc;this.LA=Uc;this.VAa=bd;this.ncc=Hd}get Un(){return this.Hlb.value}init(){return this.wQ?
this.wQ.continueWith(this.zkg):E.Task.T8(!1)}start(){this.Tka||(this.LA.rd?(this.LA.rd.qG.B8k(this.nsj),this.Tka=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Tka&&(this.Tka=!1,this.LA.rd.qG.nJo(this.nsj))}Aln(){return this.Un&&this.Un.Wy.gOa?!0:!1}HBn(Ha){return Ha&&-1!==Ha.CL?Ha.type&&3!==Ha.type&&1!==Ha.type?!1:!0:!1}BNn(){this.QQd||(this.YOh||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.YOh=!0),!this.QQd&&5>=this.l$e&&
this.l$e++)}PNn(){!this.QQd&&5>=this.l$e&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.QQd=!0)}Qrj(Ha,eb){this.BNn();Ha&&(Ha.wj||Ha.mq)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Ha.Yk);this.ncc.xFj();(Ha=this.LPm(this.tIh.VHm()))?(this.JNh++,this.nSc=eb.sE(3,Nf(Ha.serialize())),this.PNn(),this.ncc.Rtg(0),this.nSc.continueWith(rc=>{this.Qrj(rc,eb)})):this.nSc=null}LPm(Ha){if(!Ha)return null;if(!this.Un)return l.ULS.sendTraceTag(8245957,355,
15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const eb=new qe(Jj.instance.JHi(),this.Un.Vj,1,0,0,Ig.instance.jIm());let rc=null;switch(Ha.type){case 0:rc=Zd.KOm(Ha,eb,this.VAa);break;case 4:rc=Ci.JPm(Ha,eb);break;case 3:rc=fl.IPm(Ha,eb);break;case 2:rc=nj.KPm(Ha,eb);break;case 1:rc=df.MPm(Ha,eb,this.VAa)}return rc}}Object(f.a)(mk,"RttSendManager",null,[743]);class Jc{constructor(){this.Z=null;this.NFm=()=>sb.a.Gd()&&sb.a.Gd().Qk?sb.a.Gd().Qk:(l.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}Ec(Ha){const eb=Ea.a.xr(Ha.Za("Box4.IOutlineElementEditor")),rc=Ea.a.xr(Ha.Za("Box4.IFeatureHelper")),Uc=Ea.a.xr(Ha.Za("Common.IActivityAggregationInfo")),bd=Ea.a.xr(Ha.Za("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Hd=Ea.a.xr(Ha.Za("Box4.CompositionStateManager"));this.Z=Ha;const Pe=new yk.a;E.Task.WAA.call(null,eb,rc,Uc,bd,Hd).continueWith(()=>{Ha.ja("WordEditor.RealTimeTyping.IRttEditor",
()=>new Ef(Ha.resolve("Box4.ICharacterPropertiesEditor"),Ha.resolve("Box4.IOutlineElementEditor"),Pe,Ha.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();Ha.register(sh,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().fe(()=>new sh(Kb.a.We,li.a.OI(17,1,new Ll.a(new mi.a(.25)))));Ha.ja("WordEditor.RealTimeTyping.RttManager",()=>new qg(Ha.resolve("WordEditor.RealTimeTyping.IRttEditor"),new bf(Ek.a.instance),new P.a(this.NFm),new P.a(()=>Fa.a.hX),Ha.resolve("WordEditor.ParagraphWordIdMapping"),
Ha.resolve("Box4.Presence.IRtcProxyProvider").jF(),new P.a(()=>Ua.StaticActiveAppFrame.Aa().tb&&Ua.StaticActiveAppFrame.Aa().tb.rd?Ua.StaticActiveAppFrame.Aa().tb.rd.Hd:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Cb.TaskManager.instance,()=>Date.now(),Ha.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ek.a.instance,Ha.Za("Common.IActivityAggregationInfo"),vg.jF(),Pe,m.AFrameworkApplication.J.$("WordEditorThrottleAndBatchRTTRendering"),Ha.resolve("WordEditor.IRttPerfCounter"),
new ll,Ha.Za("WordEditor.Presence.IWordPresenceCpFactory"),Ha.resolve("Box4.CompositionStateManager"),Ha.resolve("WordEditor.IMainViewModeManager"),Ha.resolve("WordEditor.ClientPagination.IClientPaginationSettings").Jkc)).as("WordEditor.RealTimeTyping.IRttManager").ha();Ha.ja("WordEditor.RealTimeTyping.RttSendManager",()=>new mk(Ha.resolve("Box4.Presence.IRtcProxyProvider").jF(),new Dm,new P.a(()=>sb.a.Gd()),Ua.StaticActiveAppFrame.Aa().tb,Ha.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
Ha.resolve("WordEditor.IRttPerfCounter"))).ha();this.eYf()})}eYf(){this.Z.resolve("WordEditor.RealTimeTyping.RttManager").init();this.Z.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){ma.a.instance.Rc(new Jc)}}Object(f.a)(Jc,"WordEditorRealTimeTypingPackage",null,[0,1]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");
Type.registerNamespace("WordEditor.Presence");null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1)?Promise.all([e.e(4),e.e(2),e.e(10)]).then(e.bind(null,2133)).then(Ha=>(0,Ha.initRealtimechannel)()):Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ya.main();Type.registerNamespace("Common.App.CollabControls");Na.prototype.toString=xa.a.prototype.toString;ub.prototype.toString=
xa.a.prototype.toString;ma.a.instance.Rc(new eg);Jc.main();Type.registerNamespace("RealtimePresenceUI");ma.a.instance.Rc(new ed);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");wa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/23790900/wdjs/WordEditorDS.collab.js.map